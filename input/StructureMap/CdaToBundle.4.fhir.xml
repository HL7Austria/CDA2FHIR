<StructureMap
  xmlns="http://hl7.org/fhir">
  <id value="at-cda-to-bundle"/>
  <meta>
    <lastUpdated value="2024-05-21T06:31:19.001+00:00"/>
  </meta>
  <text>
    <status value="generated"/>
    <div
      xmlns="http://www.w3.org/1999/xhtml">
      <pre>/// url = &quot;http://hl7.at/fhir/HL7ATCoreProfiles/4.0.1/StructureMap/at-cda-to-bundle&quot;
/// name = &quot;CdaToBundle&quot;
/// title = &quot;null&quot;
/// status = &quot;draft&quot;

// Mapping CDA2FHIR

conceptmap &quot;cda-code-2-fhir-category&quot; {
  prefix s = &quot;http://loinc.org&quot;
  prefix t = &quot;http://loinc.org&quot;

  s:&quot;11502-2&quot; == t:&quot;26436-6&quot;
  s:&quot;18725-2&quot; == t:&quot;18725-2&quot;
}

conceptmap &quot;cda-sdtc-statuscode-2-fhir-composition-status&quot; {
  prefix s = &quot;http://hl7.org/fhir/ValueSet/composition-status&quot;
  prefix t = &quot;http://hl7.org/fhir/ValueSet/composition-status&quot;

  s:active == t:preliminary
  s:nullified == t:&quot;entered-in-error&quot;
}

conceptmap &quot;cm-v3-administrative-gender&quot; {
  prefix s = &quot;http://terminology.hl7.org/ValueSet/v3-AdministrativeGender&quot;
  prefix t = &quot;http://hl7.org/fhir/ValueSet/administrative-gender&quot;

  s:M == t:male
  s:F == t:female
}

conceptmap &quot;ELGAAdministrativeGenderFHIRGender&quot; {
  prefix s = &quot;https://termgit.elga.gv.at/ValueSet-elga-administrativegender&quot;
  prefix t = &quot;http://hl7.org/fhir/ValueSet/administrative-gender&quot;

  s:F == t:female
  s:M == t:male
  s:UN == t:other
}

conceptmap &quot;act-status-2-observation-status&quot; {
  prefix s = &quot;http://terminology.hl7.org/ValueSet/v3-ActStatus&quot;
  prefix t = &quot;http://hl7.org/fhir/ValueSet/observation-status&quot;

  s:completed == t:final
  s:active == t:preliminary
  s:aborted == t:cancelled
}

uses &quot;http://hl7.org/cda/stds/core/StructureDefinition/ClinicalDocument&quot; alias ClinicalDocument as source
uses &quot;http://hl7.org/cda/stds/core/StructureDefinition/Author&quot; alias Author as source
uses &quot;http://hl7.org/cda/stds/core/StructureDefinition/AssignedAuthor&quot; alias AssignedAuthor as source
uses &quot;http://hl7.org/cda/stds/core/StructureDefinition/AssignedEntity&quot; alias AssignedEntity as source
uses &quot;http://hl7.org/cda/stds/core/StructureDefinition/AssociatedEntity&quot; alias AssociatedEntity as source
uses &quot;http://hl7.org/cda/stds/core/StructureDefinition/CustodianOrganization&quot; alias CustodianOrganization as source
uses &quot;http://hl7.org/cda/stds/core/StructureDefinition/Section&quot; alias Section as source
uses &quot;http://hl7.org/cda/stds/core/StructureDefinition/PatientRole&quot; alias PatientRole as source
uses &quot;http://hl7.org/cda/stds/core/StructureDefinition/StructuredBody&quot; alias StructuredBody as source
uses &quot;http://hl7.org/cda/stds/core/StructureDefinition/Observation&quot; alias CDAObservation as source
uses &quot;http://hl7.org/cda/stds/core/StructureDefinition/Performer2&quot; alias Performer as source
uses &quot;http://hl7.org/fhir/StructureDefinition/Bundle&quot; alias Bundle as target
uses &quot;http://hl7.org/fhir/StructureDefinition/Composition&quot; alias Composition as target
uses &quot;http://hl7.org/fhir/StructureDefinition/Patient&quot; alias Patient as target
uses &quot;http://hl7.org/fhir/StructureDefinition/Person&quot; alias Person as target
uses &quot;http://hl7.org/fhir/StructureDefinition/Practitioner&quot; alias Practitioner as target
uses &quot;http://hl7.org/fhir/StructureDefinition/PractitionerRole&quot; alias PractitionerRole as target
uses &quot;http://hl7.org/fhir/StructureDefinition/Organization&quot; alias Organization as target
uses &quot;http://hl7.org/fhir/StructureDefinition/DiagnosticReport&quot; alias DiagnosticReport as target
uses &quot;http://hl7.org/fhir/StructureDefinition/ServiceRequest&quot; alias ServiceRequest as target
uses &quot;http://hl7.org/fhir/StructureDefinition/Observation&quot; alias Observation as target

imports &quot;http://hl7.at/fhir/HL7ATCoreProfiles/4.0.1/StructureMap/at-cda-to-fhir-types&quot;

// _________________________ Document Level Template  _________________________
group CdaToFhirBundle(source cda : ClinicalDocument, target fhir_bundle : Bundle) {
  cda -&gt;  fhir_bundle.id = uuid(),  fhir_bundle.type = &apos;document&apos;,  fhir_bundle.meta as fhir_bundle_meta,  fhir_bundle_meta.profile = &apos;http://hl7.eu/fhir/laboratory/StructureDefinition/Bundle-eu-lab&apos; &quot;FhirBundleMetadata&quot;;
  // ClinicalDocument.id
  cda.id -&gt; fhir_bundle.identifier &quot;identifier&quot;;
  // ClinicalDocument.effectiveTime
  cda.effectiveTime -&gt; fhir_bundle.timestamp;
  cda -&gt;  fhir_bundle.entry as fhir_bundle_entry_1,  fhir_bundle_entry_1.resource = create(&apos;Composition&apos;) as fhir_composition,  fhir_composition.id = uuid() as fhir_composition_uuid,  fhir_bundle_entry_1.fullUrl = append('urn:uuid:', fhir_composition_uuid),  fhir_bundle.entry as fhir_bundle_entry_4,  fhir_bundle_entry_4.resource = create('DiagnosticReport') as fhir_diagnosticReport,  fhir_diagnosticReport.id = uuid() as fhir_diagnosticReport_id,  fhir_bundle_entry_4.fullUrl = append('urn:uuid:', fhir_diagnosticReport_id),  fhir_bundle.entry as fhir_bundle_entry_2,  fhir_bundle_entry_2.resource = create('Patient') as fhir_patient,  fhir_patient.id = uuid() as fhir_patient_uuid,  fhir_bundle_entry_2.fullUrl = append('urn:uuid:', fhir_patient_uuid),  fhir_bundle.entry as fhir_bundle_entry_5,  fhir_bundle_entry_5.resource = create('ServiceRequest') as fhir_serviceRequest,  fhir_serviceRequest.id = uuid() as fhir_serviceRequest_id,  fhir_bundle_entry_5.fullUrl = append('urn:uuid:', fhir_serviceRequest_id),  fhir_serviceRequest.meta as fhir_serviceRequest_meta,  fhir_serviceRequest_meta.profile = 'http://hl7.eu/fhir/laboratory/StructureDefinition/ServiceRequest-eu-lab',  fhir_composition.extension as fhir_composition_extenstion_01,  fhir_composition_extenstion_01.url = 'http://hl7.eu/fhir/StructureDefinition/composition-basedOn-order-or-requisition',  fhir_composition_extenstion_01.value = create('Reference') as fhir_diagnosticReport_composition_reference,  fhir_diagnosticReport_composition_reference.reference = append('urn:uuid:', fhir_serviceRequest_id),  fhir_diagnosticReport_composition_reference.type = 'ServiceRequest',  fhir_composition.subject = create('Reference') as fhir_composition_subject_reference,  fhir_composition_subject_reference.reference = append('urn:uuid:', fhir_patient_uuid),  fhir_composition_subject_reference.type = 'Patient',  fhir_composition.extension as fhir_composition_extenstion_02,  fhir_composition_extenstion_02.url = 'http://hl7.eu/fhir/laboratory/StructureDefinition/composition-diagnosticReportReference',  fhir_composition_extenstion_02.value = create('Reference') as fhir_composition_diagnosticReport_reference,  fhir_composition_diagnosticReport_reference.reference = append('urn:uuid:', fhir_diagnosticReport_id),  fhir_composition_diagnosticReport_reference.type = 'DiagnosticReport',  fhir_diagnosticReport.extension as fhir_diagnosticReport_extension,  fhir_diagnosticReport_extension.url = 'http://hl7.org/fhir/5.0/StructureDefinition/extension-DiagnosticReport.composition',  fhir_diagnosticReport_extension.value = create('Reference') as fhir_diagnosticReport_composition_reference,  fhir_diagnosticReport_composition_reference.reference = append('urn:uuid:', fhir_composition_uuid),  fhir_diagnosticReport_composition_reference.type = 'Composition',  fhir_diagnosticReport.basedOn = create('Reference') as fhir_diagnosticReport_basedOn_reference,  fhir_diagnosticReport_basedOn_reference.reference = append('urn:uuid:', fhir_serviceRequest_id),  fhir_diagnosticReport_basedOn_reference.type = 'ServiceRequest',  fhir_diagnosticReport.subject = create('Reference') as fhir_diagnosticReport_subject_reference,  fhir_diagnosticReport_subject_reference.reference = append('urn:uuid:', fhir_patient_uuid),  fhir_diagnosticReport_subject_reference.type = 'Patient',  fhir_serviceRequest.subject = create('Reference') as fhir_serviceRequest_subject_reference,  fhir_serviceRequest_subject_reference.reference = append('urn:uuid:', fhir_patient_uuid),  fhir_serviceRequest_subject_reference.type = 'Patient',  fhir_bundle.entry as fhir_bundle_entry01,  fhir_bundle_entry01.resource = create('PractitionerRole') as fhir_practitionerRole,  fhir_practitionerRole.id = uuid() as fhir_practitionerRole_id,  fhir_bundle_entry01.fullUrl = append(&apos;urn:uuid:&apos;, fhir_practitionerRole_id) then {
    cda then CdaHeaderToFhirComposition(cda, fhir_composition, fhir_patient, fhir_diagnosticReport, fhir_serviceRequest, fhir_bundle) &quot;CdaHeaderToFhirComposition&quot;;
    cda then CdaHeaderToFhirDiagnosticReport(cda, fhir_diagnosticReport) &quot;CdaHeaderToFhirDiagnosticReport&quot;;
    // ClinicalDocument.component
    cda.component as cda_component then {
      // ClinicalDocument.component.structuredBody
      cda_component.structuredBody as cda_structuredBody then CdaToPractitionerRole(cda, fhir_practitionerRole, fhir_bundle), CdaBodyToFhirComposition(cda, cda_structuredBody, fhir_composition, fhir_practitionerRole, fhir_patient, fhir_diagnosticReport, fhir_bundle);
    };
  } &quot;CdaToFhirBundle&quot;;
}

// _________________________ Header Level Templates _________________________
group CdaHeaderToFhirComposition(source cda : ClinicalDocument, target fhir_composition : Composition, target fhir_patient : Patient, target fhir_diagnosticReport : DiagnosticReport, target fhir_serviceRequest : ServiceRequest, target fhir_bundle : Bundle) {
  cda -&gt;  fhir_composition.meta as fhir_composition_meta,  fhir_composition_meta.profile = &apos;http://hl7.eu/fhir/laboratory/StructureDefinition/Composition-eu-lab&apos; &quot;FhirCompositionProfile&quot;;
  // ClinicalDocument.code
  cda.code as cda_code then {
    cda_code.code as code_code -&gt;  fhir_composition.category as fhir_composition_category,  fhir_composition_category.coding = translate(code_code, &apos;#cda-code-2-fhir-category&apos;, &apos;Coding&apos;);
  };
  // ClinicalDocument.code.translation
  cda.code as cda_code then {
    cda_code.translation -&gt; fhir_composition.type;
    cda_code where cda_code.translation.exists().not() -&gt;  fhir_composition.type = create(&apos;CodeableConcept&apos;) as type_coding,  type_coding.coding = create(&apos;Coding&apos;) as coding_coding,  coding_coding.system = &apos;http://loinc.org&apos;,  coding_coding.code = &apos;11502-2&apos; &quot;CdaMissingCodeTranslationToFhirCompositionType&quot;;
  };
  // ClinicalDocument.title
  cda.title as cda_title -&gt; fhir_composition.title = (cda_title.xmlText);
  // ClinicalDocument.sdtc:statusCode
  // TODO clarify mapping
  cda.sdtcStatusCode as cda_statusCode where cda.sdtcStatusCode.exists() then {
    cda_statusCode.code as cda_code -&gt; fhir_composition.status = translate(cda_code, &apos;#cda-sdtc-statuscode-2-fhir-composition-status&apos;, &apos;code&apos;);
  } &quot;CdaStatusCodeToFhirCompositionStatusMapped&quot;;
  cda where cda.sdtcStatusCode.exists().not() -&gt; fhir_composition.status = &apos;final&apos; &quot;CdaStatusCodeToFhirCompositionStatusFixed&quot;;
  // TODO ClinicalDocument.hl7at:terminologyDate
  // cda.terminologyDate -&gt;
  // TODO ClinicalDocument.hl7at:formatCode
  // cda.formatCode -&gt;
  // TODO ClinicalDocument.hl7at:practiceSettingCode
  // cda.practiceSettingCode -&gt;
  // ClinicalDocument.effectiveTime
  cda.effectiveTime -&gt; fhir_composition.date;
  // ClinicalDocument.confidentialityCode
  cda.confidentialityCode -&gt; fhir_composition.confidentiality;
  // ClinicalDocument.languageCode
  cda.languageCode -&gt; fhir_composition.language;
  // ClinicalDocument.setId
  cda.setId -&gt; fhir_composition.identifier;
  // ClinicalDocument.versionNumber
  cda.versionNumber as cda_versionNumber then {
    cda_versionNumber.value as cda_versionNumber_value -&gt;  fhir_composition.extension as fhir_composition_extenstion,  fhir_composition_extenstion.url = &apos;http://hl7.org/fhir/StructureDefinition/composition-clinicaldocument-versionNumber&apos;,  fhir_composition_extenstion.value = cast(cda_versionNumber_value, &apos;string&apos;) &quot;CdaVersionNumberToFhirVersionNumber&quot;;
  };
  // ClinicalDocument.recordTarget
  cda.recordTarget as cda_recordTarget then {
    // ClinicalDocument.recordTarget.patientRole
    cda_recordTarget.patientRole as cda_patientRole then CdaPatientRoleToFhirPatient(cda_patientRole, fhir_patient, fhir_bundle) &quot;CdaPatientRoleToFhirPatient&quot;;
  } &quot;CdaRecordTargetToFhirPatient&quot;;
  // ClinicalDocument.author (as person)
  cda.author as cda_author where $this.assignedAuthor.assignedPerson.exists() -&gt;  fhir_bundle.entry as fhir_bundle_entry,  fhir_bundle_entry.resource = create('PractitionerRole') as fhir_practitionerRole,  fhir_practitionerRole.id = uuid() as fhir_practitionerRole_id,  fhir_bundle_entry.fullUrl = append('urn:uuid:', fhir_practitionerRole_id),  fhir_composition.author = create('Reference') as fhir_composition_author_reference,  fhir_composition_author_reference.reference = append('urn:uuid:', fhir_practitionerRole_id),  fhir_composition_author_reference.type = 'PractitionerRole' then CdaAuthorToFhirPractitionerRole(cda_author, fhir_practitionerRole, fhir_bundle);
  // ClinicalDocument.author (as device)
  cda.author as cda_author where $this.assignedAuthor.assignedAuthoringDevice.exists() -&gt;  fhir_bundle.entry as fhir_bundle_entry,  fhir_bundle_entry.resource = create(&apos;Device&apos;) as fhir_device,  fhir_device.id = uuid() as fhir_device_id,  fhir_bundle_entry.fullUrl = append(&apos;urn:uuid:&apos;, fhir_device_id),  fhir_composition.author = create(&apos;Reference&apos;) as fhir_composition_author_reference,  fhir_composition_author_reference.reference = append(&apos;urn:uuid:&apos;, fhir_device_id),  fhir_composition_author_reference.type = 'Device' then CdaAuthorToFhirDevice(cda_author, fhir_device, fhir_bundle);
  // ClinicalDocument.dataEnterer
  // TODO based on analysis of sample reports currently not required
  // ClinicalDocument.custodian
  cda.custodian as cda_custodian then {
    // ClinicalDocument.custodian.assignedCustodian
    cda_custodian.assignedCustodian as cda_assignedCustodian then {
      // ClinicalDocument.custodian.assignedCustodian.representedCustodianOrganization
      cda_assignedCustodian.representedCustodianOrganization as cda_representedCustodianOrganization -&gt;  fhir_bundle.entry as fhir_bundle_entry,  fhir_bundle_entry.resource = create(&apos;Organization&apos;) as fhir_custodian_organization,  fhir_custodian_organization.id = uuid() as fhir_custodian_organization_id,  fhir_bundle_entry.fullUrl = append(&apos;urn:uuid:&apos;, fhir_custodian_organization_id),  fhir_composition.custodian = create(&apos;Reference&apos;) as fhir_composition_custodian_reference,  fhir_composition_custodian_reference.reference = append(&apos;urn:uuid:&apos;, fhir_custodian_organization_id),  fhir_composition_custodian_reference.type = &apos;Organization&apos; then {
        // ClinicalDocument.custodian.assignedCustodian.representedCustodianOrganization.id
        cda_representedCustodianOrganization.id -&gt; fhir_custodian_organization.identifier;
        // ClinicalDocument.custodian.assignedCustodian.representedCustodianOrganization.name
        cda_representedCustodianOrganization.name -&gt; fhir_custodian_organization.name;
        // ClinicalDocument.custodian.assignedCustodian.representedCustodianOrganization.telecom
        cda_representedCustodianOrganization.telecom -&gt; fhir_custodian_organization.telecom;
        // ClinicalDocument.custodian.assignedCustodian.representedCustodianOrganization.addr
        // cda_representedCustodianOrganization.addr as cda_custodian_addr -&gt;
        // fhir_custodian_organization.address = create(&apos;Address&apos;) as fhir_custodian_address then
        // CdaAdressCompilationToFhirAustrianAddress(cda_custodian_addr, fhir_custodian_address)
        // &quot;CdaCustodianAddressToFhirCustodianAustrianAddress&quot;;
        cda_representedCustodianOrganization.addr -&gt; fhir_custodian_organization.address;
      };
    };
  };
  // ClinicalDocument.informationRecipient
  // TODO based on analysis of sample reports currently not required
  // ClinicalDocument.legalAuthenticator
  cda.legalAuthenticator as cda_legalAuthenticator -&gt; fhir_composition.attester as fhir_composition_attester then {
    // ClinicalDocument.legalAuthenticator.time
    cda_legalAuthenticator.time -&gt; fhir_composition_attester.time;
    // ClinicalDocument.legalAuthenticator.signatureCode
    // in CDA constantly &apos;S&apos; -&gt; in FHIR &apos;legal&apos;
    cda_legalAuthenticator.signatureCode -&gt; fhir_composition_attester.mode = &apos;legal&apos; &quot;CdaLegalAuthenticatorSignatureCodeToFhirCompositionAttesterMode&quot;;
    // ClinicalDocument.legalAuthenticator.assignedEntity
    cda_legalAuthenticator.assignedEntity as cda_legalAuthenticator_assignedEntity -&gt;  fhir_bundle.entry as fhir_bundle_entry01,  fhir_bundle_entry01.resource = create('PractitionerRole') as fhir_practitionerRole,  fhir_practitionerRole.id = uuid() as fhir_practitionerRole_id,  fhir_bundle_entry01.fullUrl = append('urn:uuid:', fhir_practitionerRole_id),  fhir_composition_attester.party = create('Reference') as fhir_composition_attester_reference,  fhir_composition_attester_reference.reference = append('urn:uuid:', fhir_practitionerRole_id),  fhir_composition_attester_reference.type = 'PractitionerRole' then CdaAssignedEntityToFhirPractitionerRole(cda_legalAuthenticator_assignedEntity, fhir_practitionerRole, fhir_bundle);
  };
  // ClinicalDocument.authenticator
  // TODO based on analysis of sample reports currently not required
  // Participant Auftraggeber / Ordering Provider
  // ClinicalDocument.participant[@typeCode=&apos;REF&apos;]
  cda.participant as cda_orderingProvider where $this.typeCode = &apos;REF&apos; -&gt;  fhir_bundle.entry as fhir_bundle_entry,  fhir_bundle_entry.resource = create(&apos;PractitionerRole&apos;) as fhir_practitionerRole,  fhir_practitionerRole.id = uuid() as fhir_practitionerRole_id,  fhir_bundle_entry.fullUrl = append('urn:uuid:', fhir_practitionerRole_id),  fhir_serviceRequest.requester = create('Reference') as fhir_serviceRequest_requester_reference,  fhir_serviceRequest_requester_reference.reference = append('urn:uuid:', fhir_practitionerRole_id),  fhir_serviceRequest_requester_reference.type = 'PractitionerRole' then {
    // ClinicalDocument.participant[@typeCode='REF'].time
    cda_orderingProvider.time as cda_orderingProvider_time then {
      cda_orderingProvider_time.value as v -&gt; fhir_serviceRequest.authoredOn = cast(v, &apos;string&apos;);
    };
    // ClinicalDocument.participant[@typeCode=&apos;REF&apos;].associatedEntity
    cda_orderingProvider.associatedEntity as cda_associatedEntity then CdaAssociatedEntityToFhirPractitionerRole(cda_associatedEntity, fhir_practitionerRole, fhir_bundle);
  } &quot;CdaOrderingProviderToFhirServiceRequestRequester&quot;;
  // Participant Fachlicher Ansprechpartner
  // ClinicalDocument.participant[hl7:templateId [@root='1.2.40.0.34.6.0.11.1.20']]
  // TODO extension required
  // Participant Hausarzt
  // ClinicalDocument.participant[hl7:templateId [@root='1.2.40.0.34.6.0.11.1.23']]
  // TODO based on analysis of sample reports currently not required
  // Participant Auskunftsberechtigte Person (Notfallkontakt)
  // ClinicalDocument.participant[hl7:templateId [@root='1.2.40.0.34.6.0.11.1.27']]
  // TODO based on analysis of sample reports currently not required
  // Participant Angehoerige
  // ClinicalDocument.participant[hl7:templateId [@root='1.2.40.0.34.6.0.11.1.25']]
  // TODO extension required
  // Participant Versicherung
  // ClinicalDocument.participant[hl7:templateId [@root='1.2.40.0.34.6.0.11.1.26']]
  // TODO extension required
  // Participant Betreuungsorganisation
  // ClinicalDocument.participant[hl7:templateId [@root='1.2.40.0.34.6.0.11.1.29']]
  // TODO based on analysis of sample reports currently not required
  // Participant Weitere Behandler
  // ClinicalDocument.participant[hl7:templateId [@root=&apos;1.2.40.0.34.6.0.11.1.28&apos;]]
  // TODO based on analysis of sample reports currently not required
  // ClinicalDocument.inFulfillmentOf
  cda.inFulfillmentOf as cda_inFulFillmentOf then {
    // ClinicalDocument.inFulfillmentOf.order
    cda_inFulFillmentOf.order as cda_inFulFillmentOf_order then {
      // ClinicalDocument.inFulfillmentOf.order.id
      cda_inFulFillmentOf_order.id -&gt; fhir_serviceRequest.identifier;
      // fhir_serviceRequest.status
      // TODO if a laboratory report is a preliminary report the status of the servicerequest should be &quot;active&quot;
      cda -&gt; fhir_serviceRequest.status = &apos;completed&apos; &quot;FhirServiceRequestStatus&quot;;
      // fhir_serviceRequest.intent
      cda -&gt; fhir_serviceRequest.intent = &apos;order&apos; &quot;FhirServiceRequestIntent&quot;;
    };
  };
  // ClinicalDocument.documentationOf
  cda.documentationOf as cda_documentationOf then {
    // ClinicalDocument.documentationOf.serviceEvent
    cda_documentationOf.serviceEvent as cda_documentationOf_serviceEvent -&gt; fhir_composition.event as fhir_composition_event then {
      // ClinicalDocument.documentationOf.serviceEvent.id
      cda_documentationOf_serviceEvent.id as serviceEvent_id then {
        serviceEvent_id.root as serviceEvent_id_root -&gt;  fhir_composition_event.code as event_codeableConcept,  event_codeableConcept.text = &apos;serviceEvent-id&apos;,  event_codeableConcept.coding as event_codeableConcept_coding,  event_codeableConcept_coding.code = serviceEvent_id_root &quot;CdaServiceEventIdToFhirEventCode&quot;;
      };
      // ClinicalDocument.documentationOf.serviceEvent.code
      cda_documentationOf_serviceEvent.code -&gt; fhir_composition_event.code;
      // ClinicalDocument.documentationOf.serviceEvent.effectiveTime
      cda_documentationOf_serviceEvent.effectiveTime -&gt; fhir_composition_event.period;
    };
  };
  // ClinicalDocument.relatedDocument
  cda.relatedDocument as cda_relatedDocument then {
    // ClinicalDocument.relatedDocument.parentDocument
    cda_relatedDocument.parentDocument as cda_parentDocument -&gt; fhir_composition.relatesTo as fhir_composition_relatesTo then {
      // ClinicalDocument.relatedDocument.typeCode
      // in Laboratory this is constrained to RPLC -&gt; replaces
      cda_relatedDocument.typeCode -&gt; fhir_composition_relatesTo.code = &apos;replaces&apos; &quot;CdaParentDocumentTypeCodeToFhirRelatesToCode&quot;;
      // ClinicalDocument.relatedDocument.parentDocument.id
      cda_parentDocument.id as cda_parentDocument_id -&gt; fhir_composition_relatesTo.target = create(&apos;Identifier&apos;) as fhir_target_identifier then II(cda_parentDocument_id, fhir_target_identifier);
    };
  };
  // ClinicalDocument.componentOf
  cda.componentOf as cda_componentOf then {
    // ClinicalDocument.componentOf.encompassingEncounter
    cda_componentOf.encompassingEncounter as cda_encompassingEncounter -&gt;  fhir_bundle.entry as fhir_bundle_entry,  fhir_bundle_entry.resource = create(&apos;Encounter&apos;) as fhir_encounter,  fhir_encounter.id = uuid() as fhir_encounter_id,  fhir_bundle_entry.fullUrl = append(&apos;urn:uuid:&apos;, fhir_encounter_id),  fhir_composition.encounter = create('Reference') as fhir_composition_encounter_reference,  fhir_composition_encounter_reference.reference = append('urn:uuid:', fhir_encounter_id),  fhir_composition_encounter_reference.type = 'Encounter',  fhir_diagnosticReport.encounter = create('Reference') as fhir_diagnosticReport_encounter_reference,  fhir_diagnosticReport_encounter_reference.reference = append('urn:uuid:', fhir_encounter_id),  fhir_diagnosticReport_encounter_reference.type = 'Encounter' then CdaEncompassingEncounterToFhirEncounter(cda_encompassingEncounter, fhir_encounter, fhir_bundle);
  };
}

group CdaHeaderToFhirDiagnosticReport(source cda : ClinicalDocument, target fhir_diagnosticReport : DiagnosticReport) {
  cda -&gt;  fhir_diagnosticReport.meta as fhir_diagnosticReport_meta,  fhir_diagnosticReport_meta.profile = &apos;http://hl7.eu/fhir/laboratory/StructureDefinition/DiagnosticReport-eu-lab&apos; &quot;FhirDiagnosticReportProfile&quot;;
  // ClinicalDocument.code
  cda.code as cda_code then {
    cda_code.code as code_code -&gt;  fhir_diagnosticReport.category as fhir_diagnosticReport_category,  fhir_diagnosticReport_category.coding = translate(code_code, &apos;#cda-code-2-fhir-category&apos;, &apos;Coding&apos;);
  };
  // ClinicalDocument.code.translation
  cda.code as cda_code then {
    cda_code.translation -&gt; fhir_diagnosticReport.code;
    cda_code where cda_code.translation.exists().not() -&gt;  fhir_diagnosticReport.code = create(&apos;CodeableConcept&apos;) as code_coding,  code_coding.coding = create(&apos;Coding&apos;) as coding_coding,  coding_coding.system = &apos;http://loinc.org&apos;,  coding_coding.code = &apos;11502-2&apos; &quot;CdaMissingCodeTranslationToFhirCompositionType&quot;;
  };
  // ClinicalDocument.title
  // see Composition
  // ClinicalDocument.sdtc:statusCode
  // TODO clarify mapping
  cda.sdtcStatusCode as cda_statusCode where cda.sdtcStatusCode.exists() then {
    cda_statusCode.code as cda_code -&gt; fhir_diagnosticReport.status = translate(cda_code, &apos;#cda-sdtc-statuscode-2-fhir-composition-status&apos;, &apos;code&apos;);
  } &quot;CdaStatusCodeToFhirCompositionStatusMapped&quot;;
  cda where cda.sdtcStatusCode.exists().not() -&gt; fhir_diagnosticReport.status = &apos;final&apos; &quot;CdaStatusCodeToFhirCompositionStatusFixed&quot;;
  // TODO ClinicalDocument.hl7at:terminologyDate
  // cda.terminologyDate -&gt;
  // TODO ClinicalDocument.hl7at:formatCode
  // cda.formatCode -&gt;
  // TODO ClinicalDocument.hl7at:practiceSettingCode
  // cda.practiceSettingCode -&gt;
  // ClinicalDocument.effectiveTime
  cda.effectiveTime as cda_effectiveTime -&gt; fhir_diagnosticReport.effective = create(&apos;dateTime&apos;) as fhir_diagnosticReport_effective then TSDateTime(cda_effectiveTime, fhir_diagnosticReport_effective) &quot;CdaEffectiveTimeToFhirDiagnosticReportEffective&quot;;
  // ClinicalDocument.confidentialityCode
  // see Composition
  // ClinicalDocument.languageCode
  // see Composition
  // ClinicalDocument.setId
  cda.setId -&gt; fhir_diagnosticReport.identifier;
}

// Source: https://art-decor.org/art-decor/decor-templates--at-lab-?section=templates&amp;id=1.2.40.0.34.6.0.11.1.3&amp;effectiveDate=2020-11-24T10:03:02&amp;language=de-DE
// Target: http://hl7.at/fhir/HL7ATCoreProfiles/4.0.1/StructureDefinition/at-core-patient
group CdaPatientRoleToFhirPatient(source cda_patientRole : PatientRole, target fhir_patient : Patient, target fhir_bundle : Bundle) {
  cda_patientRole -&gt;  fhir_patient.meta as fhir_patient_meta,  fhir_patient_meta.profile = &apos;http://hl7.eu/fhir/laboratory/StructureDefinition/Patient-eu-lab&apos; &quot;FhirPatientEuLab&quot;;
  // TODO check with TC FHIR how profile has to be read - are there additional identifier having no coding allowed apart from PI, SS, or NI?
  // patientRole.id[1]
  cda_patientRole.id first as cda_patientRole_id -&gt; fhir_patient.identifier = create(&apos;Identifier&apos;) as fhir_patient_identifier then {
    // patientRole.id
    cda_patientRole_id then II(cda_patientRole_id, fhir_patient_identifier) &quot;CdaIdToFhirIdentifier&quot;;
    // setting identifier.type.coding according to profile
    cda_patientRole_id -&gt;  fhir_patient_identifier.type as identifier_type,  identifier_type.coding as type_coding,  type_coding.system = &apos;http://terminology.hl7.org/CodeSystem/v2-0203&apos;,  type_coding.code = &apos;PI&apos;,  type_coding.display = &apos;Patient internal identifier&apos; &quot;FhirPatientIdentifierTypeCodingPI&quot;;
  } &quot;CdaLocalPatientIdToFhirPatientIdentifier&quot;;
  // patientRole.id[&gt;1]
  cda_patientRole.id not_first as cda_patientRole_id -&gt; fhir_patient.identifier = create(&apos;Identifier&apos;) as fhir_patient_identifier then {
    // patientRole.id
    cda_patientRole_id then II(cda_patientRole_id, fhir_patient_identifier) &quot;CdaIdToFhirIdentifier&quot;;
    // setting identifier.type.coding according to profile for Social Security Number
    cda_patientRole_id where (cda_patientRole_id.root = &apos;1.2.40.0.10.1.4.3.1&apos;) -&gt;  fhir_patient_identifier.assigner as assigner,  assigner.display = &apos;Dachverband der österreichischen Sozialversicherungsträger&apos;,  fhir_patient_identifier.type as identifier_type,  identifier_type.coding as type_coding,  type_coding.system = &apos;http://terminology.hl7.org/CodeSystem/v2-0203&apos;,  type_coding.code = &apos;SS&apos;,  type_coding.display = &apos;Social Security Number&apos; &quot;FhirPatientIdentifierTypeCodingSS&quot;;
    // setting identifier.type.coding according to profile for National unique individual identifier
    cda_patientRole_id where (cda_patientRole_id.root = &apos;1.2.40.0.10.2.1.1.149&apos;) -&gt;  fhir_patient_identifier.assigner as assigner,  assigner.display = &apos;Bundesministerium für Inneres&apos;,  fhir_patient_identifier.type as identifier_type,  identifier_type.coding as type_coding,  type_coding.system = &apos;http://terminology.hl7.org/CodeSystem/v2-0203&apos;,  type_coding.code = &apos;NI&apos;,  type_coding.display = &apos;National unique individual identifier&apos; &quot;FhirPatientIdentifierTypeCodingNI&quot;;
  } &quot;CdaPatientIdToFhirPatientIdentifier&quot;;
  // patientRole.addr using ADAustrianAddress
  // cda_patientRole.addr as cda_patientRole_addr -&gt;
  // fhir_patient.address = create(&apos;Address&apos;) as fhir_patient_address then
  // CdaAdressCompilationToFhirAustrianAddress(cda_patientRole_addr, fhir_patient_address)
  // &quot;CdaPatientAddressToFhirPatientAustrianAddress&quot;;
  cda_patientRole.addr -&gt; fhir_patient.address;
  // patientRole.telecom
  cda_patientRole.telecom -&gt; fhir_patient.telecom;
  // patientRole.patient
  cda_patientRole.patient as cda_patient then {
    // patient.name
    cda_patient.name -&gt; fhir_patient.name;
    // patient.administrativeGenderCode
    cda_patient.administrativeGenderCode as cda_patient_gender then {
      // patient.administrativeGenderCode.code
      cda_patient_gender.code as cda_patient_gender_code -&gt; fhir_patient.gender = translate(cda_patient_gender_code, &apos;#ELGAAdministrativeGenderFHIRGender&apos;, &apos;code&apos;) &quot;CdaPatientGenderCodeToFhirPatientGenderCode&quot;;
    } &quot;CdaPatientGenderToFhirPatientGender&quot;;
    // patient.birthTime (only date)
    cda_patient.birthTime -&gt; fhir_patient.birthDate;
    // patient.birthTime (with time if available)
    cda_patient.birthTime as cda_patient_birthTime where (cda_patient.birthTime.value.toString().length() &gt; 10) -&gt;  fhir_patient.birthDate as fhir_patient_birthDate,  fhir_patient_birthDate.extension as extension,  extension.url = &apos;http://hl7.org/fhir/StructureDefinition/patient-birthTime&apos;,  extension.value = create(&apos;dateTime&apos;) as fhir_patient_birthTime_dateTime then TSDateTime(cda_patient_birthTime, fhir_patient_birthTime_dateTime) &quot;CdaPatientBirthTimeToFhirPatientBirthTimeExtension&quot;;
    // patient.deceasedInd
    cda_patient.sdtcDeceasedInd as cda_patient_deceasedInd where cda_patient.sdtcDeceasedTime.empty() -&gt; fhir_patient.deceased = create(&apos;boolean&apos;) as fhir_patient_deceased then BL(cda_patient_deceasedInd, fhir_patient_deceased) &quot;CdaPatientDeceasedIndToFhirPatientDeceasedBoolean&quot;;
    // patient.deceasedTime
    cda_patient.sdtcDeceasedTime as cda_patient_deceasedTime -&gt; fhir_patient.deceased = create(&apos;dateTime&apos;) as fhir_patient_deceased then TSDateTime(cda_patient_deceasedTime, fhir_patient_deceased) &quot;CdaPatientDeceasedTimeToFhirPatientDeceasedDateTime&quot;;
    // patient.maritalStatusCode
    cda_patient.maritalStatusCode -&gt; fhir_patient.maritalStatus;
    // patient.religiousAffiliationCode
    cda_patient.religiousAffiliationCode as cda_patient_religiousAffiliationCode -&gt;  fhir_patient.extension as religion_extension,  religion_extension.url = &apos;http://hl7.org/fhir/StructureDefinition/patient-religion&apos;,  religion_extension.value = create(&apos;CodeableConcept&apos;) as religion_extension_codeableConcept then CECodeableConcept(cda_patient_religiousAffiliationCode, religion_extension_codeableConcept) &quot;CdaPatientReligiousAffiliationCodeToFhirPatientReligionExtension&quot;;
    // patient.raceCode NP
    // patient.ethnicGroupCode NP
    // patient.guardian
    cda_patient.guardian as cda_patient_guardian -&gt; fhir_patient.contact as fhir_patient_contact then {
      // TODO code for fhir_patient_contact.relationship
      // patient.guardian.addr
      // cda_patient_guardian.addr as cda_patient_guardian_addr -&gt; fhir_patient_contact.address = create(&apos;Address&apos;) as fhir_contact_address then CdaAdressCompilationToFhirAustrianAddress(cda_patient_guardian_addr, fhir_contact_address) &quot;CdaGuardianAddressToFhirContactAddress&quot;;
      cda_patient_guardian.addr -&gt; fhir_patient_contact.address;
      // patient.guardian.telecom
      cda_patient_guardian.telecom -&gt; fhir_patient_contact.telecom;
      // patient.guardian.guardianPerson
      cda_patient_guardian.guardianPerson as cda_guardian_person then {
        // patient.guardian.guardianPerson.name
        cda_guardian_person.name -&gt; fhir_patient_contact.name;
      } &quot;CdaPatientGuardianPersonToFhirPatientContactName&quot;;
      // patient.guardian.guardianOrganization
      cda_patient_guardian.guardianOrganization as cda_guardian_organization then {
        cda_guardian_organization.name as cda_organization_name -&gt;  fhir_bundle.entry as fhir_bundle_entry,  fhir_bundle_entry.resource = create(&apos;Organization&apos;) as fhir_contact_organization,  fhir_contact_organization.id = uuid() as fhir_contact_organization_id,  fhir_contact_organization.name = (cda_organization_name.item.xmlText),  fhir_bundle_entry.fullUrl = append(&apos;urn:uuid:&apos;, fhir_contact_organization_id),  fhir_patient_contact.organization = create(&apos;Reference&apos;) as fhir_contact_organization_reference,  fhir_contact_organization_reference.reference = append(&apos;urn:uuid:&apos;, fhir_contact_organization_id) &quot;CdaPatientGuardianOrganizationNameToFhirContactOrganizationReference&quot;;
      } &quot;CdaPatientGuardianOrganizationToFhirPatientContactOrganization&quot;;
    } &quot;CdaPatientGuardianToFhirPatientContact&quot;;
    // patient.birthplace
    cda_patient.birthplace as cda_patient_birthplace then {
      cda_patient_birthplace.place as cda_patient_place then {
        cda_patient_place.addr as cda_patient_birthaddr -&gt;  fhir_patient.extension as birthplace_extension,  birthplace_extension.url = &apos;http://hl7.org/fhir/StructureDefinition/patient-birthPlace&apos;,  birthplace_extension.value = create(&apos;Address&apos;) as birthplace_extension_addr then CdaAdressCompilationToFhirAustrianAddress(cda_patient_birthaddr, birthplace_extension_addr) &quot;CdaPatientBirthplaceAddrToFhirPatientBirthplaceExtensionValue&quot;;
      };
    } &quot;CdaPatientBirthplaceToFhirPatientBirthplaceExtension&quot;;
    // patient.languageCommunication
    cda_patient.languageCommunication as cda_patient_language -&gt; fhir_patient.communication as fhir_patient_communication then {
      // patient.languageCommunication.languageCode
      cda_patient_language.languageCode as cda_patient_languageCode then {
        cda_patient_languageCode.code as cda_patient_languageCode_code -&gt;  fhir_patient_communication.language as fhir_patient_communication_language,  fhir_patient_communication_language.coding as fhir_patient_communication_language_coding,  fhir_patient_communication_language_coding.system = &apos;urn:ietf:bcp:47&apos;,  fhir_patient_communication_language_coding.code = cda_patient_languageCode_code &quot;CdaPatientLanguageToFhirPatientLanguage&quot;;
      };
      // patient.languageCommunication.preferenceInd
      cda_patient_language.preferenceInd -&gt; fhir_patient_communication.preferred;
      cda_patient_language where cda_patient_language.modeCode.exists() or cda_patient_language.proficiencyLevelCode.exists() -&gt;  fhir_patient_communication.extension as communication_extension,  communication_extension.url = &apos;http://hl7.org/fhir/StructureDefinition/patient-proficiency&apos; then {
        // patient.languageCommunication.modeCode
        cda_patient_language.modeCode as cda_patient_language_modeCode -&gt;  communication_extension.extension as communication_extension_type,  communication_extension_type.url = &apos;type&apos;,  communication_extension_type.value = create(&apos;Coding&apos;) as communication_extension_type_coding then CECoding(cda_patient_language_modeCode, communication_extension_type_coding) &quot;CdaLanguageModeCodeToFhirProficiencyType&quot;;
        // patient.languageCommunication.proficiencyLevelCode
        cda_patient_language.proficiencyLevelCode as cda_patient_language_proficiencyLevelCode -&gt;  communication_extension.extension as communication_extension_level,  communication_extension_level.url = &apos;level&apos;,  communication_extension_level.value = create(&apos;Coding&apos;) as communication_extension_level_coding then CECoding(cda_patient_language_proficiencyLevelCode, communication_extension_level_coding) &quot;CdaLanguageProficiencyLevelToFhirProficiencyLevel&quot;;
      } &quot;CdaPatientLanguageProficiencyToFhirPatientCommunicationProficiencyExtension&quot;;
    } &quot;CdaPatientLanguageCommunicationToFhirPatientCommunication&quot;;
  } &quot;CdaPatientToFhirPatient&quot;;
}

// Source: https://art-decor.org/art-decor/decor-templates--at-lab-?section=templates&amp;id=1.2.40.0.34.6.0.11.1.2&amp;effectiveDate=2021-08-24T08:35:56&amp;language=de-DE
// Target: http://hl7.org/fhir/practitionerrole.html
// http://hl7.org/fhir/practitioner.html
group CdaAuthorToFhirPractitionerRole(source cda_author : Author, target fhir_practitionerRole : PractitionerRole, target fhir_bundle : Bundle) {
  cda_author -&gt;  fhir_bundle.entry as fhir_bundle_entry,  fhir_bundle_entry.resource = create(&apos;Practitioner&apos;) as fhir_practitioner,  fhir_practitioner.id = uuid() as fhir_practitioner_id,  fhir_bundle_entry.fullUrl = append(&apos;urn:uuid:&apos;, fhir_practitioner_id),  fhir_practitionerRole.practitioner = create(&apos;Reference&apos;) as fhir_practitionerRole_practitioner_reference,  fhir_practitionerRole_practitioner_reference.reference = append(&apos;urn:uuid:&apos;, fhir_practitioner_id),  fhir_practitionerRole_practitioner_reference.type = &apos;Practitioner&apos; then {
    // ClinicalDocument.author.functionCode
    cda_author.functionCode -&gt; fhir_practitionerRole.code;
    // ClinicalDocument.author.time
    // TODO extension?
    // ClinicalDocument.author.time
    // TODO nullFlavor? http://hl7.org/fhir/R4/extension-data-absent-reason.html
    // ClinicalDocument.author.assignedAuthor
    cda_author.assignedAuthor as cda_author_assignedAuthor then {
      // ClinicalDocument.author.assignedAuthor.id
      cda_author_assignedAuthor.id -&gt; fhir_practitioner.identifier;
      // ClinicalDocument.author.assignedAuthor.code
      cda_author_assignedAuthor.code as cda_author_assignedAuthor_code -&gt;  fhir_practitioner.qualification as fhir_practitioner_qualification,  fhir_practitioner_qualification.code as fhir_practitioner_qualification_code then CECodeableConcept(cda_author_assignedAuthor_code, fhir_practitioner_qualification_code);
      // ClinicalDocument.author.assignedAuthor.telecom
      cda_author_assignedAuthor.telecom -&gt; fhir_practitioner.telecom;
      // ClinicalDocument.author.assignedAuthor.assignedPerson
      cda_author_assignedAuthor.assignedPerson as cda_assignedPerson then {
        cda_assignedPerson.name -&gt; fhir_practitioner.name;
      };
      // ClinicalDocument.author.assignedAuthor.representedOrganization
      cda_author_assignedAuthor.representedOrganization as cda_representedOrganization -&gt;  fhir_bundle.entry as fhir_bundle_entry,  fhir_bundle_entry.resource = create('Organization') as fhir_organization,  fhir_organization.id = uuid() as fhir_organization_id,  fhir_bundle_entry.fullUrl = append('urn:uuid:', fhir_organization_id),  fhir_practitionerRole.organization = create('Reference') as fhir_practitionerRole_organization,  fhir_practitionerRole_organization.reference = append('urn:uuid:', fhir_organization_id),  fhir_practitionerRole_organization.type = 'Organization' then CdaOrganizationCompilationToFhirOrganization(cda_representedOrganization, fhir_organization);
    };
  } &quot;CdaAuthorToFhirPractitionerRole&quot;;
}

// Source: https://art-decor.org/art-decor/decor-templates--at-lab-?section=templates&amp;id=1.2.40.0.34.6.0.11.1.2&amp;effectiveDate=2021-08-24T08:35:56&amp;language=de-DE
// Target: http://hl7.org/fhir/device.html
group CdaAuthorToFhirDevice(source cda_author : Author, target fhir_device : Device, target fhir_bundle : Bundle) {
  // author.functionCode
  // TODO correct?
  cda_author.functionCode -&gt; fhir_device.type;
  // author.time
  // TODO extension?
  // author.time
  // TODO nullFlavor?
  // author.assignedAuthor
  cda_author.assignedAuthor as cda_author_assignedAuthor then {
    // author.assignedAuthor.id
    cda_author_assignedAuthor.id -&gt; fhir_device.identifier;
    // author.assignedAuthor.code
    // skipped because no value in ValueSet ELGA_AuthorSpeciality suits a device
    // author.assignedAuthor.telecom
    cda_author_assignedAuthor.telecom -&gt; fhir_device.contact;
    // author.assignedAuthor.assignedAuthoringDevice
    cda_author_assignedAuthor.assignedAuthoringDevice as cda_assignedAuthoringDevice then {
      // author.assignedAuthor.assignedAuthoringDevice.manufacturerModelName
      cda_assignedAuthoringDevice.manufacturerModelName as cda_manufacturerModelName -&gt;  fhir_device.deviceName as fhir_device_deviceName,  fhir_device_deviceName.name = (cda_manufacturerModelName.xmlText),  fhir_device_deviceName.type = &apos;model-name&apos;;
      // author.assignedAuthor.assignedAuthoringDevice.softwareName
      // TODO not clear if this is the right place to store that information
      cda_assignedAuthoringDevice.softwareName as cda_softwareName -&gt;  fhir_device.deviceName as fhir_device_deviceName,  fhir_device_deviceName.name = (cda_softwareName.xmlText),  fhir_device_deviceName.type = &apos;other&apos;;
    };
    // author.assignedAuthor.representedOrganization
    cda_author_assignedAuthor.representedOrganization as cda_representedOrganization -&gt;  fhir_bundle.entry as fhir_bundle_entry,  fhir_bundle_entry.resource = create(&apos;Organization&apos;) as fhir_organization,  fhir_organization.id = uuid() as fhir_organization_id,  fhir_bundle_entry.fullUrl = append('urn:uuid:', fhir_organization_id),  fhir_device.owner = create('Reference') as fhir_device_owner,  fhir_device_owner.reference = append('urn:uuid:', fhir_organization_id),  fhir_device_owner.type = 'Organization' then CdaOrganizationCompilationToFhirOrganization(cda_representedOrganization, fhir_organization);
  };
}

group CdaEncompassingEncounterToFhirEncounter(source cda_encompassingEncounter : EncompassingEncounter, target fhir_encounter : Encounter, target fhir_bundle : Bundle) {
  // encompassingEncounter.id
  cda_encompassingEncounter.id -&gt; fhir_encounter.identifier;
  // fhir_encounter.status
  cda_encompassingEncounter -&gt; fhir_encounter.status = &apos;finished&apos; &quot;FhirEncounterStatus&quot;;
  // encompassingEncounter.code
  cda_encompassingEncounter.code -&gt; fhir_encounter.class;
  // encompassingEncounter.effectiveTime
  cda_encompassingEncounter.effectiveTime -&gt; fhir_encounter.period;
  // encompassingEncounter.responsibleParty
  cda_encompassingEncounter.responsibleParty as cda_responsibleParty then {
    // encompassingEncounter.responsibleParty.assignedEntity
    cda_responsibleParty.assignedEntity as cda_assignedEntity -&gt;  fhir_encounter.participant as fhir_encounter_participant,  fhir_bundle.entry as fhir_bundle_entry,  fhir_bundle_entry.resource = create(&apos;PractitionerRole&apos;) as fhir_practitionerRole,  fhir_practitionerRole.id = uuid() as fhir_practitionerRole_id,  fhir_bundle_entry.fullUrl = append(&apos;urn:uuid:&apos;, fhir_practitionerRole_id),  fhir_encounter_participant.individual = create('Reference') as fhir_practitionerRole_reference,  fhir_practitionerRole_reference.reference = append('urn:uuid:', fhir_practitionerRole_id),  fhir_practitionerRole_reference.type = 'PractitionerRole' then CdaAssignedEntityToFhirPractitionerRole(cda_assignedEntity, fhir_practitionerRole, fhir_bundle);
  };
  // encompassingEncounter.location
  cda_encompassingEncounter.location as cda_location then {
    // encompassingEncounter.location.healthCareFacility
    cda_location.healthCareFacility as cda_healthCareFacility -&gt;  fhir_encounter.location as fhir_encounter_location,  fhir_bundle.entry as fhir_bundle_entry,  fhir_bundle_entry.resource = create(&apos;Location&apos;) as fhir_location,  fhir_location.id = uuid() as fhir_location_id,  fhir_bundle_entry.fullUrl = append(&apos;urn:uuid:&apos;, fhir_location_id),  fhir_encounter_location.location = create(&apos;Reference&apos;) as fhir_location_reference,  fhir_location_reference.reference = append(&apos;urn:uuid:&apos;, fhir_location_id),  fhir_location_reference.type = &apos;Location&apos; then {
      // encompassingEncounter.location.healthCareFacility.code
      cda_healthCareFacility.code -&gt; fhir_location.type;
      // encompassingEncounter.location.healthCareFacility.serviceProviderOrganization
      cda_healthCareFacility.serviceProviderOrganization as cda_serviceProviderOrganization -&gt;  fhir_bundle.entry as fhir_bundle_entry,  fhir_bundle_entry.resource = create(&apos;Organization&apos;) as fhir_organization,  fhir_organization.id = uuid() as fhir_organization_id,  fhir_bundle_entry.fullUrl = append('urn:uuid:', fhir_organization_id),  fhir_location.managingOrganization = create('Reference') as fhir_location_managingOrganization,  fhir_location_managingOrganization.reference = append('urn:uuid:', fhir_organization_id),  fhir_location_managingOrganization.type = 'Organization' then CdaOrganizationCompilationToFhirOrganization(cda_serviceProviderOrganization, fhir_organization);
    };
  };
}

// // source dataEnterer: https://art-decor.org/art-decor/decor-templates--hl7chcda-?id=2.16.756.5.30.1.1.10.2.7
// // source author: https://art-decor.org/art-decor/decor-templates--hl7chcda-?id=2.16.840.1.113883.10.12.102
// // target: https://build.fhir.org/ig/hl7ch/ch-core//StructureDefinition-ch-ext-epr-time.html
// group ChExtEprTime(source src: TSDateTime, target ext: Extension) {
// src -&gt; ext.url = &apos;http://fhir.ch/ig/ch-core/StructureDefinition/ch-ext-epr-time&apos; &quot;url&quot;;
// src -&gt; ext.value = create(&apos;dateTime&apos;) as value then TSDateTime(src, value) &quot;value&quot;;
// }
// // https://art-decor.org/art-decor/decor-templates--hl7chcda-?id=2.16.756.5.30.1.1.10.3.45
// // target: http://build.fhir.org/ig/hl7ch/ch-core/branches/master/StructureDefinition-ch-ext-epr-sectionid.html
// group ChExtEprSectionId(source src: II, target ext: Extension) {
// src -&gt; ext.url = &apos;http://fhir.ch/ig/ch-core/StructureDefinition/ch-ext-epr-sectionid&apos; &quot;url&quot;;
// src -&gt; ext.value = create(&apos;Identifier&apos;) as value then II(src, value) &quot;value&quot;;
// }
// _________________________ Section Level Templates _________________________
group CdaBodyToFhirComposition(source cda : ClinicalDocument, source cda_structuredBody : StructuredBody, target fhir_composition : Composition, target fhir_practitionerRole : PractitionerRole, target fhir_patient : Patient, target fhir_diagnosticReport : DiagnosticReport, target fhir_bundle : Bundle) {
  cda_structuredBody.component as cda_component then {
    // TODO check where these sections should be placed

    // simple sections
    // cda_component.section as cda_section where code.where(code='BRIEFT' and codeSystem='1.2.40.0.34.5.40') or // Brieftext
    // (code.where(code='46239-0' and codeSystem='2.16.840.1.113883.6.1') and (templateId.where(root='1.2.40.0.34.6.0.11.2.114') or templateId.where(root='1.2.40.0.34.11.4.2.4'))) // Überweisungsgrund - uncodiert
    // or (code.where(code='10164-2' and codeSystem='2.16.840.1.113883.6.1') and templateId.where(root='1.2.40.0.34.6.0.11.2.111')) // Anamnese - Labor und Mikrobiologie - uncodiert
    // or (code.where(code='400999005&apos; and codeSystem=&apos;2.16.840.1.113883.6.96&apos;) and templateId.where(root=&apos;1.2.40.0.34.6.0.11.2.112&apos;)) // Angeforderte Untersuchungen - uncodiert
    // or (code.where(code=&apos;ABBEM&apos; and codeSystem=&apos;1.2.40.0.34.5.40&apos;) and templateId.where(root=&apos;1.2.40.0.34.6.0.11.2.70&apos;)) // Abschließende Bemerkung
    // -&gt;
    // fhir_composition.section as fhir_section then CdaSectionToFhirSection(cda_section, fhir_section, fhir_bundle);
    // complex sections
    // Probeninformation (Specimen Section)
    cda_component.section as cda_section where code.where((code = &apos;10&apos;) and (codeSystem = &apos;1.2.40.0.34.5.11&apos;)) then CdaSpecimenSectionToFhirSpecimen(cda_section, fhir_patient, fhir_diagnosticReport, fhir_bundle);
    // Laboratory Specialty Section
    cda_component.section as cda_section where templateId.where((root = &apos;1.2.40.0.34.6.0.11.2.102&apos;) or (root = &apos;1.3.6.1.4.1.19376.1.3.3.2.1&apos;)) -&gt; fhir_composition.section as fhir_section then CdaLaboratorySpecialtySectionToFhirSection(cda, cda_section, fhir_section, fhir_practitionerRole, fhir_patient, fhir_diagnosticReport, fhir_bundle);
    // Befundbewertung
    cda_component.section as cda_section where code.where((code = &apos;20&apos;) and (codeSystem = &apos;1.2.40.0.34.5.11&apos;)) -&gt; fhir_composition.section as fhir_section then CdaBefundbewertungSectionToFhirSection(cda_section, fhir_section, fhir_bundle);
    // Beilagen
    cda_component.section as cda_section where code.where((code = &apos;BEIL&apos;) and (codeSystem = &apos;1.2.40.0.34.5.40&apos;)) then CdaBeilagenSectionToFhirDiagnosticReportMedia(cda_section, fhir_diagnosticReport, fhir_bundle, fhir_patient);
  };
}

group CdaToPractitionerRole(source cda : ClinicalDocument, target fhir_practitionerRole : PractitionerRole, target fhir_bundle : Bundle) {
  // performer has been specified in documentationOf[1]serviceEvent.performer
  cda where cda.documentationOf[0].serviceEvent.performer.exists() then {
    // ClinicalDocument.documentationOf
    cda.documentationOf first as cda_documentationOf then {
      // ClinicalDocument.documentationOf.serviceEvent
      cda_documentationOf.serviceEvent as cda_documentationOf_serviceEvent then {
        cda_documentationOf_serviceEvent.performer as cda_documentationOf_serviceEvent_performer then {
          // observation.performer.assignedEntity
          cda_documentationOf_serviceEvent_performer.assignedEntity as cda_performer_assignedEntity then CdaAssignedEntityToFhirPractitionerRole(cda_performer_assignedEntity, fhir_practitionerRole, fhir_bundle);
        };
      };
    };
  } &quot;CdaDocumentationOfServiceEventPerformerExists&quot;;
  // no performer has been specified in documentationOf[1]serviceEvent.performer. as a result the ClinicalDocument.authors will be taken as performer
  cda where cda.documentationOf[0].serviceEvent.performer.exists().not() then {
    // ClinicalDocument.author (as person)
    cda.author as cda_author where $this.assignedAuthor.assignedPerson.exists() then CdaAuthorToFhirPractitionerRole(cda_author, fhir_practitionerRole, fhir_bundle) &quot;CdaAuthorToObservationPerformer&quot;;
  } &quot;CdaDocumentationOfServiceEventPerformerExistsNot&quot;;
}

group CdaSectionToFhirSection(source cda_section : Section, target fhir_section, target fhir_bundle : Bundle) {
  // section.templateId
  // TODO necessary?
  // section.id
  // TODO extension?
  // section.code
  cda_section.code -&gt; fhir_section.code;
  // section.title
  cda_section.title as cda_section_title -&gt; fhir_section.title = (cda_section_title.xmlText) &quot;test&quot;;
  // section.text
  cda_section.text as cda_section_text -&gt;  fhir_section.text as fhir_section_text,  fhir_section_text.status = &apos;generated&apos; then {
    // section.text where no section.languageCode exists
    cda_section_text where cda_section.languageCode.exists().not() -&gt; fhir_section_text.div = cda_section_text &quot;asdf&quot;;
    // section.text with section.languageCode
    cda_section_text where cda_section.languageCode.exists() then {
      cda_section.languageCode as cda_languageCode then {
        cda_languageCode.code as cda_languageCode_code -&gt; fhir_section_text.div = cda_section_text &quot;asdf&quot;;
      };
    } &quot;CdaSectionTextToFhirSectionTextWithLanguage&quot;;
  };
  // section.author
  cda_section.author as cda_section_author -&gt;  fhir_bundle.entry as fhir_bundle_entry,  fhir_bundle_entry.resource = create(&apos;PractitionerRole&apos;) as fhir_practitionerRole,  fhir_practitionerRole.id = uuid() as fhir_practitionerRole_id,  fhir_bundle_entry.fullUrl = append(&apos;urn:uuid:&apos;, fhir_practitionerRole_id),  fhir_section.author = create(&apos;Reference&apos;) as fhir_section_author_reference,  fhir_section_author_reference.reference = append(&apos;urn:uuid:', fhir_practitionerRole_id),  fhir_section_author_reference.type = 'PractitionerRole' then CdaAuthorToFhirPractitionerRole(cda_section_author, fhir_practitionerRole, fhir_bundle);
}

group CdaSpecimenSectionToFhirSpecimen(source cda_section : Section, target fhir_patient : Patient, target fhir_diagnosticReport : DiagnosticReport, target fhir_bundle : Bundle) {
  // section.entry (Probeninformation (Specimen Entry))
  cda_section.entry as cda_section_entry then {
    // section.entry.act
    cda_section_entry.act as cda_act where $this.code.where(code = &apos;10&apos;) then {
      // section.entry.act.entryRelationship
      cda_act.entryRelationship as cda_entryRelationship then {
        // section.entry.act.entryRelationship.procedure
        cda_entryRelationship.procedure as cda_procedure -&gt;  fhir_bundle.entry as fhir_bundle_entry,  fhir_bundle_entry.resource = create(&apos;Specimen&apos;) as fhir_specimen,  fhir_specimen.id = uuid() as fhir_specimen_id,  fhir_bundle_entry.fullUrl = append(&apos;urn:uuid:&apos;, fhir_specimen_id),  fhir_specimen.subject = create('Reference') as fhir_specimen_patient_reference,  fhir_patient.id as fhir_patient_id,  fhir_specimen_patient_reference.reference = append('urn:uuid:', fhir_patient_id),  fhir_specimen_patient_reference.type = 'Patient',  fhir_diagnosticReport.specimen = create('Reference') as fhir_diagnosticReport_specimen_reference,  fhir_specimen.id as fhir_specimen_id,  fhir_diagnosticReport_specimen_reference.reference = append('urn:uuid:', fhir_specimen_id),  fhir_diagnosticReport_specimen_reference.type = &apos;Specimen&apos;,  fhir_specimen.collection as fhir_specimen_collection then {
          // Abnahmedatum/-zeit bzw. -zeitintervall des Untersuchungsmaterials
          // procedure.effectiveTime with value
          cda_procedure.effectiveTime as cda_effectiveTime where $this.value.exists() then {
            cda_effectiveTime.value as v -&gt; fhir_specimen_collection.collected = v;
          };
          // TODO procedure.effectiveTime high / low -&gt; Period
          // Entnahmeort
          // procedure.targetSiteCode
          cda_procedure.targetSiteCode -&gt; fhir_specimen_collection.bodySite;
          // Für die Abnahme verantwortlichen Person/Organisation
          // procedure.performer
          // TODO has to be modelled with ServiceRequest/Performer
          // Untersuchungsmaterial
          // procedure.participant
          cda_procedure.participant as cda_participant then {
            // procedure.participant.participantRole
            cda_participant.participantRole as cda_participantRole then {
              // procedure.participant.participantRole.playingEntity
              cda_participantRole.playingEntity as cda_playingEntity then {
                // procedure.participant.participantRole.id
                cda_participantRole.id -&gt; fhir_specimen.accessionIdentifier;
                // procedure.participant.participantRole.playingEntity.code
                cda_playingEntity.code -&gt; fhir_specimen.type;
              };
            };
          };
          // Annahmeinformation
          // procedure.entryRelationship
          cda_procedure.entryRelationship as cda_entryRelationship then {
            // procedure.entryRelationship
            cda_entryRelationship.act as cda_act then {
              // Zeitpunkt des Einlangen des Untersuchungsmaterials
              // act.effectiveTime with value
              cda_act.effectiveTime as cda_effectiveTime where $this.value.exists() then {
                cda_effectiveTime.value as v -&gt; fhir_specimen.receivedTime = v;
              };
            };
          };
        };
      };
    };
  };
}

group CdaLaboratorySpecialtySectionToFhirSection(source cda : ClinicalDocument, source cda_section : Section, target fhir_section, target fhir_practitionerRole : PractitionerRole, target fhir_patient : Patient, target fhir_diagnosticReport : DiagnosticReport, target fhir_bundle : Bundle) extends CdaSectionToFhirSection {
  // section.entry (Laboratory Report Data Processing Entry)
  cda_section.entry as cda_section_entry then {
    // section.entry.act
    cda_section_entry.act as cda_act then {
      // // section.entry.act.entryRelationship (Laboratory Observation)
      // cda_act.entryRelationship as cda_entryRelationship where $this.observation.templateId.where(root=&apos;1.3.6.1.4.1.19376.1.3.1.6&apos;) then {
      // cda_entryRelationship.observation as cda_laboratory_observation -&gt;
      // // create Observation
      // fhir_bundle.entry as fhir_bundle_entry,
      // fhir_bundle_entry.resource = create(&apos;Observation&apos;) as fhir_observation,
      // fhir_observation.id = uuid() as fhir_observation_id,
      // fhir_bundle_entry.fullUrl = append('urn:uuid:', fhir_observation_id),
      // fhir_section.entry = create('Reference') as fhir_section_entry_reference,
      // fhir_section_entry_reference.reference = append('urn:uuid:', fhir_observation_id),
      // fhir_section_entry_reference.type = 'Observation';// then CdaLaboratoryObservationToFhirObservation(cda_laboratory_observation, fhir_section_section);
      // };
      // section.entry.act.entryRelationship (Laboratory Battery Organizer)
      cda_act.entryRelationship as cda_entryRelationship where $this.organizer.templateId.where(root = &apos;1.3.6.1.4.1.19376.1.3.1.4&apos;) then {
        cda_entryRelationship.organizer as cda_laboratory_battery_organizer -&gt;  fhir_bundle.entry as fhir_bundle_entry,  fhir_bundle_entry.resource = create(&apos;Observation&apos;) as fhir_observation,  fhir_observation.id = uuid() as fhir_observation_id,  fhir_bundle_entry.fullUrl = append(&apos;urn:uuid:&apos;, fhir_observation_id),  fhir_section.entry = create(&apos;Reference&apos;) as fhir_section_entry_reference,  fhir_section_entry_reference.reference = append(&apos;urn:uuid:&apos;, fhir_observation_id),  fhir_section_entry_reference.type = &apos;Observation&apos; then {
          cda_laboratory_battery_organizer -&gt;  fhir_observation.meta as fhir_observation_meta,  fhir_observation_meta.profile = &apos;http://hl7.eu/fhir/laboratory/StructureDefinition/Observation-resultslab-eu-lab&apos; &quot;FhirObservationProfile&quot;;
          // fhir_observation.category
          cda_laboratory_battery_organizer -&gt;  fhir_observation.category as fhir_category,  fhir_category.coding as fhir_category_coding,  fhir_category_coding.system = &apos;http://terminology.hl7.org/CodeSystem/observation-category&apos;,  fhir_category_coding.code = &apos;laboratory&apos; &quot;FhirObservationCategoryCoding&quot;;
          // fhir_observation.subject
          cda_laboratory_battery_organizer -&gt;  fhir_observation.subject = create(&apos;Reference&apos;) as fhir_observation_subject_reference,  fhir_patient.id as fhir_patient_id,  fhir_observation_subject_reference.reference = append(&apos;urn:uuid:&apos;, fhir_patient_id) &quot;FhirObservationSubject&quot;;
          // organizer.code
          cda_laboratory_battery_organizer.code -&gt; fhir_observation.category;
          cda_laboratory_battery_organizer.code -&gt; fhir_observation.code;
          // organizer.statusCode
          cda_laboratory_battery_organizer.statusCode as organizer_statusCode then {
            organizer_statusCode.code as cda_code -&gt; fhir_observation.status = translate(cda_code, &apos;#act-status-2-observation-status&apos;, &apos;code&apos;);
          } &quot;CdaStatusCodeToFhirObservationStatusMapped&quot;;
          // organizer.effectiveTime
          // TODO
          cda_laboratory_battery_organizer.effectiveTime as cda_effectiveTime -&gt;  fhir_observation.effective = create(&apos;dateTime&apos;) as fhir_observation_effective,  fhir_observation_effective.extension as fhir_observation_effective_extenstion,  fhir_observation_effective_extenstion.url = &apos;http://hl7.org/fhir/StructureDefinition/data-absent-reason&apos;,  fhir_observation_effective_extenstion.value = create(&apos;code&apos;) as fhir_observation_effective_extenstion_code,  fhir_observation_effective_extenstion_code.value = &apos;not-applicable&apos; then TSDateTime(cda_effectiveTime, fhir_observation_effective) &quot;CdaEffectiveTimeToFhirObservationEffective&quot;;
          cda_laboratory_battery_organizer where cda_laboratory_battery_organizer.effectiveTime.exists().not() -&gt;  fhir_observation.effective = create(&apos;dateTime&apos;) as fhir_observation_effective,  fhir_observation_effective.value = &apos;1900-01-01&apos;,  fhir_observation_effective.extension as fhir_observation_effective_extenstion,  fhir_observation_effective_extenstion.url = &apos;http://hl7.org/fhir/StructureDefinition/data-absent-reason&apos;,  fhir_observation_effective_extenstion.value = create(&apos;code&apos;) as fhir_observation_effective_extenstion_code,  fhir_observation_effective_extenstion_code.value = &apos;not-applicable&apos; &quot;CdaEffectiveTimeExistsNotToFhirObservationEffective&quot;;
          // organizer.performer if existent in organizer
          cda_laboratory_battery_organizer.performer as cda_laboratory_battery_organizer_performer where cda_laboratory_battery_organizer.performer.exists() then CdaPerformerToFhirObservationPerformer(cda_laboratory_battery_organizer_performer, fhir_observation, fhir_bundle) &quot;CdaBatteryOrganizerPerformerToFhirObservationPerformer&quot;;
          // organizer.performer if not existent in organizer
          cda_laboratory_battery_organizer where cda_laboratory_battery_organizer.performer.exists().not() then {
            cda where cda.documentationOf[0].serviceEvent.performer.exists() then {
              // ClinicalDocument.documentationOf
              cda.documentationOf first as cda_documentationOf then {
                // ClinicalDocument.documentationOf.serviceEvent
                cda_documentationOf.serviceEvent as cda_documentationOf_serviceEvent then {
                  cda_documentationOf_serviceEvent.performer as cda_documentationOf_serviceEvent_performer then {
                    // observation.performer.time - it is assumed that only @value occurs and no interval
                    cda_documentationOf_serviceEvent_performer.time -&gt; fhir_observation.issued;
                  };
                };
              };
            } &quot;CdaDocumentationOfServiceEventPerformerExists&quot;;
            cda -&gt;  fhir_observation.performer = create(&apos;Reference&apos;) as fhir_observation_performer_reference,  fhir_practitionerRole.id as fhir_practitionerRole_id,  fhir_observation_performer_reference.reference = append(&apos;urn:uuid:&apos;, fhir_practitionerRole_id),  fhir_observation_performer_reference.type = &apos;PractitionerRole&apos; &quot;CdaBatteryOrganizerPerformerExistsNotRole&quot;;
          } &quot;CdaBatteryOrganizerPerformerExistsNot&quot;;
          // organizer.component (Laboratory Observation)
          cda_laboratory_battery_organizer.component as cda_component where $this.observation.templateId.where(root = &apos;1.3.6.1.4.1.19376.1.3.1.6&apos;) then {
            cda_component.observation as cda_laboratory_observation -&gt;  fhir_bundle.entry as fhir_bundle_entry,  fhir_bundle_entry.resource = create(&apos;Observation') as fhir_laboratory_observation,  fhir_laboratory_observation.id = uuid() as fhir_laboratory_observation_id,  fhir_bundle_entry.fullUrl = append('urn:uuid:', fhir_laboratory_observation_id),  fhir_observation.hasMember = create('Reference') as fhir_observation_hasMember_reference,  fhir_observation_hasMember_reference.reference = append('urn:uuid:', fhir_laboratory_observation_id),  fhir_observation_hasMember_reference.type = 'Observation' then CdaLaboratoryObservationToFhirObservation(cda, cda_laboratory_observation, fhir_laboratory_observation, fhir_practitionerRole, fhir_patient, fhir_bundle);
          };
        };
      };
    };
  };
}

group CdaBeilagenSectionToFhirDiagnosticReportMedia(source cda_section : Section, target fhir_diagnosticReport : DiagnosticReport, target fhir_bundle : Bundle, target fhir_patient : Patient) {
  cda_section -&gt;  fhir_bundle.entry as fhir_bundle_entry_01,  fhir_bundle_entry_01.resource = create(&apos;Media&apos;) as fhir_media,  fhir_media.id = uuid() as fhir_media_id,  fhir_bundle_entry_01.fullUrl = append('urn:uuid:', fhir_media_id),  fhir_diagnosticReport.media as fhir_diagnosticReport_media,  fhir_diagnosticReport_media.link = create('Reference') as fhir_diagnosticReport_media_link_reference,  fhir_diagnosticReport_media_link_reference.reference = append('urn:uuid:', fhir_media_id),  fhir_diagnosticReport_media_link_reference.type = 'Media' then {
    cda_section.entry as cda_section_entry then {
      cda_section_entry.observationMedia as cda_observationMedia then {
        // cda_observationMedia@ID
        cda_observationMedia.ID as cda_observationMedia_ID -&gt;  fhir_media.identifier as fhir_media_identifier,  fhir_media_identifier.value = cda_observationMedia_ID &quot;CdaObservationMediaIDFhirMediaIdentifier&quot;;
        // fhir_media.status
        cda_observationMedia -&gt; fhir_media.status = &apos;completed&apos; &quot;FhirMediaStatus&quot;;
        // cda_observationMedia.value
        cda_observationMedia.value as cda_observationMedia_value -&gt; fhir_media.content as fhir_media_content then {
          // cda_observationMedia@mediaType
          cda_observationMedia_value.mediaType as cda_mediaType -&gt; fhir_media_content.contentType = cda_mediaType;
          // cda_observationMedia.value
          cda_observationMedia_value -&gt; fhir_media_content.data = (cda_observationMedia_value.dataBase64Binary) &quot;CdaObservationMediaValueToFhirAttachmentData&quot;;
        };
      };
    };
  } &quot;CdaBeilagenToFhirMedia&quot;;
}

group CdaBefundbewertungSectionToFhirSection(source cda_section : Section, target fhir_section, target fhir_bundle : Bundle) extends CdaSectionToFhirSection {
  // section.code
  cda_section -&gt;  fhir_section.code as fhir_section_code,  fhir_section_code.coding as fhir_section_coding,  fhir_section_coding.code = &apos;48767-8&apos;,  fhir_section_coding.system = &apos;http://loinc.org&apos; &quot;FhirAnnotationSectionCoding&quot;;
}

// group ClinicalDocumentSection(source cda : ClinicalDocument, source src : Section, source patient : Patient, target tgt, target bundle: Bundle) {
// src.id as id where ($this.root=%cda.id.root)=false -&gt; tgt.extension as ext then ChExtEprSectionId(id, ext) &quot;sectionId&quot;;
// src.title as t -&gt; tgt.title = (t.dataString);
// src.code -&gt; tgt.code;
// src.text as cdaText -&gt; tgt.text as fhirText then {
// cdaText -&gt; fhirText.status = &apos;generated&apos; &quot;narrativeStatus&quot;;
// cdaText as t -&gt; fhirText.div = t &quot;narrativeText&quot;;
// } &quot;cdaText&quot;;
// src.section as srcSection -&gt; tgt.section as tgtSection then ClinicalDocumentSection(cda, srcSection, patient, tgtSection, bundle);
// }
// _________________________ Entry Level Templates   ________________________
group CdaObservationToFhirObservation(source cda_observation : CDAObservation, target fhir_observation : Observation) {
  // observation.id
  cda_observation.id -&gt; fhir_observation.identifier;
}

group CdaLaboratoryObservationToFhirObservation(source cda : ClinicalDocument, source cda_laboratory_observation : CDAObservation, target fhir_observation : Observation, target fhir_practitionerRole : PractitionerRole, target fhir_patient : Patient, target fhir_bundle : Bundle) {
  cda_laboratory_observation -&gt;  fhir_observation.meta as fhir_observation_meta,  fhir_observation_meta.profile = &apos;http://hl7.eu/fhir/laboratory/StructureDefinition/Observation-resultslab-eu-lab&apos; &quot;FhirObservationProfile&quot;;
  // observation.id
  cda_laboratory_observation.id -&gt; fhir_observation.identifier;
  // fhir_observation.category
  cda_laboratory_observation -&gt;  fhir_observation.category as fhir_category,  fhir_category.coding as fhir_category_coding,  fhir_category_coding.system = &apos;http://terminology.hl7.org/CodeSystem/observation-category&apos;,  fhir_category_coding.code = &apos;laboratory&apos; &quot;FhirObservationCategoryCoding&quot;;
  // fhir_observation.subject
  cda_laboratory_observation -&gt;  fhir_observation.subject = create(&apos;Reference&apos;) as fhir_observation_subject_reference,  fhir_patient.id as fhir_patient_id,  fhir_observation_subject_reference.reference = append(&apos;urn:uuid:&apos;, fhir_patient_id) &quot;FhirObservationSubject&quot;;
  // observation.code
  cda_laboratory_observation.code -&gt; fhir_observation.code;
  // observation.text
  // TODO
  // observation.statusCode
  cda_laboratory_observation where cda_laboratory_observation.value.exists((code = &apos;255599008&apos;) and (codeSystem = &apos;2.16.840.1.113883.6.96&apos;)).not() then {
    cda_laboratory_observation.statusCode as observation_statusCode then {
      observation_statusCode.code as cda_code -&gt; fhir_observation.status = translate(cda_code, &apos;#act-status-2-observation-status&apos;, &apos;code&apos;);
    } &quot;CdaStatusCodeToFhirObservationStatusMapped&quot;;
  } &quot;CdaStatusCodeToFhirObservationStatus&quot;;
  cda_laboratory_observation where cda_laboratory_observation.value.exists((code = &apos;255599008&apos;) and (codeSystem = &apos;2.16.840.1.113883.6.96&apos;)) -&gt;  fhir_observation.status = &apos;preliminary&apos;,  fhir_observation.dataAbsentReason as fhir_observation_dataAbsentReason,  fhir_observation_dataAbsentReason.coding as fhir_observation_dataAbsentReason_coding,  fhir_observation_dataAbsentReason_coding.code = &apos;temp-unknown&apos;,  fhir_observation_dataAbsentReason_coding.system = &apos;http://terminology.hl7.org/CodeSystem/data-absent-reason&apos; &quot;CdaIncompleteObservationToFhirObservationStatus&quot;;
  // observation.effectiveTime
  cda_laboratory_observation.effectiveTime as cda_effectiveTime -&gt; fhir_observation.effective = create(&apos;dateTime&apos;) as fhir_observation_effective then TSDateTime(cda_effectiveTime, fhir_observation_effective) &quot;CdaEffectiveTimeToFhirObservationEffective&quot;;
  cda_laboratory_observation where cda_laboratory_observation.effectiveTime.where(nullFlavor = &apos;UNK&apos;) -&gt;  fhir_observation.effective = create(&apos;dateTime&apos;) as fhir_observation_effective,  fhir_observation_effective.extension as fhir_observation_effective_extenstion,  fhir_observation_effective_extenstion.url = &apos;http://hl7.org/fhir/StructureDefinition/data-absent-reason&apos;,  fhir_observation_effective_extenstion.value = create(&apos;code&apos;) as fhir_observation_effective_extenstion_code,  fhir_observation_effective_extenstion_code.value = &apos;unknown&apos; &quot;CdaEffectiveTimeExistsNotToFhirObservationEffective&quot;;
  // observation.value(xsi:type=&quot;PQ&quot;)
  cda_laboratory_observation.value : PQ as cda_observation_value -&gt; fhir_observation.value = create(&apos;Quantity&apos;) as fhir_observation_value then PQQuantity(cda_observation_value, fhir_observation_value) &quot;CdaObservationValueToFhirObservationValuePQ&quot;;
  // observation.value(xsi:type=&quot;IVL_PQ&quot;)
  cda_laboratory_observation.value : IVL_PQ as cda_observation_value -&gt; fhir_observation.value = create(&apos;Range&apos;) as fhir_observation_value then IVLPQRange(cda_observation_value, fhir_observation_value) &quot;CdaObservationValueToFhirObservationValueIVLPQ&quot;;
  // observation.value(xsi:type=&quot;CD&quot;)
  cda_laboratory_observation where cda_laboratory_observation.value.exists((code = &apos;255599008&apos;) and (codeSystem = &apos;2.16.840.1.113883.6.96&apos;)).not() then {
    cda_laboratory_observation.value : CD as cda_observation_value -&gt; fhir_observation.value = create(&apos;CodeableConcept&apos;) as fhir_observation_value then CDCodeableConcept(cda_observation_value, fhir_observation_value) &quot;valueCD&quot;;
  } &quot;CdaObservationValueToFhirObservationValueCD&quot;;
  // TODO other datatypes
  // // Concept Descriptor
  // cdaObs.value: CD as obsValueCDA -&gt; observation.value = create(&apos;CodeableConcept&apos;) as value then CDCodeableConcept(obsValueCDA,value) &quot;observationValueCD&quot;;
  // // in the case of microbial culture finding with sample report, observation.value element contains result interpretation -&gt; error or correct? is it allowed to use an interpretationCode Element without a value-Element itself?
  // // Interval of Physical Quantities
  // cdaObs.value: IVL_PQ as obsValueCDA -&gt; observation.value = create(&apos;Range&apos;) as value then IVLPQRange(obsValueCDA, value) &quot;observationValueIVLPQ&quot;;
  // // Physical Quantity - not standard conformant, but required for example report
  // cdaObs.value: PQ as obsValueCDA -&gt; observation.value = create(&apos;Quantity&apos;) as value then PQQuantity(obsValueCDA,value) &quot;observationValuePQ&quot;;
  // // Integer
  // cdaObs.value: INT as obsValueCDA -&gt; observation.value = create(&apos;integer&apos;) as value then INT(obsValueCDA,value) &quot;observationValueINT&quot;;
  // // Interval of Integers
  // cdaObs.value: IVL_INT as obsValueCDA -&gt; observation.value = create(&apos;Range&apos;) as value then IVLINTRange(obsValueCDA,value) &quot;observationValueIVLINT&quot;;
  // // Boolean
  // cdaObs.value: BL as obsValueCDA -&gt; observation.value = create(&apos;boolean&apos;) as value then Boolean(obsValueCDA,value) &quot;observationValueBool&quot;;
  // // String
  // cdaObs.value: ST as obsValueCDA -&gt; observation.value = create(&apos;string&apos;) as value then STstring(obsValueCDA,value) &quot;observationValueString&quot;;
  // // Coded Value
  // cdaObs.value: CV as obsValueCDA -&gt; observation.value = create(&apos;CodeableConcept&apos;) as value then CVCodeableConcept(obsValueCDA,value) &quot;observationValueCV&quot;;
  // // Time Stamp
  // cdaObs.value: TS as obsValueCDA -&gt; observation.value = create(&apos;dateTime&apos;) as value then TSDateTime(obsValueCDA,value) &quot;observationValueTS&quot;;
  // // Ratio
  // cdaObs.value: RTO as obsValueCDA -&gt; observation.value = create(&apos;Ratio&apos;) as value then RTORatio(obsValueCDA,value) &quot;observationValueRTO&quot;;
  // // Ratio of quantities
  // cdaObs.value: RTO_QTY_QTY as obsValueCDA -&gt; observation.value = create(&apos;Ratio&apos;) as value then RTOQTYQTYRatio(obsValueCDA,value) &quot;observationValueRTOQTYQTY&quot;;
  // // Ratio of physical quantities
  // cdaObs.value: RTO_PQ_PQ as obsValueCDA -&gt; observation.value = create(&apos;Ratio&apos;) as value then RTOPQPQRatio(obsValueCDA,value) &quot;observationValueRTOPQPQ&quot;;
  // observation.interpretationCode
  cda_laboratory_observation.interpretationCode -&gt; fhir_observation.interpretation;
  // observation.performer if existent in observation
  cda_laboratory_observation.performer as cda_laboratory_observation_performer where cda_laboratory_observation.performer.exists() then CdaPerformerToFhirObservationPerformer(cda_laboratory_observation_performer, fhir_observation, fhir_bundle) &quot;CdaObservationPerformerToFhirObservationPerformer&quot;;
  // observation.performer if not existent in observation
  cda_laboratory_observation where cda_laboratory_observation.performer.exists().not() then {
    cda where cda.documentationOf[0].serviceEvent.performer.exists() then {
      // ClinicalDocument.documentationOf
      cda.documentationOf first as cda_documentationOf then {
        // ClinicalDocument.documentationOf.serviceEvent
        cda_documentationOf.serviceEvent as cda_documentationOf_serviceEvent then {
          cda_documentationOf_serviceEvent.performer as cda_documentationOf_serviceEvent_performer then {
            // observation.performer.time - it is assumed that only @value occurs and no interval
            cda_documentationOf_serviceEvent_performer.time -&gt; fhir_observation.issued &quot;AAA&quot;;
          };
        };
      };
    } &quot;CdaDocumentationOfServiceEventPerformerExists&quot;;
    cda -&gt;  fhir_observation.performer = create(&apos;Reference&apos;) as fhir_observation_performer_reference,  fhir_practitionerRole.id as fhir_practitionerRole_id,  fhir_observation_performer_reference.reference = append(&apos;urn:uuid:&apos;, fhir_practitionerRole_id),  fhir_observation_performer_reference.type = &apos;PractitionerRole&apos; &quot;CdaObservationPerformerExistsNotRole&quot;;
  } &quot;CdaObservationPerformerExistsNot&quot;;
  // observation.participant
  // TODO
  // observation.entryRelationship (Comment Entry)
  // TODO
  // observation.entryRelationship (Frühere Ergebnisse)
  // TODO
  // observation.referenceRange
  cda_laboratory_observation.referenceRange as cda_observation_referenceRange then {
    // observation.referenceRange.observationRange
    cda_observation_referenceRange.observationRange as cda_referenceRange_observationRange -&gt; fhir_observation.referenceRange as fhir_observation_referenceRange then {
      // observation.referenceRange.observationRange.text
      // TODO how to deal with &lt;reference&gt;-tags
      cda_referenceRange_observationRange.text -&gt; fhir_observation_referenceRange.text;
      // observation.referenceRange.observationRange.value
      cda_referenceRange_observationRange.value as cda_observationRange_value then {
        // observation.referenceRange.observationRange.value.low
        cda_observationRange_value.low -&gt; fhir_observation_referenceRange.low;
        // observation.referenceRange.observationRange.value.high
        cda_observationRange_value.high -&gt; fhir_observation_referenceRange.high;
      };
      // observation.referenceRange.observationRange.interpretationCode (always &apos;N&apos;)
      cda_referenceRange_observationRange.interpretationCode -&gt;  fhir_observation_referenceRange.type as fhir_referenceRange_type,  fhir_referenceRange_type.coding as fhir_type_coding,  fhir_type_coding.system = &apos;http://terminology.hl7.org/CodeSystem/referencerange-meaning&apos;,  fhir_type_coding.code = &apos;normal&apos; &quot;CdaInterpretationCodeToFhirInterpretationCode&quot;;
    };
  };
}

// _________________________ Template Type not specified  ___________________
// Source: https://art-decor.org/ad/#/at-lab-/rules/templates/1.2.40.0.34.6.0.11.9.22/2021-05-26T13:50:41
// Target: http://hl7.org/fhir/practitionerrole.html
// http://hl7.org/fhir/practitioner.html
group CdaAssignedEntityToFhirPractitionerRole(source cda_assignedEntity : AssignedEntity, target fhir_practitionerRole : PractitionerRole, target fhir_bundle : Bundle) {
  cda_assignedEntity -&gt;  fhir_bundle.entry as fhir_bundle_entry,  fhir_bundle_entry.resource = create('Practitioner') as fhir_practitioner,  fhir_practitioner.id = uuid() as fhir_practitioner_id,  fhir_bundle_entry.fullUrl = append('urn:uuid:', fhir_practitioner_id),  fhir_practitionerRole.practitioner = create('Reference') as fhir_practitionerRole_practitioner_reference,  fhir_practitionerRole_practitioner_reference.reference = append('urn:uuid:', fhir_practitioner_id),  fhir_practitionerRole_practitioner_reference.type = 'Practitioner&apos; then {
    // assignedEntity.id
    cda_assignedEntity.id -&gt; fhir_practitionerRole.identifier;
    // assignedEntity.code - TODO here &quot;external&quot; laboratories (performer) could be identified - best place?
    cda_assignedEntity.code -&gt; fhir_practitionerRole.code;
    // assignedEntity.addr
    cda_assignedEntity.addr -&gt; fhir_practitioner.address;
    // assignedEntity.telecom
    cda_assignedEntity.telecom -&gt; fhir_practitioner.telecom;
    // assignedEntity.assignedPerson
    cda_assignedEntity.assignedPerson as cda_assignedPerson then {
      // assignedEntity.assignedPerson.name
      cda_assignedPerson.name -&gt; fhir_practitioner.name;
    };
    // assignedEntity.representedOrganization
    cda_assignedEntity.representedOrganization as cda_representedOrganization -&gt;  fhir_bundle.entry as fhir_bundle_entry,  fhir_bundle_entry.resource = create(&apos;Organization&apos;) as fhir_organization,  fhir_organization.id = uuid() as fhir_organization_id,  fhir_bundle_entry.fullUrl = append(&apos;urn:uuid:&apos;, fhir_organization_id),  fhir_practitionerRole.organization = create(&apos;Reference&apos;) as fhir_practitionerRole_organization,  fhir_practitionerRole_organization.reference = append(&apos;urn:uuid:&apos;, fhir_organization_id),  fhir_practitionerRole_organization.type = &apos;Organization&apos; then CdaOrganizationCompilationToFhirOrganization(cda_representedOrganization, fhir_organization);
  } &quot;CdaAssignedEntityToFhirPractitionerRole&quot;;
}

// Source: https://art-decor.org/ad/#/at-lab-/rules/templates/1.2.40.0.34.6.0.11.9.22/2021-05-26T13:50:41
// Target: http://hl7.org/fhir/practitionerrole.html
// http://hl7.org/fhir/practitioner.html
group CdaAssociatedEntityToFhirPractitionerRole(source cda_associatedEntity : AssociatedEntity, target fhir_practitionerRole : PractitionerRole, target fhir_bundle : Bundle) {
  cda_associatedEntity -&gt;  fhir_bundle.entry as fhir_bundle_entry,  fhir_bundle_entry.resource = create(&apos;Practitioner&apos;) as fhir_practitioner,  fhir_practitioner.id = uuid() as fhir_practitioner_id,  fhir_bundle_entry.fullUrl = append(&apos;urn:uuid:&apos;, fhir_practitioner_id),  fhir_practitionerRole.practitioner = create(&apos;Reference&apos;) as fhir_practitionerRole_practitioner_reference,  fhir_practitionerRole_practitioner_reference.reference = append(&apos;urn:uuid:&apos;, fhir_practitioner_id),  fhir_practitionerRole_practitioner_reference.type = &apos;Practitioner&apos; then {
    // associatedEntity.id
    cda_associatedEntity.id -&gt; fhir_practitionerRole.identifier;
    // associatedEntity.addr
    cda_associatedEntity.addr -&gt; fhir_practitioner.address;
    // associatedEntity.telecom
    cda_associatedEntity.telecom -&gt; fhir_practitioner.telecom;
    // associatedEntity.associatedPerson
    cda_associatedEntity.associatedPerson as cda_associatedPerson then {
      // associatedEntity.associatedPerson.name
      cda_associatedPerson.name -&gt; fhir_practitioner.name;
    };
    // associatedEntity.scopingOrganization
    cda_associatedEntity.scopingOrganization as cda_scopingOrganization -&gt;  fhir_bundle.entry as fhir_bundle_entry,  fhir_bundle_entry.resource = create(&apos;Organization&apos;) as fhir_organization,  fhir_organization.id = uuid() as fhir_organization_id,  fhir_bundle_entry.fullUrl = append(&apos;urn:uuid:&apos;, fhir_organization_id),  fhir_practitionerRole.organization = create(&apos;Reference&apos;) as fhir_practitionerRole_organization,  fhir_practitionerRole_organization.reference = append(&apos;urn:uuid:&apos;, fhir_organization_id),  fhir_practitionerRole_organization.type = &apos;Organization&apos; then CdaOrganizationCompilationToFhirOrganization(cda_scopingOrganization, fhir_organization);
  } &quot;CdaAssociatedEntityToFhirPractitionerRole&quot;;
}

group CdaPerformerToFhirObservationPerformer(source cda_performer : Performer, target fhir_observation : Observation, target fhir_bundle : Bundle) {
  // observation.performer.time - it is assumed that only @value occurs and no interval
  cda_performer.time -&gt; fhir_observation.issued;
  // observation.performer.assignedEntity
  cda_performer.assignedEntity as cda_performer_assignedEntity -&gt;  fhir_bundle.entry as fhir_bundle_entry01,  fhir_bundle_entry01.resource = create(&apos;PractitionerRole') as fhir_practitionerRole,  fhir_practitionerRole.id = uuid() as fhir_practitionerRole_id,  fhir_bundle_entry01.fullUrl = append('urn:uuid:', fhir_practitionerRole_id),  fhir_observation.performer = create('Reference') as fhir_observation_performer_reference,  fhir_observation_performer_reference.reference = append('urn:uuid:', fhir_practitionerRole_id),  fhir_observation_performer_reference.type = 'PractitionerRole' then CdaAssignedEntityToFhirPractitionerRole(cda_performer_assignedEntity, fhir_practitionerRole, fhir_bundle);
}

</pre>
    </div>
  </text>
  <contained>
    <ConceptMap
      xmlns="http://hl7.org/fhir">
      <id value="cda-code-2-fhir-category"/>
      <status value="draft"/>
      <group>
        <source value="http://loinc.org"/>
        <target value="http://loinc.org"/>
        <element>
          <code value="11502-2"/>
          <target>
            <code value="26436-6"/>
            <equivalence value="equivalent"/>
          </target>
        </element>
        <element>
          <code value="18725-2"/>
          <target>
            <code value="18725-2"/>
            <equivalence value="equivalent"/>
          </target>
        </element>
      </group>
    </ConceptMap>
  </contained>
  <contained>
    <ConceptMap
      xmlns="http://hl7.org/fhir">
      <id value="cda-sdtc-statuscode-2-fhir-composition-status"/>
      <status value="draft"/>
      <group>
        <source value="http://hl7.org/fhir/ValueSet/composition-status"/>
        <target value="http://hl7.org/fhir/ValueSet/composition-status"/>
        <element>
          <code value="active"/>
          <target>
            <code value="preliminary"/>
            <equivalence value="equivalent"/>
          </target>
        </element>
        <element>
          <code value="nullified"/>
          <target>
            <code value="entered-in-error"/>
            <equivalence value="equivalent"/>
          </target>
        </element>
      </group>
    </ConceptMap>
  </contained>
  <contained>
    <ConceptMap
      xmlns="http://hl7.org/fhir">
      <id value="cm-v3-administrative-gender"/>
      <status value="draft"/>
      <group>
        <source value="http://terminology.hl7.org/ValueSet/v3-AdministrativeGender"/>
        <target value="http://hl7.org/fhir/ValueSet/administrative-gender"/>
        <element>
          <code value="M"/>
          <target>
            <code value="male"/>
            <equivalence value="equivalent"/>
          </target>
        </element>
        <element>
          <code value="F"/>
          <target>
            <code value="female"/>
            <equivalence value="equivalent"/>
          </target>
        </element>
      </group>
    </ConceptMap>
  </contained>
  <contained>
    <ConceptMap
      xmlns="http://hl7.org/fhir">
      <id value="ELGAAdministrativeGenderFHIRGender"/>
      <status value="draft"/>
      <group>
        <source value="https://termgit.elga.gv.at/ValueSet-elga-administrativegender"/>
        <target value="http://hl7.org/fhir/ValueSet/administrative-gender"/>
        <element>
          <code value="F"/>
          <target>
            <code value="female"/>
            <equivalence value="equivalent"/>
          </target>
        </element>
        <element>
          <code value="M"/>
          <target>
            <code value="male"/>
            <equivalence value="equivalent"/>
          </target>
        </element>
        <element>
          <code value="UN"/>
          <target>
            <code value="other"/>
            <equivalence value="equivalent"/>
          </target>
        </element>
      </group>
    </ConceptMap>
  </contained>
  <contained>
    <ConceptMap
      xmlns="http://hl7.org/fhir">
      <id value="act-status-2-observation-status"/>
      <status value="draft"/>
      <group>
        <source value="http://terminology.hl7.org/ValueSet/v3-ActStatus"/>
        <target value="http://hl7.org/fhir/ValueSet/observation-status"/>
        <element>
          <code value="completed"/>
          <target>
            <code value="final"/>
            <equivalence value="equivalent"/>
          </target>
        </element>
        <element>
          <code value="active"/>
          <target>
            <code value="preliminary"/>
            <equivalence value="equivalent"/>
          </target>
        </element>
        <element>
          <code value="aborted"/>
          <target>
            <code value="cancelled"/>
            <equivalence value="equivalent"/>
          </target>
        </element>
      </group>
    </ConceptMap>
  </contained>
  <url value="http://hl7.at/fhir/HL7ATCoreProfiles/4.0.1/StructureMap/at-cda-to-bundle"/>
  <name value="CdaToBundle"/>
  <status value="draft"/>
  <description value="Mapping CDA2FHIR"/>
  <structure>
    <url value="http://hl7.org/cda/stds/core/StructureDefinition/ClinicalDocument"/>
    <mode value="source"/>
    <alias value="ClinicalDocument"/>
  </structure>
  <structure>
    <url value="http://hl7.org/cda/stds/core/StructureDefinition/Author"/>
    <mode value="source"/>
    <alias value="Author"/>
  </structure>
  <structure>
    <url value="http://hl7.org/cda/stds/core/StructureDefinition/AssignedAuthor"/>
    <mode value="source"/>
    <alias value="AssignedAuthor"/>
  </structure>
  <structure>
    <url value="http://hl7.org/cda/stds/core/StructureDefinition/AssignedEntity"/>
    <mode value="source"/>
    <alias value="AssignedEntity"/>
  </structure>
  <structure>
    <url value="http://hl7.org/cda/stds/core/StructureDefinition/AssociatedEntity"/>
    <mode value="source"/>
    <alias value="AssociatedEntity"/>
  </structure>
  <structure>
    <url value="http://hl7.org/cda/stds/core/StructureDefinition/CustodianOrganization"/>
    <mode value="source"/>
    <alias value="CustodianOrganization"/>
  </structure>
  <structure>
    <url value="http://hl7.org/cda/stds/core/StructureDefinition/Section"/>
    <mode value="source"/>
    <alias value="Section"/>
  </structure>
  <structure>
    <url value="http://hl7.org/cda/stds/core/StructureDefinition/PatientRole"/>
    <mode value="source"/>
    <alias value="PatientRole"/>
  </structure>
  <structure>
    <url value="http://hl7.org/cda/stds/core/StructureDefinition/StructuredBody"/>
    <mode value="source"/>
    <alias value="StructuredBody"/>
  </structure>
  <structure>
    <url value="http://hl7.org/cda/stds/core/StructureDefinition/Observation"/>
    <mode value="source"/>
    <alias value="CDAObservation"/>
  </structure>
  <structure>
    <url value="http://hl7.org/cda/stds/core/StructureDefinition/Performer2"/>
    <mode value="source"/>
    <alias value="Performer"/>
  </structure>
  <structure>
    <url value="http://hl7.org/fhir/StructureDefinition/Bundle"/>
    <mode value="target"/>
    <alias value="Bundle"/>
  </structure>
  <structure>
    <url value="http://hl7.org/fhir/StructureDefinition/Composition"/>
    <mode value="target"/>
    <alias value="Composition"/>
  </structure>
  <structure>
    <url value="http://hl7.org/fhir/StructureDefinition/Patient"/>
    <mode value="target"/>
    <alias value="Patient"/>
  </structure>
  <structure>
    <url value="http://hl7.org/fhir/StructureDefinition/Person"/>
    <mode value="target"/>
    <alias value="Person"/>
  </structure>
  <structure>
    <url value="http://hl7.org/fhir/StructureDefinition/Practitioner"/>
    <mode value="target"/>
    <alias value="Practitioner"/>
  </structure>
  <structure>
    <url value="http://hl7.org/fhir/StructureDefinition/PractitionerRole"/>
    <mode value="target"/>
    <alias value="PractitionerRole"/>
  </structure>
  <structure>
    <url value="http://hl7.org/fhir/StructureDefinition/Organization"/>
    <mode value="target"/>
    <alias value="Organization"/>
  </structure>
  <structure>
    <url value="http://hl7.org/fhir/StructureDefinition/DiagnosticReport"/>
    <mode value="target"/>
    <alias value="DiagnosticReport"/>
  </structure>
  <structure>
    <url value="http://hl7.org/fhir/StructureDefinition/ServiceRequest"/>
    <mode value="target"/>
    <alias value="ServiceRequest"/>
  </structure>
  <structure>
    <url value="http://hl7.org/fhir/StructureDefinition/Observation"/>
    <mode value="target"/>
    <alias value="Observation"/>
  </structure>
  <import value="http://hl7.at/fhir/HL7ATCoreProfiles/4.0.1/StructureMap/at-cda-to-fhir-types"/>
  <group>
    <name value="CdaToFhirBundle"/>
    <typeMode value="none"/>
    <documentation value="_________________________ Document Level Template  _________________________"/>
    <input>
      <name value="cda"/>
      <type value="ClinicalDocument"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="fhir_bundle"/>
      <type value="Bundle"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="FhirBundleMetadata"/>
      <source>
        <context value="cda"/>
      </source>
      <target>
        <context value="fhir_bundle"/>
        <contextType value="variable"/>
        <element value="id"/>
        <transform value="uuid"/>
      </target>
      <target>
        <context value="fhir_bundle"/>
        <contextType value="variable"/>
        <element value="type"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="document"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_bundle"/>
        <contextType value="variable"/>
        <element value="meta"/>
        <variable value="fhir_bundle_meta"/>
      </target>
      <target>
        <context value="fhir_bundle_meta"/>
        <contextType value="variable"/>
        <element value="profile"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="http://hl7.eu/fhir/laboratory/StructureDefinition/Bundle-eu-lab"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="identifier"/>
      <source>
        <context value="cda"/>
        <element value="id"/>
        <variable value="vvv"/>
      </source>
      <target>
        <context value="fhir_bundle"/>
        <contextType value="variable"/>
        <element value="identifier"/>
        <variable value="vvv"/>
        <transform value="create"/>
      </target>
    </rule>
    <rule>
      <name value="effectiveTime"/>
      <source>
        <context value="cda"/>
        <element value="effectiveTime"/>
        <variable value="vvv"/>
      </source>
      <target>
        <context value="fhir_bundle"/>
        <contextType value="variable"/>
        <element value="timestamp"/>
        <variable value="vvv"/>
        <transform value="create"/>
      </target>
    </rule>
    <rule>
      <name value="CdaToFhirBundle"/>
      <source>
        <context value="cda"/>
      </source>
      <target>
        <context value="fhir_bundle"/>
        <contextType value="variable"/>
        <element value="entry"/>
        <variable value="fhir_bundle_entry_1"/>
      </target>
      <target>
        <context value="fhir_bundle_entry_1"/>
        <contextType value="variable"/>
        <element value="resource"/>
        <variable value="fhir_composition"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Composition"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_composition"/>
        <contextType value="variable"/>
        <element value="id"/>
        <variable value="fhir_composition_uuid"/>
        <transform value="uuid"/>
      </target>
      <target>
        <context value="fhir_bundle_entry_1"/>
        <contextType value="variable"/>
        <element value="fullUrl"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_composition_uuid"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_bundle"/>
        <contextType value="variable"/>
        <element value="entry"/>
        <variable value="fhir_bundle_entry_4"/>
      </target>
      <target>
        <context value="fhir_bundle_entry_4"/>
        <contextType value="variable"/>
        <element value="resource"/>
        <variable value="fhir_diagnosticReport"/>
        <transform value="create"/>
        <parameter>
          <valueString value="DiagnosticReport"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_diagnosticReport"/>
        <contextType value="variable"/>
        <element value="id"/>
        <variable value="fhir_diagnosticReport_id"/>
        <transform value="uuid"/>
      </target>
      <target>
        <context value="fhir_bundle_entry_4"/>
        <contextType value="variable"/>
        <element value="fullUrl"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_diagnosticReport_id"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_bundle"/>
        <contextType value="variable"/>
        <element value="entry"/>
        <variable value="fhir_bundle_entry_2"/>
      </target>
      <target>
        <context value="fhir_bundle_entry_2"/>
        <contextType value="variable"/>
        <element value="resource"/>
        <variable value="fhir_patient"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Patient"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_patient"/>
        <contextType value="variable"/>
        <element value="id"/>
        <variable value="fhir_patient_uuid"/>
        <transform value="uuid"/>
      </target>
      <target>
        <context value="fhir_bundle_entry_2"/>
        <contextType value="variable"/>
        <element value="fullUrl"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_patient_uuid"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_bundle"/>
        <contextType value="variable"/>
        <element value="entry"/>
        <variable value="fhir_bundle_entry_5"/>
      </target>
      <target>
        <context value="fhir_bundle_entry_5"/>
        <contextType value="variable"/>
        <element value="resource"/>
        <variable value="fhir_serviceRequest"/>
        <transform value="create"/>
        <parameter>
          <valueString value="ServiceRequest"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_serviceRequest"/>
        <contextType value="variable"/>
        <element value="id"/>
        <variable value="fhir_serviceRequest_id"/>
        <transform value="uuid"/>
      </target>
      <target>
        <context value="fhir_bundle_entry_5"/>
        <contextType value="variable"/>
        <element value="fullUrl"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_serviceRequest_id"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_serviceRequest"/>
        <contextType value="variable"/>
        <element value="meta"/>
        <variable value="fhir_serviceRequest_meta"/>
      </target>
      <target>
        <context value="fhir_serviceRequest_meta"/>
        <contextType value="variable"/>
        <element value="profile"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="http://hl7.eu/fhir/laboratory/StructureDefinition/ServiceRequest-eu-lab"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_composition"/>
        <contextType value="variable"/>
        <element value="extension"/>
        <variable value="fhir_composition_extenstion_01"/>
      </target>
      <target>
        <context value="fhir_composition_extenstion_01"/>
        <contextType value="variable"/>
        <element value="url"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="http://hl7.eu/fhir/StructureDefinition/composition-basedOn-order-or-requisition"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_composition_extenstion_01"/>
        <contextType value="variable"/>
        <element value="value"/>
        <variable value="fhir_diagnosticReport_composition_reference"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Reference"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_diagnosticReport_composition_reference"/>
        <contextType value="variable"/>
        <element value="reference"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_serviceRequest_id"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_diagnosticReport_composition_reference"/>
        <contextType value="variable"/>
        <element value="type"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="ServiceRequest"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_composition"/>
        <contextType value="variable"/>
        <element value="subject"/>
        <variable value="fhir_composition_subject_reference"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Reference"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_composition_subject_reference"/>
        <contextType value="variable"/>
        <element value="reference"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_patient_uuid"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_composition_subject_reference"/>
        <contextType value="variable"/>
        <element value="type"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="Patient"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_composition"/>
        <contextType value="variable"/>
        <element value="extension"/>
        <variable value="fhir_composition_extenstion_02"/>
      </target>
      <target>
        <context value="fhir_composition_extenstion_02"/>
        <contextType value="variable"/>
        <element value="url"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="http://hl7.eu/fhir/laboratory/StructureDefinition/composition-diagnosticReportReference"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_composition_extenstion_02"/>
        <contextType value="variable"/>
        <element value="value"/>
        <variable value="fhir_composition_diagnosticReport_reference"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Reference"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_composition_diagnosticReport_reference"/>
        <contextType value="variable"/>
        <element value="reference"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_diagnosticReport_id"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_composition_diagnosticReport_reference"/>
        <contextType value="variable"/>
        <element value="type"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="DiagnosticReport"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_diagnosticReport"/>
        <contextType value="variable"/>
        <element value="extension"/>
        <variable value="fhir_diagnosticReport_extension"/>
      </target>
      <target>
        <context value="fhir_diagnosticReport_extension"/>
        <contextType value="variable"/>
        <element value="url"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="http://hl7.org/fhir/5.0/StructureDefinition/extension-DiagnosticReport.composition"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_diagnosticReport_extension"/>
        <contextType value="variable"/>
        <element value="value"/>
        <variable value="fhir_diagnosticReport_composition_reference"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Reference"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_diagnosticReport_composition_reference"/>
        <contextType value="variable"/>
        <element value="reference"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_composition_uuid"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_diagnosticReport_composition_reference"/>
        <contextType value="variable"/>
        <element value="type"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="Composition"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_diagnosticReport"/>
        <contextType value="variable"/>
        <element value="basedOn"/>
        <variable value="fhir_diagnosticReport_basedOn_reference"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Reference"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_diagnosticReport_basedOn_reference"/>
        <contextType value="variable"/>
        <element value="reference"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_serviceRequest_id"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_diagnosticReport_basedOn_reference"/>
        <contextType value="variable"/>
        <element value="type"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="ServiceRequest"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_diagnosticReport"/>
        <contextType value="variable"/>
        <element value="subject"/>
        <variable value="fhir_diagnosticReport_subject_reference"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Reference"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_diagnosticReport_subject_reference"/>
        <contextType value="variable"/>
        <element value="reference"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_patient_uuid"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_diagnosticReport_subject_reference"/>
        <contextType value="variable"/>
        <element value="type"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="Patient"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_serviceRequest"/>
        <contextType value="variable"/>
        <element value="subject"/>
        <variable value="fhir_serviceRequest_subject_reference"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Reference"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_serviceRequest_subject_reference"/>
        <contextType value="variable"/>
        <element value="reference"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_patient_uuid"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_serviceRequest_subject_reference"/>
        <contextType value="variable"/>
        <element value="type"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="Patient"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_bundle"/>
        <contextType value="variable"/>
        <element value="entry"/>
        <variable value="fhir_bundle_entry01"/>
      </target>
      <target>
        <context value="fhir_bundle_entry01"/>
        <contextType value="variable"/>
        <element value="resource"/>
        <variable value="fhir_practitionerRole"/>
        <transform value="create"/>
        <parameter>
          <valueString value="PractitionerRole"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_practitionerRole"/>
        <contextType value="variable"/>
        <element value="id"/>
        <variable value="fhir_practitionerRole_id"/>
        <transform value="uuid"/>
      </target>
      <target>
        <context value="fhir_bundle_entry01"/>
        <contextType value="variable"/>
        <element value="fullUrl"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_practitionerRole_id"/>
        </parameter>
      </target>
      <rule>
        <name value="CdaHeaderToFhirComposition"/>
        <source>
          <context value="cda"/>
        </source>
        <dependent>
          <name value="CdaHeaderToFhirComposition"/>
          <variable value="cda"/>
          <variable value="fhir_composition"/>
          <variable value="fhir_patient"/>
          <variable value="fhir_diagnosticReport"/>
          <variable value="fhir_serviceRequest"/>
          <variable value="fhir_bundle"/>
        </dependent>
      </rule>
      <rule>
        <name value="CdaHeaderToFhirDiagnosticReport"/>
        <source>
          <context value="cda"/>
        </source>
        <dependent>
          <name value="CdaHeaderToFhirDiagnosticReport"/>
          <variable value="cda"/>
          <variable value="fhir_diagnosticReport"/>
        </dependent>
      </rule>
      <rule>
        <name value="component"/>
        <source>
          <context value="cda"/>
          <element value="component"/>
          <variable value="cda_component"/>
        </source>
        <rule>
          <name value="structuredBody"/>
          <source>
            <context value="cda_component"/>
            <element value="structuredBody"/>
            <variable value="cda_structuredBody"/>
          </source>
          <dependent>
            <name value="CdaToPractitionerRole"/>
            <variable value="cda"/>
            <variable value="fhir_practitionerRole"/>
            <variable value="fhir_bundle"/>
          </dependent>
          <dependent>
            <name value="CdaBodyToFhirComposition"/>
            <variable value="cda"/>
            <variable value="cda_structuredBody"/>
            <variable value="fhir_composition"/>
            <variable value="fhir_practitionerRole"/>
            <variable value="fhir_patient"/>
            <variable value="fhir_diagnosticReport"/>
            <variable value="fhir_bundle"/>
          </dependent>
        </rule>
      </rule>
    </rule>
  </group>
  <group>
    <name value="CdaHeaderToFhirComposition"/>
    <typeMode value="none"/>
    <documentation value="_________________________ Header Level Templates _________________________"/>
    <input>
      <name value="cda"/>
      <type value="ClinicalDocument"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="fhir_composition"/>
      <type value="Composition"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_patient"/>
      <type value="Patient"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_diagnosticReport"/>
      <type value="DiagnosticReport"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_serviceRequest"/>
      <type value="ServiceRequest"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_bundle"/>
      <type value="Bundle"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="FhirCompositionProfile"/>
      <source>
        <context value="cda"/>
      </source>
      <target>
        <context value="fhir_composition"/>
        <contextType value="variable"/>
        <element value="meta"/>
        <variable value="fhir_composition_meta"/>
      </target>
      <target>
        <context value="fhir_composition_meta"/>
        <contextType value="variable"/>
        <element value="profile"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="http://hl7.eu/fhir/laboratory/StructureDefinition/Composition-eu-lab"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="code"/>
      <source>
        <context value="cda"/>
        <element value="code"/>
        <variable value="cda_code"/>
      </source>
      <rule>
        <name value="code"/>
        <source>
          <context value="cda_code"/>
          <element value="code"/>
          <variable value="code_code"/>
        </source>
        <target>
          <context value="fhir_composition"/>
          <contextType value="variable"/>
          <element value="category"/>
          <variable value="fhir_composition_category"/>
        </target>
        <target>
          <context value="fhir_composition_category"/>
          <contextType value="variable"/>
          <element value="coding"/>
          <transform value="translate"/>
          <parameter>
            <valueId value="code_code"/>
          </parameter>
          <parameter>
            <valueString value="#cda-code-2-fhir-category"/>
          </parameter>
          <parameter>
            <valueString value="Coding"/>
          </parameter>
        </target>
      </rule>
    </rule>
    <rule>
      <name value="code"/>
      <source>
        <context value="cda"/>
        <element value="code"/>
        <variable value="cda_code"/>
      </source>
      <rule>
        <name value="translation"/>
        <source>
          <context value="cda_code"/>
          <element value="translation"/>
          <variable value="vvv"/>
        </source>
        <target>
          <context value="fhir_composition"/>
          <contextType value="variable"/>
          <element value="type"/>
          <variable value="vvv"/>
          <transform value="create"/>
        </target>
      </rule>
      <rule>
        <name value="CdaMissingCodeTranslationToFhirCompositionType"/>
        <source>
          <context value="cda_code"/>
          <condition value="cda_code.translation.exists().not()"/>
        </source>
        <target>
          <context value="fhir_composition"/>
          <contextType value="variable"/>
          <element value="type"/>
          <variable value="type_coding"/>
          <transform value="create"/>
          <parameter>
            <valueString value="CodeableConcept"/>
          </parameter>
        </target>
        <target>
          <context value="type_coding"/>
          <contextType value="variable"/>
          <element value="coding"/>
          <variable value="coding_coding"/>
          <transform value="create"/>
          <parameter>
            <valueString value="Coding"/>
          </parameter>
        </target>
        <target>
          <context value="coding_coding"/>
          <contextType value="variable"/>
          <element value="system"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="http://loinc.org"/>
          </parameter>
        </target>
        <target>
          <context value="coding_coding"/>
          <contextType value="variable"/>
          <element value="code"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="11502-2"/>
          </parameter>
        </target>
      </rule>
    </rule>
    <rule>
      <name value="title"/>
      <source>
        <context value="cda"/>
        <element value="title"/>
        <variable value="cda_title"/>
      </source>
      <target>
        <context value="fhir_composition"/>
        <contextType value="variable"/>
        <element value="title"/>
        <transform value="evaluate"/>
        <parameter>
          <valueString value="cda_title.xmlText"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="CdaStatusCodeToFhirCompositionStatusMapped"/>
      <source>
        <context value="cda"/>
        <element value="sdtcStatusCode"/>
        <variable value="cda_statusCode"/>
        <condition value="cda.sdtcStatusCode.exists()"/>
      </source>
      <rule>
        <name value="code"/>
        <source>
          <context value="cda_statusCode"/>
          <element value="code"/>
          <variable value="cda_code"/>
        </source>
        <target>
          <context value="fhir_composition"/>
          <contextType value="variable"/>
          <element value="status"/>
          <transform value="translate"/>
          <parameter>
            <valueId value="cda_code"/>
          </parameter>
          <parameter>
            <valueString value="#cda-sdtc-statuscode-2-fhir-composition-status"/>
          </parameter>
          <parameter>
            <valueString value="code"/>
          </parameter>
        </target>
      </rule>
    </rule>
    <rule>
      <name value="CdaStatusCodeToFhirCompositionStatusFixed"/>
      <source>
        <context value="cda"/>
        <condition value="cda.sdtcStatusCode.exists().not()"/>
      </source>
      <target>
        <context value="fhir_composition"/>
        <contextType value="variable"/>
        <element value="status"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="final"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="effectiveTime"/>
      <source>
        <context value="cda"/>
        <element value="effectiveTime"/>
        <variable value="vvv"/>
      </source>
      <target>
        <context value="fhir_composition"/>
        <contextType value="variable"/>
        <element value="date"/>
        <variable value="vvv"/>
        <transform value="create"/>
      </target>
    </rule>
    <rule>
      <name value="confidentialityCode"/>
      <source>
        <context value="cda"/>
        <element value="confidentialityCode"/>
        <variable value="vvv"/>
      </source>
      <target>
        <context value="fhir_composition"/>
        <contextType value="variable"/>
        <element value="confidentiality"/>
        <variable value="vvv"/>
        <transform value="create"/>
      </target>
      <documentation value="no code conversion needed"/>
    </rule>
    <rule>
      <name value="languageCode"/>
      <source>
        <context value="cda"/>
        <element value="languageCode"/>
        <variable value="vvv"/>
      </source>
      <target>
        <context value="fhir_composition"/>
        <contextType value="variable"/>
        <element value="language"/>
        <variable value="vvv"/>
        <transform value="create"/>
      </target>
    </rule>
    <rule>
      <name value="setId"/>
      <source>
        <context value="cda"/>
        <element value="setId"/>
        <variable value="vvv"/>
      </source>
      <target>
        <context value="fhir_composition"/>
        <contextType value="variable"/>
        <element value="identifier"/>
        <variable value="vvv"/>
        <transform value="create"/>
      </target>
    </rule>
    <rule>
      <name value="versionNumber"/>
      <source>
        <context value="cda"/>
        <element value="versionNumber"/>
        <variable value="cda_versionNumber"/>
      </source>
      <rule>
        <name value="CdaVersionNumberToFhirVersionNumber"/>
        <source>
          <context value="cda_versionNumber"/>
          <element value="value"/>
          <variable value="cda_versionNumber_value"/>
        </source>
        <target>
          <context value="fhir_composition"/>
          <contextType value="variable"/>
          <element value="extension"/>
          <variable value="fhir_composition_extenstion"/>
        </target>
        <target>
          <context value="fhir_composition_extenstion"/>
          <contextType value="variable"/>
          <element value="url"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="http://hl7.org/fhir/StructureDefinition/composition-clinicaldocument-versionNumber"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_composition_extenstion"/>
          <contextType value="variable"/>
          <element value="value"/>
          <transform value="cast"/>
          <parameter>
            <valueId value="cda_versionNumber_value"/>
          </parameter>
          <parameter>
            <valueString value="string"/>
          </parameter>
        </target>
      </rule>
    </rule>
    <rule>
      <name value="CdaRecordTargetToFhirPatient"/>
      <source>
        <context value="cda"/>
        <element value="recordTarget"/>
        <variable value="cda_recordTarget"/>
      </source>
      <rule>
        <name value="CdaPatientRoleToFhirPatient"/>
        <source>
          <context value="cda_recordTarget"/>
          <element value="patientRole"/>
          <variable value="cda_patientRole"/>
        </source>
        <dependent>
          <name value="CdaPatientRoleToFhirPatient"/>
          <variable value="cda_patientRole"/>
          <variable value="fhir_patient"/>
          <variable value="fhir_bundle"/>
        </dependent>
      </rule>
    </rule>
    <rule>
      <name value="author"/>
      <source>
        <context value="cda"/>
        <element value="author"/>
        <variable value="cda_author"/>
        <condition value="$this.assignedAuthor.assignedPerson.exists()"/>
      </source>
      <target>
        <context value="fhir_bundle"/>
        <contextType value="variable"/>
        <element value="entry"/>
        <variable value="fhir_bundle_entry"/>
      </target>
      <target>
        <context value="fhir_bundle_entry"/>
        <contextType value="variable"/>
        <element value="resource"/>
        <variable value="fhir_practitionerRole"/>
        <transform value="create"/>
        <parameter>
          <valueString value="PractitionerRole"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_practitionerRole"/>
        <contextType value="variable"/>
        <element value="id"/>
        <variable value="fhir_practitionerRole_id"/>
        <transform value="uuid"/>
      </target>
      <target>
        <context value="fhir_bundle_entry"/>
        <contextType value="variable"/>
        <element value="fullUrl"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_practitionerRole_id"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_composition"/>
        <contextType value="variable"/>
        <element value="author"/>
        <variable value="fhir_composition_author_reference"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Reference"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_composition_author_reference"/>
        <contextType value="variable"/>
        <element value="reference"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_practitionerRole_id"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_composition_author_reference"/>
        <contextType value="variable"/>
        <element value="type"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="PractitionerRole"/>
        </parameter>
      </target>
      <dependent>
        <name value="CdaAuthorToFhirPractitionerRole"/>
        <variable value="cda_author"/>
        <variable value="fhir_practitionerRole"/>
        <variable value="fhir_bundle"/>
      </dependent>
    </rule>
    <rule>
      <name value="author"/>
      <source>
        <context value="cda"/>
        <element value="author"/>
        <variable value="cda_author"/>
        <condition value="$this.assignedAuthor.assignedAuthoringDevice.exists()"/>
      </source>
      <target>
        <context value="fhir_bundle"/>
        <contextType value="variable"/>
        <element value="entry"/>
        <variable value="fhir_bundle_entry"/>
      </target>
      <target>
        <context value="fhir_bundle_entry"/>
        <contextType value="variable"/>
        <element value="resource"/>
        <variable value="fhir_device"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Device"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_device"/>
        <contextType value="variable"/>
        <element value="id"/>
        <variable value="fhir_device_id"/>
        <transform value="uuid"/>
      </target>
      <target>
        <context value="fhir_bundle_entry"/>
        <contextType value="variable"/>
        <element value="fullUrl"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_device_id"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_composition"/>
        <contextType value="variable"/>
        <element value="author"/>
        <variable value="fhir_composition_author_reference"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Reference"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_composition_author_reference"/>
        <contextType value="variable"/>
        <element value="reference"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_device_id"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_composition_author_reference"/>
        <contextType value="variable"/>
        <element value="type"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="Device"/>
        </parameter>
      </target>
      <dependent>
        <name value="CdaAuthorToFhirDevice"/>
        <variable value="cda_author"/>
        <variable value="fhir_device"/>
        <variable value="fhir_bundle"/>
      </dependent>
    </rule>
    <rule>
      <name value="custodian"/>
      <source>
        <context value="cda"/>
        <element value="custodian"/>
        <variable value="cda_custodian"/>
      </source>
      <rule>
        <name value="assignedCustodian"/>
        <source>
          <context value="cda_custodian"/>
          <element value="assignedCustodian"/>
          <variable value="cda_assignedCustodian"/>
        </source>
        <rule>
          <name value="representedCustodianOrganization"/>
          <source>
            <context value="cda_assignedCustodian"/>
            <element value="representedCustodianOrganization"/>
            <variable value="cda_representedCustodianOrganization"/>
          </source>
          <target>
            <context value="fhir_bundle"/>
            <contextType value="variable"/>
            <element value="entry"/>
            <variable value="fhir_bundle_entry"/>
          </target>
          <target>
            <context value="fhir_bundle_entry"/>
            <contextType value="variable"/>
            <element value="resource"/>
            <variable value="fhir_custodian_organization"/>
            <transform value="create"/>
            <parameter>
              <valueString value="Organization"/>
            </parameter>
          </target>
          <target>
            <context value="fhir_custodian_organization"/>
            <contextType value="variable"/>
            <element value="id"/>
            <variable value="fhir_custodian_organization_id"/>
            <transform value="uuid"/>
          </target>
          <target>
            <context value="fhir_bundle_entry"/>
            <contextType value="variable"/>
            <element value="fullUrl"/>
            <transform value="append"/>
            <parameter>
              <valueString value="urn:uuid:"/>
            </parameter>
            <parameter>
              <valueId value="fhir_custodian_organization_id"/>
            </parameter>
          </target>
          <target>
            <context value="fhir_composition"/>
            <contextType value="variable"/>
            <element value="custodian"/>
            <variable value="fhir_composition_custodian_reference"/>
            <transform value="create"/>
            <parameter>
              <valueString value="Reference"/>
            </parameter>
          </target>
          <target>
            <context value="fhir_composition_custodian_reference"/>
            <contextType value="variable"/>
            <element value="reference"/>
            <transform value="append"/>
            <parameter>
              <valueString value="urn:uuid:"/>
            </parameter>
            <parameter>
              <valueId value="fhir_custodian_organization_id"/>
            </parameter>
          </target>
          <target>
            <context value="fhir_composition_custodian_reference"/>
            <contextType value="variable"/>
            <element value="type"/>
            <transform value="copy"/>
            <parameter>
              <valueString value="Organization"/>
            </parameter>
          </target>
          <rule>
            <name value="id"/>
            <source>
              <context value="cda_representedCustodianOrganization"/>
              <element value="id"/>
              <variable value="vvv"/>
            </source>
            <target>
              <context value="fhir_custodian_organization"/>
              <contextType value="variable"/>
              <element value="identifier"/>
              <variable value="vvv"/>
              <transform value="create"/>
            </target>
          </rule>
          <rule>
            <name value="name"/>
            <source>
              <context value="cda_representedCustodianOrganization"/>
              <element value="name"/>
              <variable value="vvv"/>
            </source>
            <target>
              <context value="fhir_custodian_organization"/>
              <contextType value="variable"/>
              <element value="name"/>
              <variable value="vvv"/>
              <transform value="create"/>
            </target>
          </rule>
          <rule>
            <name value="telecom"/>
            <source>
              <context value="cda_representedCustodianOrganization"/>
              <element value="telecom"/>
              <variable value="vvv"/>
            </source>
            <target>
              <context value="fhir_custodian_organization"/>
              <contextType value="variable"/>
              <element value="telecom"/>
              <variable value="vvv"/>
              <transform value="create"/>
            </target>
          </rule>
          <rule>
            <name value="addr"/>
            <source>
              <context value="cda_representedCustodianOrganization"/>
              <element value="addr"/>
              <variable value="vvv"/>
            </source>
            <target>
              <context value="fhir_custodian_organization"/>
              <contextType value="variable"/>
              <element value="address"/>
              <variable value="vvv"/>
              <transform value="create"/>
            </target>
          </rule>
        </rule>
      </rule>
    </rule>
    <rule>
      <name value="legalAuthenticator"/>
      <source>
        <context value="cda"/>
        <element value="legalAuthenticator"/>
        <variable value="cda_legalAuthenticator"/>
      </source>
      <target>
        <context value="fhir_composition"/>
        <contextType value="variable"/>
        <element value="attester"/>
        <variable value="fhir_composition_attester"/>
      </target>
      <rule>
        <name value="time"/>
        <source>
          <context value="cda_legalAuthenticator"/>
          <element value="time"/>
          <variable value="vvv"/>
        </source>
        <target>
          <context value="fhir_composition_attester"/>
          <contextType value="variable"/>
          <element value="time"/>
          <variable value="vvv"/>
          <transform value="create"/>
        </target>
      </rule>
      <rule>
        <name value="CdaLegalAuthenticatorSignatureCodeToFhirCompositionAttesterMode"/>
        <source>
          <context value="cda_legalAuthenticator"/>
          <element value="signatureCode"/>
        </source>
        <target>
          <context value="fhir_composition_attester"/>
          <contextType value="variable"/>
          <element value="mode"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="legal"/>
          </parameter>
        </target>
      </rule>
      <rule>
        <name value="assignedEntity"/>
        <source>
          <context value="cda_legalAuthenticator"/>
          <element value="assignedEntity"/>
          <variable value="cda_legalAuthenticator_assignedEntity"/>
        </source>
        <target>
          <context value="fhir_bundle"/>
          <contextType value="variable"/>
          <element value="entry"/>
          <variable value="fhir_bundle_entry01"/>
        </target>
        <target>
          <context value="fhir_bundle_entry01"/>
          <contextType value="variable"/>
          <element value="resource"/>
          <variable value="fhir_practitionerRole"/>
          <transform value="create"/>
          <parameter>
            <valueString value="PractitionerRole"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_practitionerRole"/>
          <contextType value="variable"/>
          <element value="id"/>
          <variable value="fhir_practitionerRole_id"/>
          <transform value="uuid"/>
        </target>
        <target>
          <context value="fhir_bundle_entry01"/>
          <contextType value="variable"/>
          <element value="fullUrl"/>
          <transform value="append"/>
          <parameter>
            <valueString value="urn:uuid:"/>
          </parameter>
          <parameter>
            <valueId value="fhir_practitionerRole_id"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_composition_attester"/>
          <contextType value="variable"/>
          <element value="party"/>
          <variable value="fhir_composition_attester_reference"/>
          <transform value="create"/>
          <parameter>
            <valueString value="Reference"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_composition_attester_reference"/>
          <contextType value="variable"/>
          <element value="reference"/>
          <transform value="append"/>
          <parameter>
            <valueString value="urn:uuid:"/>
          </parameter>
          <parameter>
            <valueId value="fhir_practitionerRole_id"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_composition_attester_reference"/>
          <contextType value="variable"/>
          <element value="type"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="PractitionerRole"/>
          </parameter>
        </target>
        <dependent>
          <name value="CdaAssignedEntityToFhirPractitionerRole"/>
          <variable value="cda_legalAuthenticator_assignedEntity"/>
          <variable value="fhir_practitionerRole"/>
          <variable value="fhir_bundle"/>
        </dependent>
      </rule>
    </rule>
    <rule>
      <name value="CdaOrderingProviderToFhirServiceRequestRequester"/>
      <source>
        <context value="cda"/>
        <element value="participant"/>
        <variable value="cda_orderingProvider"/>
        <condition value="$this.typeCode = 'REF'"/>
      </source>
      <target>
        <context value="fhir_bundle"/>
        <contextType value="variable"/>
        <element value="entry"/>
        <variable value="fhir_bundle_entry"/>
      </target>
      <target>
        <context value="fhir_bundle_entry"/>
        <contextType value="variable"/>
        <element value="resource"/>
        <variable value="fhir_practitionerRole"/>
        <transform value="create"/>
        <parameter>
          <valueString value="PractitionerRole"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_practitionerRole"/>
        <contextType value="variable"/>
        <element value="id"/>
        <variable value="fhir_practitionerRole_id"/>
        <transform value="uuid"/>
      </target>
      <target>
        <context value="fhir_bundle_entry"/>
        <contextType value="variable"/>
        <element value="fullUrl"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_practitionerRole_id"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_serviceRequest"/>
        <contextType value="variable"/>
        <element value="requester"/>
        <variable value="fhir_serviceRequest_requester_reference"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Reference"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_serviceRequest_requester_reference"/>
        <contextType value="variable"/>
        <element value="reference"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_practitionerRole_id"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_serviceRequest_requester_reference"/>
        <contextType value="variable"/>
        <element value="type"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="PractitionerRole"/>
        </parameter>
      </target>
      <rule>
        <name value="time"/>
        <source>
          <context value="cda_orderingProvider"/>
          <element value="time"/>
          <variable value="cda_orderingProvider_time"/>
        </source>
        <rule>
          <name value="value"/>
          <source>
            <context value="cda_orderingProvider_time"/>
            <element value="value"/>
            <variable value="v"/>
          </source>
          <target>
            <context value="fhir_serviceRequest"/>
            <contextType value="variable"/>
            <element value="authoredOn"/>
            <transform value="cast"/>
            <parameter>
              <valueId value="v"/>
            </parameter>
            <parameter>
              <valueString value="string"/>
            </parameter>
          </target>
        </rule>
      </rule>
      <rule>
        <name value="associatedEntity"/>
        <source>
          <context value="cda_orderingProvider"/>
          <element value="associatedEntity"/>
          <variable value="cda_associatedEntity"/>
        </source>
        <dependent>
          <name value="CdaAssociatedEntityToFhirPractitionerRole"/>
          <variable value="cda_associatedEntity"/>
          <variable value="fhir_practitionerRole"/>
          <variable value="fhir_bundle"/>
        </dependent>
      </rule>
    </rule>
    <rule>
      <name value="inFulfillmentOf"/>
      <source>
        <context value="cda"/>
        <element value="inFulfillmentOf"/>
        <variable value="cda_inFulFillmentOf"/>
      </source>
      <rule>
        <name value="order"/>
        <source>
          <context value="cda_inFulFillmentOf"/>
          <element value="order"/>
          <variable value="cda_inFulFillmentOf_order"/>
        </source>
        <rule>
          <name value="id"/>
          <source>
            <context value="cda_inFulFillmentOf_order"/>
            <element value="id"/>
            <variable value="vvv"/>
          </source>
          <target>
            <context value="fhir_serviceRequest"/>
            <contextType value="variable"/>
            <element value="identifier"/>
            <variable value="vvv"/>
            <transform value="create"/>
          </target>
        </rule>
        <rule>
          <name value="FhirServiceRequestStatus"/>
          <source>
            <context value="cda"/>
          </source>
          <target>
            <context value="fhir_serviceRequest"/>
            <contextType value="variable"/>
            <element value="status"/>
            <transform value="copy"/>
            <parameter>
              <valueString value="completed"/>
            </parameter>
          </target>
        </rule>
        <rule>
          <name value="FhirServiceRequestIntent"/>
          <source>
            <context value="cda"/>
          </source>
          <target>
            <context value="fhir_serviceRequest"/>
            <contextType value="variable"/>
            <element value="intent"/>
            <transform value="copy"/>
            <parameter>
              <valueString value="order"/>
            </parameter>
          </target>
        </rule>
      </rule>
    </rule>
    <rule>
      <name value="documentationOf"/>
      <source>
        <context value="cda"/>
        <element value="documentationOf"/>
        <variable value="cda_documentationOf"/>
      </source>
      <rule>
        <name value="serviceEvent"/>
        <source>
          <context value="cda_documentationOf"/>
          <element value="serviceEvent"/>
          <variable value="cda_documentationOf_serviceEvent"/>
        </source>
        <target>
          <context value="fhir_composition"/>
          <contextType value="variable"/>
          <element value="event"/>
          <variable value="fhir_composition_event"/>
        </target>
        <rule>
          <name value="id"/>
          <source>
            <context value="cda_documentationOf_serviceEvent"/>
            <element value="id"/>
            <variable value="serviceEvent_id"/>
          </source>
          <rule>
            <name value="CdaServiceEventIdToFhirEventCode"/>
            <source>
              <context value="serviceEvent_id"/>
              <element value="root"/>
              <variable value="serviceEvent_id_root"/>
            </source>
            <target>
              <context value="fhir_composition_event"/>
              <contextType value="variable"/>
              <element value="code"/>
              <variable value="event_codeableConcept"/>
            </target>
            <target>
              <context value="event_codeableConcept"/>
              <contextType value="variable"/>
              <element value="text"/>
              <transform value="copy"/>
              <parameter>
                <valueString value="serviceEvent-id"/>
              </parameter>
            </target>
            <target>
              <context value="event_codeableConcept"/>
              <contextType value="variable"/>
              <element value="coding"/>
              <variable value="event_codeableConcept_coding"/>
            </target>
            <target>
              <context value="event_codeableConcept_coding"/>
              <contextType value="variable"/>
              <element value="code"/>
              <transform value="copy"/>
              <parameter>
                <valueId value="serviceEvent_id_root"/>
              </parameter>
            </target>
          </rule>
        </rule>
        <rule>
          <name value="code"/>
          <source>
            <context value="cda_documentationOf_serviceEvent"/>
            <element value="code"/>
            <variable value="vvv"/>
          </source>
          <target>
            <context value="fhir_composition_event"/>
            <contextType value="variable"/>
            <element value="code"/>
            <variable value="vvv"/>
            <transform value="create"/>
          </target>
        </rule>
        <rule>
          <name value="effectiveTime"/>
          <source>
            <context value="cda_documentationOf_serviceEvent"/>
            <element value="effectiveTime"/>
            <variable value="vvv"/>
          </source>
          <target>
            <context value="fhir_composition_event"/>
            <contextType value="variable"/>
            <element value="period"/>
            <variable value="vvv"/>
            <transform value="create"/>
          </target>
        </rule>
      </rule>
    </rule>
    <rule>
      <name value="relatedDocument"/>
      <source>
        <context value="cda"/>
        <element value="relatedDocument"/>
        <variable value="cda_relatedDocument"/>
      </source>
      <rule>
        <name value="parentDocument"/>
        <source>
          <context value="cda_relatedDocument"/>
          <element value="parentDocument"/>
          <variable value="cda_parentDocument"/>
        </source>
        <target>
          <context value="fhir_composition"/>
          <contextType value="variable"/>
          <element value="relatesTo"/>
          <variable value="fhir_composition_relatesTo"/>
        </target>
        <rule>
          <name value="CdaParentDocumentTypeCodeToFhirRelatesToCode"/>
          <source>
            <context value="cda_relatedDocument"/>
            <element value="typeCode"/>
          </source>
          <target>
            <context value="fhir_composition_relatesTo"/>
            <contextType value="variable"/>
            <element value="code"/>
            <transform value="copy"/>
            <parameter>
              <valueString value="replaces"/>
            </parameter>
          </target>
        </rule>
        <rule>
          <name value="id"/>
          <source>
            <context value="cda_parentDocument"/>
            <element value="id"/>
            <variable value="cda_parentDocument_id"/>
          </source>
          <target>
            <context value="fhir_composition_relatesTo"/>
            <contextType value="variable"/>
            <element value="target"/>
            <variable value="fhir_target_identifier"/>
            <transform value="create"/>
            <parameter>
              <valueString value="Identifier"/>
            </parameter>
          </target>
          <dependent>
            <name value="II"/>
            <variable value="cda_parentDocument_id"/>
            <variable value="fhir_target_identifier"/>
          </dependent>
        </rule>
      </rule>
    </rule>
    <rule>
      <name value="componentOf"/>
      <source>
        <context value="cda"/>
        <element value="componentOf"/>
        <variable value="cda_componentOf"/>
      </source>
      <rule>
        <name value="encompassingEncounter"/>
        <source>
          <context value="cda_componentOf"/>
          <element value="encompassingEncounter"/>
          <variable value="cda_encompassingEncounter"/>
        </source>
        <target>
          <context value="fhir_bundle"/>
          <contextType value="variable"/>
          <element value="entry"/>
          <variable value="fhir_bundle_entry"/>
        </target>
        <target>
          <context value="fhir_bundle_entry"/>
          <contextType value="variable"/>
          <element value="resource"/>
          <variable value="fhir_encounter"/>
          <transform value="create"/>
          <parameter>
            <valueString value="Encounter"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_encounter"/>
          <contextType value="variable"/>
          <element value="id"/>
          <variable value="fhir_encounter_id"/>
          <transform value="uuid"/>
        </target>
        <target>
          <context value="fhir_bundle_entry"/>
          <contextType value="variable"/>
          <element value="fullUrl"/>
          <transform value="append"/>
          <parameter>
            <valueString value="urn:uuid:"/>
          </parameter>
          <parameter>
            <valueId value="fhir_encounter_id"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_composition"/>
          <contextType value="variable"/>
          <element value="encounter"/>
          <variable value="fhir_composition_encounter_reference"/>
          <transform value="create"/>
          <parameter>
            <valueString value="Reference"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_composition_encounter_reference"/>
          <contextType value="variable"/>
          <element value="reference"/>
          <transform value="append"/>
          <parameter>
            <valueString value="urn:uuid:"/>
          </parameter>
          <parameter>
            <valueId value="fhir_encounter_id"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_composition_encounter_reference"/>
          <contextType value="variable"/>
          <element value="type"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="Encounter"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_diagnosticReport"/>
          <contextType value="variable"/>
          <element value="encounter"/>
          <variable value="fhir_diagnosticReport_encounter_reference"/>
          <transform value="create"/>
          <parameter>
            <valueString value="Reference"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_diagnosticReport_encounter_reference"/>
          <contextType value="variable"/>
          <element value="reference"/>
          <transform value="append"/>
          <parameter>
            <valueString value="urn:uuid:"/>
          </parameter>
          <parameter>
            <valueId value="fhir_encounter_id"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_diagnosticReport_encounter_reference"/>
          <contextType value="variable"/>
          <element value="type"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="Encounter"/>
          </parameter>
        </target>
        <dependent>
          <name value="CdaEncompassingEncounterToFhirEncounter"/>
          <variable value="cda_encompassingEncounter"/>
          <variable value="fhir_encounter"/>
          <variable value="fhir_bundle"/>
        </dependent>
      </rule>
    </rule>
  </group>
  <group>
    <name value="CdaHeaderToFhirDiagnosticReport"/>
    <typeMode value="none"/>
    <input>
      <name value="cda"/>
      <type value="ClinicalDocument"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="fhir_diagnosticReport"/>
      <type value="DiagnosticReport"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="FhirDiagnosticReportProfile"/>
      <source>
        <context value="cda"/>
      </source>
      <target>
        <context value="fhir_diagnosticReport"/>
        <contextType value="variable"/>
        <element value="meta"/>
        <variable value="fhir_diagnosticReport_meta"/>
      </target>
      <target>
        <context value="fhir_diagnosticReport_meta"/>
        <contextType value="variable"/>
        <element value="profile"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="http://hl7.eu/fhir/laboratory/StructureDefinition/DiagnosticReport-eu-lab"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="code"/>
      <source>
        <context value="cda"/>
        <element value="code"/>
        <variable value="cda_code"/>
      </source>
      <rule>
        <name value="code"/>
        <source>
          <context value="cda_code"/>
          <element value="code"/>
          <variable value="code_code"/>
        </source>
        <target>
          <context value="fhir_diagnosticReport"/>
          <contextType value="variable"/>
          <element value="category"/>
          <variable value="fhir_diagnosticReport_category"/>
        </target>
        <target>
          <context value="fhir_diagnosticReport_category"/>
          <contextType value="variable"/>
          <element value="coding"/>
          <transform value="translate"/>
          <parameter>
            <valueId value="code_code"/>
          </parameter>
          <parameter>
            <valueString value="#cda-code-2-fhir-category"/>
          </parameter>
          <parameter>
            <valueString value="Coding"/>
          </parameter>
        </target>
      </rule>
    </rule>
    <rule>
      <name value="code"/>
      <source>
        <context value="cda"/>
        <element value="code"/>
        <variable value="cda_code"/>
      </source>
      <rule>
        <name value="translation"/>
        <source>
          <context value="cda_code"/>
          <element value="translation"/>
          <variable value="vvv"/>
        </source>
        <target>
          <context value="fhir_diagnosticReport"/>
          <contextType value="variable"/>
          <element value="code"/>
          <variable value="vvv"/>
          <transform value="create"/>
        </target>
      </rule>
      <rule>
        <name value="CdaMissingCodeTranslationToFhirCompositionType"/>
        <source>
          <context value="cda_code"/>
          <condition value="cda_code.translation.exists().not()"/>
        </source>
        <target>
          <context value="fhir_diagnosticReport"/>
          <contextType value="variable"/>
          <element value="code"/>
          <variable value="code_coding"/>
          <transform value="create"/>
          <parameter>
            <valueString value="CodeableConcept"/>
          </parameter>
        </target>
        <target>
          <context value="code_coding"/>
          <contextType value="variable"/>
          <element value="coding"/>
          <variable value="coding_coding"/>
          <transform value="create"/>
          <parameter>
            <valueString value="Coding"/>
          </parameter>
        </target>
        <target>
          <context value="coding_coding"/>
          <contextType value="variable"/>
          <element value="system"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="http://loinc.org"/>
          </parameter>
        </target>
        <target>
          <context value="coding_coding"/>
          <contextType value="variable"/>
          <element value="code"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="11502-2"/>
          </parameter>
        </target>
      </rule>
    </rule>
    <rule>
      <name value="CdaStatusCodeToFhirCompositionStatusMapped"/>
      <source>
        <context value="cda"/>
        <element value="sdtcStatusCode"/>
        <variable value="cda_statusCode"/>
        <condition value="cda.sdtcStatusCode.exists()"/>
      </source>
      <rule>
        <name value="code"/>
        <source>
          <context value="cda_statusCode"/>
          <element value="code"/>
          <variable value="cda_code"/>
        </source>
        <target>
          <context value="fhir_diagnosticReport"/>
          <contextType value="variable"/>
          <element value="status"/>
          <transform value="translate"/>
          <parameter>
            <valueId value="cda_code"/>
          </parameter>
          <parameter>
            <valueString value="#cda-sdtc-statuscode-2-fhir-composition-status"/>
          </parameter>
          <parameter>
            <valueString value="code"/>
          </parameter>
        </target>
      </rule>
    </rule>
    <rule>
      <name value="CdaStatusCodeToFhirCompositionStatusFixed"/>
      <source>
        <context value="cda"/>
        <condition value="cda.sdtcStatusCode.exists().not()"/>
      </source>
      <target>
        <context value="fhir_diagnosticReport"/>
        <contextType value="variable"/>
        <element value="status"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="final"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="CdaEffectiveTimeToFhirDiagnosticReportEffective"/>
      <source>
        <context value="cda"/>
        <element value="effectiveTime"/>
        <variable value="cda_effectiveTime"/>
      </source>
      <target>
        <context value="fhir_diagnosticReport"/>
        <contextType value="variable"/>
        <element value="effective"/>
        <variable value="fhir_diagnosticReport_effective"/>
        <transform value="create"/>
        <parameter>
          <valueString value="dateTime"/>
        </parameter>
      </target>
      <dependent>
        <name value="TSDateTime"/>
        <variable value="cda_effectiveTime"/>
        <variable value="fhir_diagnosticReport_effective"/>
      </dependent>
    </rule>
    <rule>
      <name value="setId"/>
      <source>
        <context value="cda"/>
        <element value="setId"/>
        <variable value="vvv"/>
      </source>
      <target>
        <context value="fhir_diagnosticReport"/>
        <contextType value="variable"/>
        <element value="identifier"/>
        <variable value="vvv"/>
        <transform value="create"/>
      </target>
    </rule>
  </group>
  <group>
    <name value="CdaPatientRoleToFhirPatient"/>
    <typeMode value="none"/>
    <documentation value="Source: https://art-decor.org/art-decor/decor-templates--at-lab-?section=templates&amp;id=1.2.40.0.34.6.0.11.1.3&amp;effectiveDate=2020-11-24T10:03:02&amp;language=de-DE&#xd;&#xa;Target: http://hl7.at/fhir/HL7ATCoreProfiles/4.0.1/StructureDefinition/at-core-patient"/>
    <input>
      <name value="cda_patientRole"/>
      <type value="PatientRole"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="fhir_patient"/>
      <type value="Patient"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_bundle"/>
      <type value="Bundle"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="FhirPatientEuLab"/>
      <source>
        <context value="cda_patientRole"/>
      </source>
      <target>
        <context value="fhir_patient"/>
        <contextType value="variable"/>
        <element value="meta"/>
        <variable value="fhir_patient_meta"/>
      </target>
      <target>
        <context value="fhir_patient_meta"/>
        <contextType value="variable"/>
        <element value="profile"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="http://hl7.eu/fhir/laboratory/StructureDefinition/Patient-eu-lab"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="CdaLocalPatientIdToFhirPatientIdentifier"/>
      <source>
        <context value="cda_patientRole"/>
        <element value="id"/>
        <listMode value="first"/>
        <variable value="cda_patientRole_id"/>
      </source>
      <target>
        <context value="fhir_patient"/>
        <contextType value="variable"/>
        <element value="identifier"/>
        <variable value="fhir_patient_identifier"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Identifier"/>
        </parameter>
      </target>
      <rule>
        <name value="CdaIdToFhirIdentifier"/>
        <source>
          <context value="cda_patientRole_id"/>
        </source>
        <dependent>
          <name value="II"/>
          <variable value="cda_patientRole_id"/>
          <variable value="fhir_patient_identifier"/>
        </dependent>
      </rule>
      <rule>
        <name value="FhirPatientIdentifierTypeCodingPI"/>
        <source>
          <context value="cda_patientRole_id"/>
        </source>
        <target>
          <context value="fhir_patient_identifier"/>
          <contextType value="variable"/>
          <element value="type"/>
          <variable value="identifier_type"/>
        </target>
        <target>
          <context value="identifier_type"/>
          <contextType value="variable"/>
          <element value="coding"/>
          <variable value="type_coding"/>
        </target>
        <target>
          <context value="type_coding"/>
          <contextType value="variable"/>
          <element value="system"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="http://terminology.hl7.org/CodeSystem/v2-0203"/>
          </parameter>
        </target>
        <target>
          <context value="type_coding"/>
          <contextType value="variable"/>
          <element value="code"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="PI"/>
          </parameter>
        </target>
        <target>
          <context value="type_coding"/>
          <contextType value="variable"/>
          <element value="display"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="Patient internal identifier"/>
          </parameter>
        </target>
      </rule>
    </rule>
    <rule>
      <name value="CdaPatientIdToFhirPatientIdentifier"/>
      <source>
        <context value="cda_patientRole"/>
        <element value="id"/>
        <listMode value="not_first"/>
        <variable value="cda_patientRole_id"/>
      </source>
      <target>
        <context value="fhir_patient"/>
        <contextType value="variable"/>
        <element value="identifier"/>
        <variable value="fhir_patient_identifier"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Identifier"/>
        </parameter>
      </target>
      <rule>
        <name value="CdaIdToFhirIdentifier"/>
        <source>
          <context value="cda_patientRole_id"/>
        </source>
        <dependent>
          <name value="II"/>
          <variable value="cda_patientRole_id"/>
          <variable value="fhir_patient_identifier"/>
        </dependent>
      </rule>
      <rule>
        <name value="FhirPatientIdentifierTypeCodingSS"/>
        <source>
          <context value="cda_patientRole_id"/>
          <condition value="(cda_patientRole_id.root = '1.2.40.0.10.1.4.3.1')"/>
        </source>
        <target>
          <context value="fhir_patient_identifier"/>
          <contextType value="variable"/>
          <element value="assigner"/>
          <variable value="assigner"/>
        </target>
        <target>
          <context value="assigner"/>
          <contextType value="variable"/>
          <element value="display"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="Dachverband der österreichischen Sozialversicherungsträger"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_patient_identifier"/>
          <contextType value="variable"/>
          <element value="type"/>
          <variable value="identifier_type"/>
        </target>
        <target>
          <context value="identifier_type"/>
          <contextType value="variable"/>
          <element value="coding"/>
          <variable value="type_coding"/>
        </target>
        <target>
          <context value="type_coding"/>
          <contextType value="variable"/>
          <element value="system"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="http://terminology.hl7.org/CodeSystem/v2-0203"/>
          </parameter>
        </target>
        <target>
          <context value="type_coding"/>
          <contextType value="variable"/>
          <element value="code"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="SS"/>
          </parameter>
        </target>
        <target>
          <context value="type_coding"/>
          <contextType value="variable"/>
          <element value="display"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="Social Security Number"/>
          </parameter>
        </target>
      </rule>
      <rule>
        <name value="FhirPatientIdentifierTypeCodingNI"/>
        <source>
          <context value="cda_patientRole_id"/>
          <condition value="(cda_patientRole_id.root = '1.2.40.0.10.2.1.1.149')"/>
        </source>
        <target>
          <context value="fhir_patient_identifier"/>
          <contextType value="variable"/>
          <element value="assigner"/>
          <variable value="assigner"/>
        </target>
        <target>
          <context value="assigner"/>
          <contextType value="variable"/>
          <element value="display"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="Bundesministerium für Inneres"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_patient_identifier"/>
          <contextType value="variable"/>
          <element value="type"/>
          <variable value="identifier_type"/>
        </target>
        <target>
          <context value="identifier_type"/>
          <contextType value="variable"/>
          <element value="coding"/>
          <variable value="type_coding"/>
        </target>
        <target>
          <context value="type_coding"/>
          <contextType value="variable"/>
          <element value="system"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="http://terminology.hl7.org/CodeSystem/v2-0203"/>
          </parameter>
        </target>
        <target>
          <context value="type_coding"/>
          <contextType value="variable"/>
          <element value="code"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="NI"/>
          </parameter>
        </target>
        <target>
          <context value="type_coding"/>
          <contextType value="variable"/>
          <element value="display"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="National unique individual identifier"/>
          </parameter>
        </target>
      </rule>
    </rule>
    <rule>
      <name value="addr"/>
      <source>
        <context value="cda_patientRole"/>
        <element value="addr"/>
        <variable value="vvv"/>
      </source>
      <target>
        <context value="fhir_patient"/>
        <contextType value="variable"/>
        <element value="address"/>
        <variable value="vvv"/>
        <transform value="create"/>
      </target>
    </rule>
    <rule>
      <name value="telecom"/>
      <source>
        <context value="cda_patientRole"/>
        <element value="telecom"/>
        <variable value="vvv"/>
      </source>
      <target>
        <context value="fhir_patient"/>
        <contextType value="variable"/>
        <element value="telecom"/>
        <variable value="vvv"/>
        <transform value="create"/>
      </target>
    </rule>
    <rule>
      <name value="CdaPatientToFhirPatient"/>
      <source>
        <context value="cda_patientRole"/>
        <element value="patient"/>
        <variable value="cda_patient"/>
      </source>
      <rule>
        <name value="name"/>
        <source>
          <context value="cda_patient"/>
          <element value="name"/>
          <variable value="vvv"/>
        </source>
        <target>
          <context value="fhir_patient"/>
          <contextType value="variable"/>
          <element value="name"/>
          <variable value="vvv"/>
          <transform value="create"/>
        </target>
      </rule>
      <rule>
        <name value="CdaPatientGenderToFhirPatientGender"/>
        <source>
          <context value="cda_patient"/>
          <element value="administrativeGenderCode"/>
          <variable value="cda_patient_gender"/>
        </source>
        <rule>
          <name value="CdaPatientGenderCodeToFhirPatientGenderCode"/>
          <source>
            <context value="cda_patient_gender"/>
            <element value="code"/>
            <variable value="cda_patient_gender_code"/>
          </source>
          <target>
            <context value="fhir_patient"/>
            <contextType value="variable"/>
            <element value="gender"/>
            <transform value="translate"/>
            <parameter>
              <valueId value="cda_patient_gender_code"/>
            </parameter>
            <parameter>
              <valueString value="#ELGAAdministrativeGenderFHIRGender"/>
            </parameter>
            <parameter>
              <valueString value="code"/>
            </parameter>
          </target>
        </rule>
      </rule>
      <rule>
        <name value="birthTime"/>
        <source>
          <context value="cda_patient"/>
          <element value="birthTime"/>
          <variable value="vvv"/>
        </source>
        <target>
          <context value="fhir_patient"/>
          <contextType value="variable"/>
          <element value="birthDate"/>
          <variable value="vvv"/>
          <transform value="create"/>
        </target>
      </rule>
      <rule>
        <name value="CdaPatientBirthTimeToFhirPatientBirthTimeExtension"/>
        <source>
          <context value="cda_patient"/>
          <element value="birthTime"/>
          <variable value="cda_patient_birthTime"/>
          <condition value="(cda_patient.birthTime.value.toString().length() > 10)"/>
        </source>
        <target>
          <context value="fhir_patient"/>
          <contextType value="variable"/>
          <element value="birthDate"/>
          <variable value="fhir_patient_birthDate"/>
        </target>
        <target>
          <context value="fhir_patient_birthDate"/>
          <contextType value="variable"/>
          <element value="extension"/>
          <variable value="extension"/>
        </target>
        <target>
          <context value="extension"/>
          <contextType value="variable"/>
          <element value="url"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="http://hl7.org/fhir/StructureDefinition/patient-birthTime"/>
          </parameter>
        </target>
        <target>
          <context value="extension"/>
          <contextType value="variable"/>
          <element value="value"/>
          <variable value="fhir_patient_birthTime_dateTime"/>
          <transform value="create"/>
          <parameter>
            <valueString value="dateTime"/>
          </parameter>
        </target>
        <dependent>
          <name value="TSDateTime"/>
          <variable value="cda_patient_birthTime"/>
          <variable value="fhir_patient_birthTime_dateTime"/>
        </dependent>
      </rule>
      <rule>
        <name value="CdaPatientDeceasedIndToFhirPatientDeceasedBoolean"/>
        <source>
          <context value="cda_patient"/>
          <element value="sdtcDeceasedInd"/>
          <variable value="cda_patient_deceasedInd"/>
          <condition value="cda_patient.sdtcDeceasedTime.empty()"/>
        </source>
        <target>
          <context value="fhir_patient"/>
          <contextType value="variable"/>
          <element value="deceased"/>
          <variable value="fhir_patient_deceased"/>
          <transform value="create"/>
          <parameter>
            <valueString value="boolean"/>
          </parameter>
        </target>
        <dependent>
          <name value="BL"/>
          <variable value="cda_patient_deceasedInd"/>
          <variable value="fhir_patient_deceased"/>
        </dependent>
      </rule>
      <rule>
        <name value="CdaPatientDeceasedTimeToFhirPatientDeceasedDateTime"/>
        <source>
          <context value="cda_patient"/>
          <element value="sdtcDeceasedTime"/>
          <variable value="cda_patient_deceasedTime"/>
        </source>
        <target>
          <context value="fhir_patient"/>
          <contextType value="variable"/>
          <element value="deceased"/>
          <variable value="fhir_patient_deceased"/>
          <transform value="create"/>
          <parameter>
            <valueString value="dateTime"/>
          </parameter>
        </target>
        <dependent>
          <name value="TSDateTime"/>
          <variable value="cda_patient_deceasedTime"/>
          <variable value="fhir_patient_deceased"/>
        </dependent>
      </rule>
      <rule>
        <name value="maritalStatusCode"/>
        <source>
          <context value="cda_patient"/>
          <element value="maritalStatusCode"/>
          <variable value="vvv"/>
        </source>
        <target>
          <context value="fhir_patient"/>
          <contextType value="variable"/>
          <element value="maritalStatus"/>
          <variable value="vvv"/>
          <transform value="create"/>
        </target>
      </rule>
      <rule>
        <name value="CdaPatientReligiousAffiliationCodeToFhirPatientReligionExtension"/>
        <source>
          <context value="cda_patient"/>
          <element value="religiousAffiliationCode"/>
          <variable value="cda_patient_religiousAffiliationCode"/>
        </source>
        <target>
          <context value="fhir_patient"/>
          <contextType value="variable"/>
          <element value="extension"/>
          <variable value="religion_extension"/>
        </target>
        <target>
          <context value="religion_extension"/>
          <contextType value="variable"/>
          <element value="url"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="http://hl7.org/fhir/StructureDefinition/patient-religion"/>
          </parameter>
        </target>
        <target>
          <context value="religion_extension"/>
          <contextType value="variable"/>
          <element value="value"/>
          <variable value="religion_extension_codeableConcept"/>
          <transform value="create"/>
          <parameter>
            <valueString value="CodeableConcept"/>
          </parameter>
        </target>
        <dependent>
          <name value="CECodeableConcept"/>
          <variable value="cda_patient_religiousAffiliationCode"/>
          <variable value="religion_extension_codeableConcept"/>
        </dependent>
      </rule>
      <rule>
        <name value="CdaPatientGuardianToFhirPatientContact"/>
        <source>
          <context value="cda_patient"/>
          <element value="guardian"/>
          <variable value="cda_patient_guardian"/>
        </source>
        <target>
          <context value="fhir_patient"/>
          <contextType value="variable"/>
          <element value="contact"/>
          <variable value="fhir_patient_contact"/>
        </target>
        <rule>
          <name value="addr"/>
          <source>
            <context value="cda_patient_guardian"/>
            <element value="addr"/>
            <variable value="vvv"/>
          </source>
          <target>
            <context value="fhir_patient_contact"/>
            <contextType value="variable"/>
            <element value="address"/>
            <variable value="vvv"/>
            <transform value="create"/>
          </target>
        </rule>
        <rule>
          <name value="telecom"/>
          <source>
            <context value="cda_patient_guardian"/>
            <element value="telecom"/>
            <variable value="vvv"/>
          </source>
          <target>
            <context value="fhir_patient_contact"/>
            <contextType value="variable"/>
            <element value="telecom"/>
            <variable value="vvv"/>
            <transform value="create"/>
          </target>
        </rule>
        <rule>
          <name value="CdaPatientGuardianPersonToFhirPatientContactName"/>
          <source>
            <context value="cda_patient_guardian"/>
            <element value="guardianPerson"/>
            <variable value="cda_guardian_person"/>
          </source>
          <rule>
            <name value="name"/>
            <source>
              <context value="cda_guardian_person"/>
              <element value="name"/>
              <variable value="vvv"/>
            </source>
            <target>
              <context value="fhir_patient_contact"/>
              <contextType value="variable"/>
              <element value="name"/>
              <variable value="vvv"/>
              <transform value="create"/>
            </target>
          </rule>
        </rule>
        <rule>
          <name value="CdaPatientGuardianOrganizationToFhirPatientContactOrganization"/>
          <source>
            <context value="cda_patient_guardian"/>
            <element value="guardianOrganization"/>
            <variable value="cda_guardian_organization"/>
          </source>
          <rule>
            <name value="CdaPatientGuardianOrganizationNameToFhirContactOrganizationReference"/>
            <source>
              <context value="cda_guardian_organization"/>
              <element value="name"/>
              <variable value="cda_organization_name"/>
            </source>
            <target>
              <context value="fhir_bundle"/>
              <contextType value="variable"/>
              <element value="entry"/>
              <variable value="fhir_bundle_entry"/>
            </target>
            <target>
              <context value="fhir_bundle_entry"/>
              <contextType value="variable"/>
              <element value="resource"/>
              <variable value="fhir_contact_organization"/>
              <transform value="create"/>
              <parameter>
                <valueString value="Organization"/>
              </parameter>
            </target>
            <target>
              <context value="fhir_contact_organization"/>
              <contextType value="variable"/>
              <element value="id"/>
              <variable value="fhir_contact_organization_id"/>
              <transform value="uuid"/>
            </target>
            <target>
              <context value="fhir_contact_organization"/>
              <contextType value="variable"/>
              <element value="name"/>
              <transform value="evaluate"/>
              <parameter>
                <valueString value="cda_organization_name.item.xmlText"/>
              </parameter>
            </target>
            <target>
              <context value="fhir_bundle_entry"/>
              <contextType value="variable"/>
              <element value="fullUrl"/>
              <transform value="append"/>
              <parameter>
                <valueString value="urn:uuid:"/>
              </parameter>
              <parameter>
                <valueId value="fhir_contact_organization_id"/>
              </parameter>
            </target>
            <target>
              <context value="fhir_patient_contact"/>
              <contextType value="variable"/>
              <element value="organization"/>
              <variable value="fhir_contact_organization_reference"/>
              <transform value="create"/>
              <parameter>
                <valueString value="Reference"/>
              </parameter>
            </target>
            <target>
              <context value="fhir_contact_organization_reference"/>
              <contextType value="variable"/>
              <element value="reference"/>
              <transform value="append"/>
              <parameter>
                <valueString value="urn:uuid:"/>
              </parameter>
              <parameter>
                <valueId value="fhir_contact_organization_id"/>
              </parameter>
            </target>
          </rule>
        </rule>
      </rule>
      <rule>
        <name value="CdaPatientBirthplaceToFhirPatientBirthplaceExtension"/>
        <source>
          <context value="cda_patient"/>
          <element value="birthplace"/>
          <variable value="cda_patient_birthplace"/>
        </source>
        <rule>
          <name value="place"/>
          <source>
            <context value="cda_patient_birthplace"/>
            <element value="place"/>
            <variable value="cda_patient_place"/>
          </source>
          <rule>
            <name value="CdaPatientBirthplaceAddrToFhirPatientBirthplaceExtensionValue"/>
            <source>
              <context value="cda_patient_place"/>
              <element value="addr"/>
              <variable value="cda_patient_birthaddr"/>
            </source>
            <target>
              <context value="fhir_patient"/>
              <contextType value="variable"/>
              <element value="extension"/>
              <variable value="birthplace_extension"/>
            </target>
            <target>
              <context value="birthplace_extension"/>
              <contextType value="variable"/>
              <element value="url"/>
              <transform value="copy"/>
              <parameter>
                <valueString value="http://hl7.org/fhir/StructureDefinition/patient-birthPlace"/>
              </parameter>
            </target>
            <target>
              <context value="birthplace_extension"/>
              <contextType value="variable"/>
              <element value="value"/>
              <variable value="birthplace_extension_addr"/>
              <transform value="create"/>
              <parameter>
                <valueString value="Address"/>
              </parameter>
            </target>
            <dependent>
              <name value="CdaAdressCompilationToFhirAustrianAddress"/>
              <variable value="cda_patient_birthaddr"/>
              <variable value="birthplace_extension_addr"/>
            </dependent>
          </rule>
        </rule>
      </rule>
      <rule>
        <name value="CdaPatientLanguageCommunicationToFhirPatientCommunication"/>
        <source>
          <context value="cda_patient"/>
          <element value="languageCommunication"/>
          <variable value="cda_patient_language"/>
        </source>
        <target>
          <context value="fhir_patient"/>
          <contextType value="variable"/>
          <element value="communication"/>
          <variable value="fhir_patient_communication"/>
        </target>
        <rule>
          <name value="languageCode"/>
          <source>
            <context value="cda_patient_language"/>
            <element value="languageCode"/>
            <variable value="cda_patient_languageCode"/>
          </source>
          <rule>
            <name value="CdaPatientLanguageToFhirPatientLanguage"/>
            <source>
              <context value="cda_patient_languageCode"/>
              <element value="code"/>
              <variable value="cda_patient_languageCode_code"/>
            </source>
            <target>
              <context value="fhir_patient_communication"/>
              <contextType value="variable"/>
              <element value="language"/>
              <variable value="fhir_patient_communication_language"/>
            </target>
            <target>
              <context value="fhir_patient_communication_language"/>
              <contextType value="variable"/>
              <element value="coding"/>
              <variable value="fhir_patient_communication_language_coding"/>
            </target>
            <target>
              <context value="fhir_patient_communication_language_coding"/>
              <contextType value="variable"/>
              <element value="system"/>
              <transform value="copy"/>
              <parameter>
                <valueString value="urn:ietf:bcp:47"/>
              </parameter>
            </target>
            <target>
              <context value="fhir_patient_communication_language_coding"/>
              <contextType value="variable"/>
              <element value="code"/>
              <transform value="copy"/>
              <parameter>
                <valueId value="cda_patient_languageCode_code"/>
              </parameter>
            </target>
          </rule>
        </rule>
        <rule>
          <name value="preferenceInd"/>
          <source>
            <context value="cda_patient_language"/>
            <element value="preferenceInd"/>
            <variable value="vvv"/>
          </source>
          <target>
            <context value="fhir_patient_communication"/>
            <contextType value="variable"/>
            <element value="preferred"/>
            <variable value="vvv"/>
            <transform value="create"/>
          </target>
        </rule>
        <rule>
          <name value="CdaPatientLanguageProficiencyToFhirPatientCommunicationProficiencyExtension"/>
          <source>
            <context value="cda_patient_language"/>
            <condition value="cda_patient_language.modeCode.exists() or cda_patient_language.proficiencyLevelCode.exists()"/>
          </source>
          <target>
            <context value="fhir_patient_communication"/>
            <contextType value="variable"/>
            <element value="extension"/>
            <variable value="communication_extension"/>
          </target>
          <target>
            <context value="communication_extension"/>
            <contextType value="variable"/>
            <element value="url"/>
            <transform value="copy"/>
            <parameter>
              <valueString value="http://hl7.org/fhir/StructureDefinition/patient-proficiency"/>
            </parameter>
          </target>
          <rule>
            <name value="CdaLanguageModeCodeToFhirProficiencyType"/>
            <source>
              <context value="cda_patient_language"/>
              <element value="modeCode"/>
              <variable value="cda_patient_language_modeCode"/>
            </source>
            <target>
              <context value="communication_extension"/>
              <contextType value="variable"/>
              <element value="extension"/>
              <variable value="communication_extension_type"/>
            </target>
            <target>
              <context value="communication_extension_type"/>
              <contextType value="variable"/>
              <element value="url"/>
              <transform value="copy"/>
              <parameter>
                <valueString value="type"/>
              </parameter>
            </target>
            <target>
              <context value="communication_extension_type"/>
              <contextType value="variable"/>
              <element value="value"/>
              <variable value="communication_extension_type_coding"/>
              <transform value="create"/>
              <parameter>
                <valueString value="Coding"/>
              </parameter>
            </target>
            <dependent>
              <name value="CECoding"/>
              <variable value="cda_patient_language_modeCode"/>
              <variable value="communication_extension_type_coding"/>
            </dependent>
          </rule>
          <rule>
            <name value="CdaLanguageProficiencyLevelToFhirProficiencyLevel"/>
            <source>
              <context value="cda_patient_language"/>
              <element value="proficiencyLevelCode"/>
              <variable value="cda_patient_language_proficiencyLevelCode"/>
            </source>
            <target>
              <context value="communication_extension"/>
              <contextType value="variable"/>
              <element value="extension"/>
              <variable value="communication_extension_level"/>
            </target>
            <target>
              <context value="communication_extension_level"/>
              <contextType value="variable"/>
              <element value="url"/>
              <transform value="copy"/>
              <parameter>
                <valueString value="level"/>
              </parameter>
            </target>
            <target>
              <context value="communication_extension_level"/>
              <contextType value="variable"/>
              <element value="value"/>
              <variable value="communication_extension_level_coding"/>
              <transform value="create"/>
              <parameter>
                <valueString value="Coding"/>
              </parameter>
            </target>
            <dependent>
              <name value="CECoding"/>
              <variable value="cda_patient_language_proficiencyLevelCode"/>
              <variable value="communication_extension_level_coding"/>
            </dependent>
          </rule>
        </rule>
      </rule>
    </rule>
  </group>
  <group>
    <name value="CdaAuthorToFhirPractitionerRole"/>
    <typeMode value="none"/>
    <documentation value="Source: https://art-decor.org/art-decor/decor-templates--at-lab-?section=templates&amp;id=1.2.40.0.34.6.0.11.1.2&amp;effectiveDate=2021-08-24T08:35:56&amp;language=de-DE&#xd;&#xa;Target: http://hl7.org/fhir/practitionerrole.html&#xd;&#xa;http://hl7.org/fhir/practitioner.html"/>
    <input>
      <name value="cda_author"/>
      <type value="Author"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="fhir_practitionerRole"/>
      <type value="PractitionerRole"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_bundle"/>
      <type value="Bundle"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="CdaAuthorToFhirPractitionerRole"/>
      <source>
        <context value="cda_author"/>
      </source>
      <target>
        <context value="fhir_bundle"/>
        <contextType value="variable"/>
        <element value="entry"/>
        <variable value="fhir_bundle_entry"/>
      </target>
      <target>
        <context value="fhir_bundle_entry"/>
        <contextType value="variable"/>
        <element value="resource"/>
        <variable value="fhir_practitioner"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Practitioner"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_practitioner"/>
        <contextType value="variable"/>
        <element value="id"/>
        <variable value="fhir_practitioner_id"/>
        <transform value="uuid"/>
      </target>
      <target>
        <context value="fhir_bundle_entry"/>
        <contextType value="variable"/>
        <element value="fullUrl"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_practitioner_id"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_practitionerRole"/>
        <contextType value="variable"/>
        <element value="practitioner"/>
        <variable value="fhir_practitionerRole_practitioner_reference"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Reference"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_practitionerRole_practitioner_reference"/>
        <contextType value="variable"/>
        <element value="reference"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_practitioner_id"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_practitionerRole_practitioner_reference"/>
        <contextType value="variable"/>
        <element value="type"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="Practitioner"/>
        </parameter>
      </target>
      <rule>
        <name value="functionCode"/>
        <source>
          <context value="cda_author"/>
          <element value="functionCode"/>
          <variable value="vvv"/>
        </source>
        <target>
          <context value="fhir_practitionerRole"/>
          <contextType value="variable"/>
          <element value="code"/>
          <variable value="vvv"/>
          <transform value="create"/>
        </target>
      </rule>
      <rule>
        <name value="assignedAuthor"/>
        <source>
          <context value="cda_author"/>
          <element value="assignedAuthor"/>
          <variable value="cda_author_assignedAuthor"/>
        </source>
        <rule>
          <name value="id"/>
          <source>
            <context value="cda_author_assignedAuthor"/>
            <element value="id"/>
            <variable value="vvv"/>
          </source>
          <target>
            <context value="fhir_practitioner"/>
            <contextType value="variable"/>
            <element value="identifier"/>
            <variable value="vvv"/>
            <transform value="create"/>
          </target>
        </rule>
        <rule>
          <name value="code"/>
          <source>
            <context value="cda_author_assignedAuthor"/>
            <element value="code"/>
            <variable value="cda_author_assignedAuthor_code"/>
          </source>
          <target>
            <context value="fhir_practitioner"/>
            <contextType value="variable"/>
            <element value="qualification"/>
            <variable value="fhir_practitioner_qualification"/>
          </target>
          <target>
            <context value="fhir_practitioner_qualification"/>
            <contextType value="variable"/>
            <element value="code"/>
            <variable value="fhir_practitioner_qualification_code"/>
          </target>
          <dependent>
            <name value="CECodeableConcept"/>
            <variable value="cda_author_assignedAuthor_code"/>
            <variable value="fhir_practitioner_qualification_code"/>
          </dependent>
        </rule>
        <rule>
          <name value="telecom"/>
          <source>
            <context value="cda_author_assignedAuthor"/>
            <element value="telecom"/>
            <variable value="vvv"/>
          </source>
          <target>
            <context value="fhir_practitioner"/>
            <contextType value="variable"/>
            <element value="telecom"/>
            <variable value="vvv"/>
            <transform value="create"/>
          </target>
        </rule>
        <rule>
          <name value="assignedPerson"/>
          <source>
            <context value="cda_author_assignedAuthor"/>
            <element value="assignedPerson"/>
            <variable value="cda_assignedPerson"/>
          </source>
          <rule>
            <name value="name"/>
            <source>
              <context value="cda_assignedPerson"/>
              <element value="name"/>
              <variable value="vvv"/>
            </source>
            <target>
              <context value="fhir_practitioner"/>
              <contextType value="variable"/>
              <element value="name"/>
              <variable value="vvv"/>
              <transform value="create"/>
            </target>
          </rule>
        </rule>
        <rule>
          <name value="representedOrganization"/>
          <source>
            <context value="cda_author_assignedAuthor"/>
            <element value="representedOrganization"/>
            <variable value="cda_representedOrganization"/>
          </source>
          <target>
            <context value="fhir_bundle"/>
            <contextType value="variable"/>
            <element value="entry"/>
            <variable value="fhir_bundle_entry"/>
          </target>
          <target>
            <context value="fhir_bundle_entry"/>
            <contextType value="variable"/>
            <element value="resource"/>
            <variable value="fhir_organization"/>
            <transform value="create"/>
            <parameter>
              <valueString value="Organization"/>
            </parameter>
          </target>
          <target>
            <context value="fhir_organization"/>
            <contextType value="variable"/>
            <element value="id"/>
            <variable value="fhir_organization_id"/>
            <transform value="uuid"/>
          </target>
          <target>
            <context value="fhir_bundle_entry"/>
            <contextType value="variable"/>
            <element value="fullUrl"/>
            <transform value="append"/>
            <parameter>
              <valueString value="urn:uuid:"/>
            </parameter>
            <parameter>
              <valueId value="fhir_organization_id"/>
            </parameter>
          </target>
          <target>
            <context value="fhir_practitionerRole"/>
            <contextType value="variable"/>
            <element value="organization"/>
            <variable value="fhir_practitionerRole_organization"/>
            <transform value="create"/>
            <parameter>
              <valueString value="Reference"/>
            </parameter>
          </target>
          <target>
            <context value="fhir_practitionerRole_organization"/>
            <contextType value="variable"/>
            <element value="reference"/>
            <transform value="append"/>
            <parameter>
              <valueString value="urn:uuid:"/>
            </parameter>
            <parameter>
              <valueId value="fhir_organization_id"/>
            </parameter>
          </target>
          <target>
            <context value="fhir_practitionerRole_organization"/>
            <contextType value="variable"/>
            <element value="type"/>
            <transform value="copy"/>
            <parameter>
              <valueString value="Organization"/>
            </parameter>
          </target>
          <dependent>
            <name value="CdaOrganizationCompilationToFhirOrganization"/>
            <variable value="cda_representedOrganization"/>
            <variable value="fhir_organization"/>
          </dependent>
        </rule>
      </rule>
    </rule>
  </group>
  <group>
    <name value="CdaAuthorToFhirDevice"/>
    <typeMode value="none"/>
    <documentation value="Source: https://art-decor.org/art-decor/decor-templates--at-lab-?section=templates&amp;id=1.2.40.0.34.6.0.11.1.2&amp;effectiveDate=2021-08-24T08:35:56&amp;language=de-DE&#xd;&#xa;Target: http://hl7.org/fhir/device.html"/>
    <input>
      <name value="cda_author"/>
      <type value="Author"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="fhir_device"/>
      <type value="Device"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_bundle"/>
      <type value="Bundle"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="functionCode"/>
      <source>
        <context value="cda_author"/>
        <element value="functionCode"/>
        <variable value="vvv"/>
      </source>
      <target>
        <context value="fhir_device"/>
        <contextType value="variable"/>
        <element value="type"/>
        <variable value="vvv"/>
        <transform value="create"/>
      </target>
    </rule>
    <rule>
      <name value="assignedAuthor"/>
      <source>
        <context value="cda_author"/>
        <element value="assignedAuthor"/>
        <variable value="cda_author_assignedAuthor"/>
      </source>
      <rule>
        <name value="id"/>
        <source>
          <context value="cda_author_assignedAuthor"/>
          <element value="id"/>
          <variable value="vvv"/>
        </source>
        <target>
          <context value="fhir_device"/>
          <contextType value="variable"/>
          <element value="identifier"/>
          <variable value="vvv"/>
          <transform value="create"/>
        </target>
      </rule>
      <rule>
        <name value="telecom"/>
        <source>
          <context value="cda_author_assignedAuthor"/>
          <element value="telecom"/>
          <variable value="vvv"/>
        </source>
        <target>
          <context value="fhir_device"/>
          <contextType value="variable"/>
          <element value="contact"/>
          <variable value="vvv"/>
          <transform value="create"/>
        </target>
      </rule>
      <rule>
        <name value="assignedAuthoringDevice"/>
        <source>
          <context value="cda_author_assignedAuthor"/>
          <element value="assignedAuthoringDevice"/>
          <variable value="cda_assignedAuthoringDevice"/>
        </source>
        <rule>
          <name value="manufacturerModelName"/>
          <source>
            <context value="cda_assignedAuthoringDevice"/>
            <element value="manufacturerModelName"/>
            <variable value="cda_manufacturerModelName"/>
          </source>
          <target>
            <context value="fhir_device"/>
            <contextType value="variable"/>
            <element value="deviceName"/>
            <variable value="fhir_device_deviceName"/>
          </target>
          <target>
            <context value="fhir_device_deviceName"/>
            <contextType value="variable"/>
            <element value="name"/>
            <transform value="evaluate"/>
            <parameter>
              <valueString value="cda_manufacturerModelName.xmlText"/>
            </parameter>
          </target>
          <target>
            <context value="fhir_device_deviceName"/>
            <contextType value="variable"/>
            <element value="type"/>
            <transform value="copy"/>
            <parameter>
              <valueString value="model-name"/>
            </parameter>
          </target>
        </rule>
        <rule>
          <name value="softwareName"/>
          <source>
            <context value="cda_assignedAuthoringDevice"/>
            <element value="softwareName"/>
            <variable value="cda_softwareName"/>
          </source>
          <target>
            <context value="fhir_device"/>
            <contextType value="variable"/>
            <element value="deviceName"/>
            <variable value="fhir_device_deviceName"/>
          </target>
          <target>
            <context value="fhir_device_deviceName"/>
            <contextType value="variable"/>
            <element value="name"/>
            <transform value="evaluate"/>
            <parameter>
              <valueString value="cda_softwareName.xmlText"/>
            </parameter>
          </target>
          <target>
            <context value="fhir_device_deviceName"/>
            <contextType value="variable"/>
            <element value="type"/>
            <transform value="copy"/>
            <parameter>
              <valueString value="other"/>
            </parameter>
          </target>
        </rule>
      </rule>
      <rule>
        <name value="representedOrganization"/>
        <source>
          <context value="cda_author_assignedAuthor"/>
          <element value="representedOrganization"/>
          <variable value="cda_representedOrganization"/>
        </source>
        <target>
          <context value="fhir_bundle"/>
          <contextType value="variable"/>
          <element value="entry"/>
          <variable value="fhir_bundle_entry"/>
        </target>
        <target>
          <context value="fhir_bundle_entry"/>
          <contextType value="variable"/>
          <element value="resource"/>
          <variable value="fhir_organization"/>
          <transform value="create"/>
          <parameter>
            <valueString value="Organization"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_organization"/>
          <contextType value="variable"/>
          <element value="id"/>
          <variable value="fhir_organization_id"/>
          <transform value="uuid"/>
        </target>
        <target>
          <context value="fhir_bundle_entry"/>
          <contextType value="variable"/>
          <element value="fullUrl"/>
          <transform value="append"/>
          <parameter>
            <valueString value="urn:uuid:"/>
          </parameter>
          <parameter>
            <valueId value="fhir_organization_id"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_device"/>
          <contextType value="variable"/>
          <element value="owner"/>
          <variable value="fhir_device_owner"/>
          <transform value="create"/>
          <parameter>
            <valueString value="Reference"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_device_owner"/>
          <contextType value="variable"/>
          <element value="reference"/>
          <transform value="append"/>
          <parameter>
            <valueString value="urn:uuid:"/>
          </parameter>
          <parameter>
            <valueId value="fhir_organization_id"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_device_owner"/>
          <contextType value="variable"/>
          <element value="type"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="Organization"/>
          </parameter>
        </target>
        <dependent>
          <name value="CdaOrganizationCompilationToFhirOrganization"/>
          <variable value="cda_representedOrganization"/>
          <variable value="fhir_organization"/>
        </dependent>
      </rule>
    </rule>
  </group>
  <group>
    <name value="CdaEncompassingEncounterToFhirEncounter"/>
    <typeMode value="none"/>
    <input>
      <name value="cda_encompassingEncounter"/>
      <type value="EncompassingEncounter"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="fhir_encounter"/>
      <type value="Encounter"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_bundle"/>
      <type value="Bundle"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="id"/>
      <source>
        <context value="cda_encompassingEncounter"/>
        <element value="id"/>
        <variable value="vvv"/>
      </source>
      <target>
        <context value="fhir_encounter"/>
        <contextType value="variable"/>
        <element value="identifier"/>
        <variable value="vvv"/>
        <transform value="create"/>
      </target>
    </rule>
    <rule>
      <name value="FhirEncounterStatus"/>
      <source>
        <context value="cda_encompassingEncounter"/>
      </source>
      <target>
        <context value="fhir_encounter"/>
        <contextType value="variable"/>
        <element value="status"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="finished"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="code"/>
      <source>
        <context value="cda_encompassingEncounter"/>
        <element value="code"/>
        <variable value="vvv"/>
      </source>
      <target>
        <context value="fhir_encounter"/>
        <contextType value="variable"/>
        <element value="class"/>
        <variable value="vvv"/>
        <transform value="create"/>
      </target>
    </rule>
    <rule>
      <name value="effectiveTime"/>
      <source>
        <context value="cda_encompassingEncounter"/>
        <element value="effectiveTime"/>
        <variable value="vvv"/>
      </source>
      <target>
        <context value="fhir_encounter"/>
        <contextType value="variable"/>
        <element value="period"/>
        <variable value="vvv"/>
        <transform value="create"/>
      </target>
    </rule>
    <rule>
      <name value="responsibleParty"/>
      <source>
        <context value="cda_encompassingEncounter"/>
        <element value="responsibleParty"/>
        <variable value="cda_responsibleParty"/>
      </source>
      <rule>
        <name value="assignedEntity"/>
        <source>
          <context value="cda_responsibleParty"/>
          <element value="assignedEntity"/>
          <variable value="cda_assignedEntity"/>
        </source>
        <target>
          <context value="fhir_encounter"/>
          <contextType value="variable"/>
          <element value="participant"/>
          <variable value="fhir_encounter_participant"/>
        </target>
        <target>
          <context value="fhir_bundle"/>
          <contextType value="variable"/>
          <element value="entry"/>
          <variable value="fhir_bundle_entry"/>
        </target>
        <target>
          <context value="fhir_bundle_entry"/>
          <contextType value="variable"/>
          <element value="resource"/>
          <variable value="fhir_practitionerRole"/>
          <transform value="create"/>
          <parameter>
            <valueString value="PractitionerRole"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_practitionerRole"/>
          <contextType value="variable"/>
          <element value="id"/>
          <variable value="fhir_practitionerRole_id"/>
          <transform value="uuid"/>
        </target>
        <target>
          <context value="fhir_bundle_entry"/>
          <contextType value="variable"/>
          <element value="fullUrl"/>
          <transform value="append"/>
          <parameter>
            <valueString value="urn:uuid:"/>
          </parameter>
          <parameter>
            <valueId value="fhir_practitionerRole_id"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_encounter_participant"/>
          <contextType value="variable"/>
          <element value="individual"/>
          <variable value="fhir_practitionerRole_reference"/>
          <transform value="create"/>
          <parameter>
            <valueString value="Reference"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_practitionerRole_reference"/>
          <contextType value="variable"/>
          <element value="reference"/>
          <transform value="append"/>
          <parameter>
            <valueString value="urn:uuid:"/>
          </parameter>
          <parameter>
            <valueId value="fhir_practitionerRole_id"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_practitionerRole_reference"/>
          <contextType value="variable"/>
          <element value="type"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="PractitionerRole"/>
          </parameter>
        </target>
        <dependent>
          <name value="CdaAssignedEntityToFhirPractitionerRole"/>
          <variable value="cda_assignedEntity"/>
          <variable value="fhir_practitionerRole"/>
          <variable value="fhir_bundle"/>
        </dependent>
      </rule>
    </rule>
    <rule>
      <name value="location"/>
      <source>
        <context value="cda_encompassingEncounter"/>
        <element value="location"/>
        <variable value="cda_location"/>
      </source>
      <rule>
        <name value="healthCareFacility"/>
        <source>
          <context value="cda_location"/>
          <element value="healthCareFacility"/>
          <variable value="cda_healthCareFacility"/>
        </source>
        <target>
          <context value="fhir_encounter"/>
          <contextType value="variable"/>
          <element value="location"/>
          <variable value="fhir_encounter_location"/>
        </target>
        <target>
          <context value="fhir_bundle"/>
          <contextType value="variable"/>
          <element value="entry"/>
          <variable value="fhir_bundle_entry"/>
        </target>
        <target>
          <context value="fhir_bundle_entry"/>
          <contextType value="variable"/>
          <element value="resource"/>
          <variable value="fhir_location"/>
          <transform value="create"/>
          <parameter>
            <valueString value="Location"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_location"/>
          <contextType value="variable"/>
          <element value="id"/>
          <variable value="fhir_location_id"/>
          <transform value="uuid"/>
        </target>
        <target>
          <context value="fhir_bundle_entry"/>
          <contextType value="variable"/>
          <element value="fullUrl"/>
          <transform value="append"/>
          <parameter>
            <valueString value="urn:uuid:"/>
          </parameter>
          <parameter>
            <valueId value="fhir_location_id"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_encounter_location"/>
          <contextType value="variable"/>
          <element value="location"/>
          <variable value="fhir_location_reference"/>
          <transform value="create"/>
          <parameter>
            <valueString value="Reference"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_location_reference"/>
          <contextType value="variable"/>
          <element value="reference"/>
          <transform value="append"/>
          <parameter>
            <valueString value="urn:uuid:"/>
          </parameter>
          <parameter>
            <valueId value="fhir_location_id"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_location_reference"/>
          <contextType value="variable"/>
          <element value="type"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="Location"/>
          </parameter>
        </target>
        <rule>
          <name value="code"/>
          <source>
            <context value="cda_healthCareFacility"/>
            <element value="code"/>
            <variable value="vvv"/>
          </source>
          <target>
            <context value="fhir_location"/>
            <contextType value="variable"/>
            <element value="type"/>
            <variable value="vvv"/>
            <transform value="create"/>
          </target>
        </rule>
        <rule>
          <name value="serviceProviderOrganization"/>
          <source>
            <context value="cda_healthCareFacility"/>
            <element value="serviceProviderOrganization"/>
            <variable value="cda_serviceProviderOrganization"/>
          </source>
          <target>
            <context value="fhir_bundle"/>
            <contextType value="variable"/>
            <element value="entry"/>
            <variable value="fhir_bundle_entry"/>
          </target>
          <target>
            <context value="fhir_bundle_entry"/>
            <contextType value="variable"/>
            <element value="resource"/>
            <variable value="fhir_organization"/>
            <transform value="create"/>
            <parameter>
              <valueString value="Organization"/>
            </parameter>
          </target>
          <target>
            <context value="fhir_organization"/>
            <contextType value="variable"/>
            <element value="id"/>
            <variable value="fhir_organization_id"/>
            <transform value="uuid"/>
          </target>
          <target>
            <context value="fhir_bundle_entry"/>
            <contextType value="variable"/>
            <element value="fullUrl"/>
            <transform value="append"/>
            <parameter>
              <valueString value="urn:uuid:"/>
            </parameter>
            <parameter>
              <valueId value="fhir_organization_id"/>
            </parameter>
          </target>
          <target>
            <context value="fhir_location"/>
            <contextType value="variable"/>
            <element value="managingOrganization"/>
            <variable value="fhir_location_managingOrganization"/>
            <transform value="create"/>
            <parameter>
              <valueString value="Reference"/>
            </parameter>
          </target>
          <target>
            <context value="fhir_location_managingOrganization"/>
            <contextType value="variable"/>
            <element value="reference"/>
            <transform value="append"/>
            <parameter>
              <valueString value="urn:uuid:"/>
            </parameter>
            <parameter>
              <valueId value="fhir_organization_id"/>
            </parameter>
          </target>
          <target>
            <context value="fhir_location_managingOrganization"/>
            <contextType value="variable"/>
            <element value="type"/>
            <transform value="copy"/>
            <parameter>
              <valueString value="Organization"/>
            </parameter>
          </target>
          <dependent>
            <name value="CdaOrganizationCompilationToFhirOrganization"/>
            <variable value="cda_serviceProviderOrganization"/>
            <variable value="fhir_organization"/>
          </dependent>
        </rule>
      </rule>
    </rule>
  </group>
  <group>
    <name value="CdaBodyToFhirComposition"/>
    <typeMode value="none"/>
    <documentation value="// source dataEnterer: https://art-decor.org/art-decor/decor-templates--hl7chcda-?id=2.16.756.5.30.1.1.10.2.7&#xd;&#xa;// source author: https://art-decor.org/art-decor/decor-templates--hl7chcda-?id=2.16.840.1.113883.10.12.102&#xd;&#xa;// target: https://build.fhir.org/ig/hl7ch/ch-core//StructureDefinition-ch-ext-epr-time.html&#xd;&#xa;group ChExtEprTime(source src: TSDateTime, target ext: Extension) {&#xd;&#xa;src -> ext.url = 'http://fhir.ch/ig/ch-core/StructureDefinition/ch-ext-epr-time' &quot;url&quot;;&#xd;&#xa;src -> ext.value = create('dateTime') as value then TSDateTime(src, value) &quot;value&quot;;&#xd;&#xa;}&#xd;&#xa;// https://art-decor.org/art-decor/decor-templates--hl7chcda-?id=2.16.756.5.30.1.1.10.3.45&#xd;&#xa;// target: http://build.fhir.org/ig/hl7ch/ch-core/branches/master/StructureDefinition-ch-ext-epr-sectionid.html&#xd;&#xa;group ChExtEprSectionId(source src: II, target ext: Extension) {&#xd;&#xa;src -> ext.url = 'http://fhir.ch/ig/ch-core/StructureDefinition/ch-ext-epr-sectionid' &quot;url&quot;;&#xd;&#xa;src -> ext.value = create('Identifier') as value then II(src, value) &quot;value&quot;;&#xd;&#xa;}&#xd;&#xa;_________________________ Section Level Templates _________________________"/>
    <input>
      <name value="cda"/>
      <type value="ClinicalDocument"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="cda_structuredBody"/>
      <type value="StructuredBody"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="fhir_composition"/>
      <type value="Composition"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_practitionerRole"/>
      <type value="PractitionerRole"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_patient"/>
      <type value="Patient"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_diagnosticReport"/>
      <type value="DiagnosticReport"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_bundle"/>
      <type value="Bundle"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="component"/>
      <source>
        <context value="cda_structuredBody"/>
        <element value="component"/>
        <variable value="cda_component"/>
      </source>
      <rule>
        <name value="section"/>
        <source>
          <context value="cda_component"/>
          <element value="section"/>
          <variable value="cda_section"/>
          <condition value="code.where((code = '10') and (codeSystem = '1.2.40.0.34.5.11'))"/>
        </source>
        <dependent>
          <name value="CdaSpecimenSectionToFhirSpecimen"/>
          <variable value="cda_section"/>
          <variable value="fhir_patient"/>
          <variable value="fhir_diagnosticReport"/>
          <variable value="fhir_bundle"/>
        </dependent>
      </rule>
      <rule>
        <name value="section"/>
        <source>
          <context value="cda_component"/>
          <element value="section"/>
          <variable value="cda_section"/>
          <condition value="templateId.where((root = '1.2.40.0.34.6.0.11.2.102') or (root = '1.3.6.1.4.1.19376.1.3.3.2.1'))"/>
        </source>
        <target>
          <context value="fhir_composition"/>
          <contextType value="variable"/>
          <element value="section"/>
          <variable value="fhir_section"/>
        </target>
        <dependent>
          <name value="CdaLaboratorySpecialtySectionToFhirSection"/>
          <variable value="cda"/>
          <variable value="cda_section"/>
          <variable value="fhir_section"/>
          <variable value="fhir_practitionerRole"/>
          <variable value="fhir_patient"/>
          <variable value="fhir_diagnosticReport"/>
          <variable value="fhir_bundle"/>
        </dependent>
      </rule>
      <rule>
        <name value="section"/>
        <source>
          <context value="cda_component"/>
          <element value="section"/>
          <variable value="cda_section"/>
          <condition value="code.where((code = '20') and (codeSystem = '1.2.40.0.34.5.11'))"/>
        </source>
        <target>
          <context value="fhir_composition"/>
          <contextType value="variable"/>
          <element value="section"/>
          <variable value="fhir_section"/>
        </target>
        <dependent>
          <name value="CdaBefundbewertungSectionToFhirSection"/>
          <variable value="cda_section"/>
          <variable value="fhir_section"/>
          <variable value="fhir_bundle"/>
        </dependent>
      </rule>
      <rule>
        <name value="section"/>
        <source>
          <context value="cda_component"/>
          <element value="section"/>
          <variable value="cda_section"/>
          <condition value="code.where((code = 'BEIL') and (codeSystem = '1.2.40.0.34.5.40'))"/>
        </source>
        <dependent>
          <name value="CdaBeilagenSectionToFhirDiagnosticReportMedia"/>
          <variable value="cda_section"/>
          <variable value="fhir_diagnosticReport"/>
          <variable value="fhir_bundle"/>
          <variable value="fhir_patient"/>
        </dependent>
      </rule>
    </rule>
  </group>
  <group>
    <name value="CdaToPractitionerRole"/>
    <typeMode value="none"/>
    <input>
      <name value="cda"/>
      <type value="ClinicalDocument"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="fhir_practitionerRole"/>
      <type value="PractitionerRole"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_bundle"/>
      <type value="Bundle"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="CdaDocumentationOfServiceEventPerformerExists"/>
      <source>
        <context value="cda"/>
        <condition value="cda.documentationOf[0].serviceEvent.performer.exists()"/>
      </source>
      <rule>
        <name value="documentationOf"/>
        <source>
          <context value="cda"/>
          <element value="documentationOf"/>
          <listMode value="first"/>
          <variable value="cda_documentationOf"/>
        </source>
        <rule>
          <name value="serviceEvent"/>
          <source>
            <context value="cda_documentationOf"/>
            <element value="serviceEvent"/>
            <variable value="cda_documentationOf_serviceEvent"/>
          </source>
          <rule>
            <name value="performer"/>
            <source>
              <context value="cda_documentationOf_serviceEvent"/>
              <element value="performer"/>
              <variable value="cda_documentationOf_serviceEvent_performer"/>
            </source>
            <rule>
              <name value="assignedEntity"/>
              <source>
                <context value="cda_documentationOf_serviceEvent_performer"/>
                <element value="assignedEntity"/>
                <variable value="cda_performer_assignedEntity"/>
              </source>
              <dependent>
                <name value="CdaAssignedEntityToFhirPractitionerRole"/>
                <variable value="cda_performer_assignedEntity"/>
                <variable value="fhir_practitionerRole"/>
                <variable value="fhir_bundle"/>
              </dependent>
            </rule>
          </rule>
        </rule>
      </rule>
    </rule>
    <rule>
      <name value="CdaDocumentationOfServiceEventPerformerExistsNot"/>
      <source>
        <context value="cda"/>
        <condition value="cda.documentationOf[0].serviceEvent.performer.exists().not()"/>
      </source>
      <rule>
        <name value="CdaAuthorToObservationPerformer"/>
        <source>
          <context value="cda"/>
          <element value="author"/>
          <variable value="cda_author"/>
          <condition value="$this.assignedAuthor.assignedPerson.exists()"/>
        </source>
        <dependent>
          <name value="CdaAuthorToFhirPractitionerRole"/>
          <variable value="cda_author"/>
          <variable value="fhir_practitionerRole"/>
          <variable value="fhir_bundle"/>
        </dependent>
      </rule>
    </rule>
  </group>
  <group>
    <name value="CdaSectionToFhirSection"/>
    <typeMode value="none"/>
    <input>
      <name value="cda_section"/>
      <type value="Section"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="fhir_section"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_bundle"/>
      <type value="Bundle"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="code"/>
      <source>
        <context value="cda_section"/>
        <element value="code"/>
        <variable value="vvv"/>
      </source>
      <target>
        <context value="fhir_section"/>
        <contextType value="variable"/>
        <element value="code"/>
        <variable value="vvv"/>
        <transform value="create"/>
      </target>
    </rule>
    <rule>
      <name value="test"/>
      <source>
        <context value="cda_section"/>
        <element value="title"/>
        <variable value="cda_section_title"/>
      </source>
      <target>
        <context value="fhir_section"/>
        <contextType value="variable"/>
        <element value="title"/>
        <transform value="evaluate"/>
        <parameter>
          <valueString value="cda_section_title.xmlText"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="text"/>
      <source>
        <context value="cda_section"/>
        <element value="text"/>
        <variable value="cda_section_text"/>
      </source>
      <target>
        <context value="fhir_section"/>
        <contextType value="variable"/>
        <element value="text"/>
        <variable value="fhir_section_text"/>
      </target>
      <target>
        <context value="fhir_section_text"/>
        <contextType value="variable"/>
        <element value="status"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="generated"/>
        </parameter>
      </target>
      <rule>
        <name value="asdf"/>
        <source>
          <context value="cda_section_text"/>
          <condition value="cda_section.languageCode.exists().not()"/>
        </source>
        <target>
          <context value="fhir_section_text"/>
          <contextType value="variable"/>
          <element value="div"/>
          <transform value="copy"/>
          <parameter>
            <valueId value="cda_section_text"/>
          </parameter>
        </target>
      </rule>
      <rule>
        <name value="CdaSectionTextToFhirSectionTextWithLanguage"/>
        <source>
          <context value="cda_section_text"/>
          <condition value="cda_section.languageCode.exists()"/>
        </source>
        <rule>
          <name value="languageCode"/>
          <source>
            <context value="cda_section"/>
            <element value="languageCode"/>
            <variable value="cda_languageCode"/>
          </source>
          <rule>
            <name value="asdf"/>
            <source>
              <context value="cda_languageCode"/>
              <element value="code"/>
              <variable value="cda_languageCode_code"/>
            </source>
            <target>
              <context value="fhir_section_text"/>
              <contextType value="variable"/>
              <element value="div"/>
              <transform value="copy"/>
              <parameter>
                <valueId value="cda_section_text"/>
              </parameter>
            </target>
          </rule>
        </rule>
      </rule>
    </rule>
    <rule>
      <name value="author"/>
      <source>
        <context value="cda_section"/>
        <element value="author"/>
        <variable value="cda_section_author"/>
      </source>
      <target>
        <context value="fhir_bundle"/>
        <contextType value="variable"/>
        <element value="entry"/>
        <variable value="fhir_bundle_entry"/>
      </target>
      <target>
        <context value="fhir_bundle_entry"/>
        <contextType value="variable"/>
        <element value="resource"/>
        <variable value="fhir_practitionerRole"/>
        <transform value="create"/>
        <parameter>
          <valueString value="PractitionerRole"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_practitionerRole"/>
        <contextType value="variable"/>
        <element value="id"/>
        <variable value="fhir_practitionerRole_id"/>
        <transform value="uuid"/>
      </target>
      <target>
        <context value="fhir_bundle_entry"/>
        <contextType value="variable"/>
        <element value="fullUrl"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_practitionerRole_id"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_section"/>
        <contextType value="variable"/>
        <element value="author"/>
        <variable value="fhir_section_author_reference"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Reference"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_section_author_reference"/>
        <contextType value="variable"/>
        <element value="reference"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_practitionerRole_id"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_section_author_reference"/>
        <contextType value="variable"/>
        <element value="type"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="PractitionerRole"/>
        </parameter>
      </target>
      <dependent>
        <name value="CdaAuthorToFhirPractitionerRole"/>
        <variable value="cda_section_author"/>
        <variable value="fhir_practitionerRole"/>
        <variable value="fhir_bundle"/>
      </dependent>
    </rule>
  </group>
  <group>
    <name value="CdaSpecimenSectionToFhirSpecimen"/>
    <typeMode value="none"/>
    <input>
      <name value="cda_section"/>
      <type value="Section"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="fhir_patient"/>
      <type value="Patient"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_diagnosticReport"/>
      <type value="DiagnosticReport"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_bundle"/>
      <type value="Bundle"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="entry"/>
      <source>
        <context value="cda_section"/>
        <element value="entry"/>
        <variable value="cda_section_entry"/>
      </source>
      <rule>
        <name value="act"/>
        <source>
          <context value="cda_section_entry"/>
          <element value="act"/>
          <variable value="cda_act"/>
          <condition value="$this.code.where(code = '10')"/>
        </source>
        <rule>
          <name value="entryRelationship"/>
          <source>
            <context value="cda_act"/>
            <element value="entryRelationship"/>
            <variable value="cda_entryRelationship"/>
          </source>
          <rule>
            <name value="procedure"/>
            <source>
              <context value="cda_entryRelationship"/>
              <element value="procedure"/>
              <variable value="cda_procedure"/>
            </source>
            <target>
              <context value="fhir_bundle"/>
              <contextType value="variable"/>
              <element value="entry"/>
              <variable value="fhir_bundle_entry"/>
            </target>
            <target>
              <context value="fhir_bundle_entry"/>
              <contextType value="variable"/>
              <element value="resource"/>
              <variable value="fhir_specimen"/>
              <transform value="create"/>
              <parameter>
                <valueString value="Specimen"/>
              </parameter>
            </target>
            <target>
              <context value="fhir_specimen"/>
              <contextType value="variable"/>
              <element value="id"/>
              <variable value="fhir_specimen_id"/>
              <transform value="uuid"/>
            </target>
            <target>
              <context value="fhir_bundle_entry"/>
              <contextType value="variable"/>
              <element value="fullUrl"/>
              <transform value="append"/>
              <parameter>
                <valueString value="urn:uuid:"/>
              </parameter>
              <parameter>
                <valueId value="fhir_specimen_id"/>
              </parameter>
            </target>
            <target>
              <context value="fhir_specimen"/>
              <contextType value="variable"/>
              <element value="subject"/>
              <variable value="fhir_specimen_patient_reference"/>
              <transform value="create"/>
              <parameter>
                <valueString value="Reference"/>
              </parameter>
            </target>
            <target>
              <context value="fhir_patient"/>
              <contextType value="variable"/>
              <element value="id"/>
              <variable value="fhir_patient_id"/>
            </target>
            <target>
              <context value="fhir_specimen_patient_reference"/>
              <contextType value="variable"/>
              <element value="reference"/>
              <transform value="append"/>
              <parameter>
                <valueString value="urn:uuid:"/>
              </parameter>
              <parameter>
                <valueId value="fhir_patient_id"/>
              </parameter>
            </target>
            <target>
              <context value="fhir_specimen_patient_reference"/>
              <contextType value="variable"/>
              <element value="type"/>
              <transform value="copy"/>
              <parameter>
                <valueString value="Patient"/>
              </parameter>
            </target>
            <target>
              <context value="fhir_diagnosticReport"/>
              <contextType value="variable"/>
              <element value="specimen"/>
              <variable value="fhir_diagnosticReport_specimen_reference"/>
              <transform value="create"/>
              <parameter>
                <valueString value="Reference"/>
              </parameter>
            </target>
            <target>
              <context value="fhir_specimen"/>
              <contextType value="variable"/>
              <element value="id"/>
              <variable value="fhir_specimen_id"/>
            </target>
            <target>
              <context value="fhir_diagnosticReport_specimen_reference"/>
              <contextType value="variable"/>
              <element value="reference"/>
              <transform value="append"/>
              <parameter>
                <valueString value="urn:uuid:"/>
              </parameter>
              <parameter>
                <valueId value="fhir_specimen_id"/>
              </parameter>
            </target>
            <target>
              <context value="fhir_diagnosticReport_specimen_reference"/>
              <contextType value="variable"/>
              <element value="type"/>
              <transform value="copy"/>
              <parameter>
                <valueString value="Specimen"/>
              </parameter>
            </target>
            <target>
              <context value="fhir_specimen"/>
              <contextType value="variable"/>
              <element value="collection"/>
              <variable value="fhir_specimen_collection"/>
            </target>
            <rule>
              <name value="effectiveTime"/>
              <source>
                <context value="cda_procedure"/>
                <element value="effectiveTime"/>
                <variable value="cda_effectiveTime"/>
                <condition value="$this.value.exists()"/>
              </source>
              <rule>
                <name value="value"/>
                <source>
                  <context value="cda_effectiveTime"/>
                  <element value="value"/>
                  <variable value="v"/>
                </source>
                <target>
                  <context value="fhir_specimen_collection"/>
                  <contextType value="variable"/>
                  <element value="collected"/>
                  <transform value="copy"/>
                  <parameter>
                    <valueId value="v"/>
                  </parameter>
                </target>
              </rule>
            </rule>
            <rule>
              <name value="targetSiteCode"/>
              <source>
                <context value="cda_procedure"/>
                <element value="targetSiteCode"/>
                <variable value="vvv"/>
              </source>
              <target>
                <context value="fhir_specimen_collection"/>
                <contextType value="variable"/>
                <element value="bodySite"/>
                <variable value="vvv"/>
                <transform value="create"/>
              </target>
            </rule>
            <rule>
              <name value="participant"/>
              <source>
                <context value="cda_procedure"/>
                <element value="participant"/>
                <variable value="cda_participant"/>
              </source>
              <rule>
                <name value="participantRole"/>
                <source>
                  <context value="cda_participant"/>
                  <element value="participantRole"/>
                  <variable value="cda_participantRole"/>
                </source>
                <rule>
                  <name value="playingEntity"/>
                  <source>
                    <context value="cda_participantRole"/>
                    <element value="playingEntity"/>
                    <variable value="cda_playingEntity"/>
                  </source>
                  <rule>
                    <name value="id"/>
                    <source>
                      <context value="cda_participantRole"/>
                      <element value="id"/>
                      <variable value="vvv"/>
                    </source>
                    <target>
                      <context value="fhir_specimen"/>
                      <contextType value="variable"/>
                      <element value="accessionIdentifier"/>
                      <variable value="vvv"/>
                      <transform value="create"/>
                    </target>
                  </rule>
                  <rule>
                    <name value="code"/>
                    <source>
                      <context value="cda_playingEntity"/>
                      <element value="code"/>
                      <variable value="vvv"/>
                    </source>
                    <target>
                      <context value="fhir_specimen"/>
                      <contextType value="variable"/>
                      <element value="type"/>
                      <variable value="vvv"/>
                      <transform value="create"/>
                    </target>
                  </rule>
                </rule>
              </rule>
            </rule>
            <rule>
              <name value="entryRelationship"/>
              <source>
                <context value="cda_procedure"/>
                <element value="entryRelationship"/>
                <variable value="cda_entryRelationship"/>
              </source>
              <rule>
                <name value="act"/>
                <source>
                  <context value="cda_entryRelationship"/>
                  <element value="act"/>
                  <variable value="cda_act"/>
                </source>
                <rule>
                  <name value="effectiveTime"/>
                  <source>
                    <context value="cda_act"/>
                    <element value="effectiveTime"/>
                    <variable value="cda_effectiveTime"/>
                    <condition value="$this.value.exists()"/>
                  </source>
                  <rule>
                    <name value="value"/>
                    <source>
                      <context value="cda_effectiveTime"/>
                      <element value="value"/>
                      <variable value="v"/>
                    </source>
                    <target>
                      <context value="fhir_specimen"/>
                      <contextType value="variable"/>
                      <element value="receivedTime"/>
                      <transform value="copy"/>
                      <parameter>
                        <valueId value="v"/>
                      </parameter>
                    </target>
                  </rule>
                </rule>
              </rule>
            </rule>
          </rule>
        </rule>
      </rule>
    </rule>
  </group>
  <group>
    <name value="CdaLaboratorySpecialtySectionToFhirSection"/>
    <extends value="CdaSectionToFhirSection"/>
    <typeMode value="none"/>
    <input>
      <name value="cda"/>
      <type value="ClinicalDocument"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="cda_section"/>
      <type value="Section"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="fhir_section"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_practitionerRole"/>
      <type value="PractitionerRole"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_patient"/>
      <type value="Patient"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_diagnosticReport"/>
      <type value="DiagnosticReport"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_bundle"/>
      <type value="Bundle"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="entry"/>
      <source>
        <context value="cda_section"/>
        <element value="entry"/>
        <variable value="cda_section_entry"/>
      </source>
      <rule>
        <name value="act"/>
        <source>
          <context value="cda_section_entry"/>
          <element value="act"/>
          <variable value="cda_act"/>
        </source>
        <rule>
          <name value="entryRelationship"/>
          <source>
            <context value="cda_act"/>
            <element value="entryRelationship"/>
            <variable value="cda_entryRelationship"/>
            <condition value="$this.organizer.templateId.where(root = '1.3.6.1.4.1.19376.1.3.1.4')"/>
          </source>
          <rule>
            <name value="organizer"/>
            <source>
              <context value="cda_entryRelationship"/>
              <element value="organizer"/>
              <variable value="cda_laboratory_battery_organizer"/>
            </source>
            <target>
              <context value="fhir_bundle"/>
              <contextType value="variable"/>
              <element value="entry"/>
              <variable value="fhir_bundle_entry"/>
            </target>
            <target>
              <context value="fhir_bundle_entry"/>
              <contextType value="variable"/>
              <element value="resource"/>
              <variable value="fhir_observation"/>
              <transform value="create"/>
              <parameter>
                <valueString value="Observation"/>
              </parameter>
            </target>
            <target>
              <context value="fhir_observation"/>
              <contextType value="variable"/>
              <element value="id"/>
              <variable value="fhir_observation_id"/>
              <transform value="uuid"/>
            </target>
            <target>
              <context value="fhir_bundle_entry"/>
              <contextType value="variable"/>
              <element value="fullUrl"/>
              <transform value="append"/>
              <parameter>
                <valueString value="urn:uuid:"/>
              </parameter>
              <parameter>
                <valueId value="fhir_observation_id"/>
              </parameter>
            </target>
            <target>
              <context value="fhir_section"/>
              <contextType value="variable"/>
              <element value="entry"/>
              <variable value="fhir_section_entry_reference"/>
              <transform value="create"/>
              <parameter>
                <valueString value="Reference"/>
              </parameter>
            </target>
            <target>
              <context value="fhir_section_entry_reference"/>
              <contextType value="variable"/>
              <element value="reference"/>
              <transform value="append"/>
              <parameter>
                <valueString value="urn:uuid:"/>
              </parameter>
              <parameter>
                <valueId value="fhir_observation_id"/>
              </parameter>
            </target>
            <target>
              <context value="fhir_section_entry_reference"/>
              <contextType value="variable"/>
              <element value="type"/>
              <transform value="copy"/>
              <parameter>
                <valueString value="Observation"/>
              </parameter>
            </target>
            <rule>
              <name value="FhirObservationProfile"/>
              <source>
                <context value="cda_laboratory_battery_organizer"/>
              </source>
              <target>
                <context value="fhir_observation"/>
                <contextType value="variable"/>
                <element value="meta"/>
                <variable value="fhir_observation_meta"/>
              </target>
              <target>
                <context value="fhir_observation_meta"/>
                <contextType value="variable"/>
                <element value="profile"/>
                <transform value="copy"/>
                <parameter>
                  <valueString value="http://hl7.eu/fhir/laboratory/StructureDefinition/Observation-resultslab-eu-lab"/>
                </parameter>
              </target>
            </rule>
            <rule>
              <name value="FhirObservationCategoryCoding"/>
              <source>
                <context value="cda_laboratory_battery_organizer"/>
              </source>
              <target>
                <context value="fhir_observation"/>
                <contextType value="variable"/>
                <element value="category"/>
                <variable value="fhir_category"/>
              </target>
              <target>
                <context value="fhir_category"/>
                <contextType value="variable"/>
                <element value="coding"/>
                <variable value="fhir_category_coding"/>
              </target>
              <target>
                <context value="fhir_category_coding"/>
                <contextType value="variable"/>
                <element value="system"/>
                <transform value="copy"/>
                <parameter>
                  <valueString value="http://terminology.hl7.org/CodeSystem/observation-category"/>
                </parameter>
              </target>
              <target>
                <context value="fhir_category_coding"/>
                <contextType value="variable"/>
                <element value="code"/>
                <transform value="copy"/>
                <parameter>
                  <valueString value="laboratory"/>
                </parameter>
              </target>
            </rule>
            <rule>
              <name value="FhirObservationSubject"/>
              <source>
                <context value="cda_laboratory_battery_organizer"/>
              </source>
              <target>
                <context value="fhir_observation"/>
                <contextType value="variable"/>
                <element value="subject"/>
                <variable value="fhir_observation_subject_reference"/>
                <transform value="create"/>
                <parameter>
                  <valueString value="Reference"/>
                </parameter>
              </target>
              <target>
                <context value="fhir_patient"/>
                <contextType value="variable"/>
                <element value="id"/>
                <variable value="fhir_patient_id"/>
              </target>
              <target>
                <context value="fhir_observation_subject_reference"/>
                <contextType value="variable"/>
                <element value="reference"/>
                <transform value="append"/>
                <parameter>
                  <valueString value="urn:uuid:"/>
                </parameter>
                <parameter>
                  <valueId value="fhir_patient_id"/>
                </parameter>
              </target>
            </rule>
            <rule>
              <name value="code"/>
              <source>
                <context value="cda_laboratory_battery_organizer"/>
                <element value="code"/>
                <variable value="vvv"/>
              </source>
              <target>
                <context value="fhir_observation"/>
                <contextType value="variable"/>
                <element value="category"/>
                <variable value="vvv"/>
                <transform value="create"/>
              </target>
            </rule>
            <rule>
              <name value="code"/>
              <source>
                <context value="cda_laboratory_battery_organizer"/>
                <element value="code"/>
                <variable value="vvv"/>
              </source>
              <target>
                <context value="fhir_observation"/>
                <contextType value="variable"/>
                <element value="code"/>
                <variable value="vvv"/>
                <transform value="create"/>
              </target>
            </rule>
            <rule>
              <name value="CdaStatusCodeToFhirObservationStatusMapped"/>
              <source>
                <context value="cda_laboratory_battery_organizer"/>
                <element value="statusCode"/>
                <variable value="organizer_statusCode"/>
              </source>
              <rule>
                <name value="code"/>
                <source>
                  <context value="organizer_statusCode"/>
                  <element value="code"/>
                  <variable value="cda_code"/>
                </source>
                <target>
                  <context value="fhir_observation"/>
                  <contextType value="variable"/>
                  <element value="status"/>
                  <transform value="translate"/>
                  <parameter>
                    <valueId value="cda_code"/>
                  </parameter>
                  <parameter>
                    <valueString value="#act-status-2-observation-status"/>
                  </parameter>
                  <parameter>
                    <valueString value="code"/>
                  </parameter>
                </target>
              </rule>
            </rule>
            <rule>
              <name value="CdaEffectiveTimeToFhirObservationEffective"/>
              <source>
                <context value="cda_laboratory_battery_organizer"/>
                <element value="effectiveTime"/>
                <variable value="cda_effectiveTime"/>
              </source>
              <target>
                <context value="fhir_observation"/>
                <contextType value="variable"/>
                <element value="effective"/>
                <variable value="fhir_observation_effective"/>
                <transform value="create"/>
                <parameter>
                  <valueString value="dateTime"/>
                </parameter>
              </target>
              <target>
                <context value="fhir_observation_effective"/>
                <contextType value="variable"/>
                <element value="extension"/>
                <variable value="fhir_observation_effective_extenstion"/>
              </target>
              <target>
                <context value="fhir_observation_effective_extenstion"/>
                <contextType value="variable"/>
                <element value="url"/>
                <transform value="copy"/>
                <parameter>
                  <valueString value="http://hl7.org/fhir/StructureDefinition/data-absent-reason"/>
                </parameter>
              </target>
              <target>
                <context value="fhir_observation_effective_extenstion"/>
                <contextType value="variable"/>
                <element value="value"/>
                <variable value="fhir_observation_effective_extenstion_code"/>
                <transform value="create"/>
                <parameter>
                  <valueString value="code"/>
                </parameter>
              </target>
              <target>
                <context value="fhir_observation_effective_extenstion_code"/>
                <contextType value="variable"/>
                <element value="value"/>
                <transform value="copy"/>
                <parameter>
                  <valueString value="not-applicable"/>
                </parameter>
              </target>
              <dependent>
                <name value="TSDateTime"/>
                <variable value="cda_effectiveTime"/>
                <variable value="fhir_observation_effective"/>
              </dependent>
            </rule>
            <rule>
              <name value="CdaEffectiveTimeExistsNotToFhirObservationEffective"/>
              <source>
                <context value="cda_laboratory_battery_organizer"/>
                <condition value="cda_laboratory_battery_organizer.effectiveTime.exists().not()"/>
              </source>
              <target>
                <context value="fhir_observation"/>
                <contextType value="variable"/>
                <element value="effective"/>
                <variable value="fhir_observation_effective"/>
                <transform value="create"/>
                <parameter>
                  <valueString value="dateTime"/>
                </parameter>
              </target>
              <target>
                <context value="fhir_observation_effective"/>
                <contextType value="variable"/>
                <element value="value"/>
                <transform value="copy"/>
                <parameter>
                  <valueString value="1900-01-01"/>
                </parameter>
              </target>
              <target>
                <context value="fhir_observation_effective"/>
                <contextType value="variable"/>
                <element value="extension"/>
                <variable value="fhir_observation_effective_extenstion"/>
              </target>
              <target>
                <context value="fhir_observation_effective_extenstion"/>
                <contextType value="variable"/>
                <element value="url"/>
                <transform value="copy"/>
                <parameter>
                  <valueString value="http://hl7.org/fhir/StructureDefinition/data-absent-reason"/>
                </parameter>
              </target>
              <target>
                <context value="fhir_observation_effective_extenstion"/>
                <contextType value="variable"/>
                <element value="value"/>
                <variable value="fhir_observation_effective_extenstion_code"/>
                <transform value="create"/>
                <parameter>
                  <valueString value="code"/>
                </parameter>
              </target>
              <target>
                <context value="fhir_observation_effective_extenstion_code"/>
                <contextType value="variable"/>
                <element value="value"/>
                <transform value="copy"/>
                <parameter>
                  <valueString value="not-applicable"/>
                </parameter>
              </target>
            </rule>
            <rule>
              <name value="CdaBatteryOrganizerPerformerToFhirObservationPerformer"/>
              <source>
                <context value="cda_laboratory_battery_organizer"/>
                <element value="performer"/>
                <variable value="cda_laboratory_battery_organizer_performer"/>
                <condition value="cda_laboratory_battery_organizer.performer.exists()"/>
              </source>
              <dependent>
                <name value="CdaPerformerToFhirObservationPerformer"/>
                <variable value="cda_laboratory_battery_organizer_performer"/>
                <variable value="fhir_observation"/>
                <variable value="fhir_bundle"/>
              </dependent>
            </rule>
            <rule>
              <name value="CdaBatteryOrganizerPerformerExistsNot"/>
              <source>
                <context value="cda_laboratory_battery_organizer"/>
                <condition value="cda_laboratory_battery_organizer.performer.exists().not()"/>
              </source>
              <rule>
                <name value="CdaDocumentationOfServiceEventPerformerExists"/>
                <source>
                  <context value="cda"/>
                  <condition value="cda.documentationOf[0].serviceEvent.performer.exists()"/>
                </source>
                <rule>
                  <name value="documentationOf"/>
                  <source>
                    <context value="cda"/>
                    <element value="documentationOf"/>
                    <listMode value="first"/>
                    <variable value="cda_documentationOf"/>
                  </source>
                  <rule>
                    <name value="serviceEvent"/>
                    <source>
                      <context value="cda_documentationOf"/>
                      <element value="serviceEvent"/>
                      <variable value="cda_documentationOf_serviceEvent"/>
                    </source>
                    <rule>
                      <name value="performer"/>
                      <source>
                        <context value="cda_documentationOf_serviceEvent"/>
                        <element value="performer"/>
                        <variable value="cda_documentationOf_serviceEvent_performer"/>
                      </source>
                      <rule>
                        <name value="time"/>
                        <source>
                          <context value="cda_documentationOf_serviceEvent_performer"/>
                          <element value="time"/>
                          <variable value="vvv"/>
                        </source>
                        <target>
                          <context value="fhir_observation"/>
                          <contextType value="variable"/>
                          <element value="issued"/>
                          <variable value="vvv"/>
                          <transform value="create"/>
                        </target>
                      </rule>
                    </rule>
                  </rule>
                </rule>
              </rule>
              <rule>
                <name value="CdaBatteryOrganizerPerformerExistsNotRole"/>
                <source>
                  <context value="cda"/>
                </source>
                <target>
                  <context value="fhir_observation"/>
                  <contextType value="variable"/>
                  <element value="performer"/>
                  <variable value="fhir_observation_performer_reference"/>
                  <transform value="create"/>
                  <parameter>
                    <valueString value="Reference"/>
                  </parameter>
                </target>
                <target>
                  <context value="fhir_practitionerRole"/>
                  <contextType value="variable"/>
                  <element value="id"/>
                  <variable value="fhir_practitionerRole_id"/>
                </target>
                <target>
                  <context value="fhir_observation_performer_reference"/>
                  <contextType value="variable"/>
                  <element value="reference"/>
                  <transform value="append"/>
                  <parameter>
                    <valueString value="urn:uuid:"/>
                  </parameter>
                  <parameter>
                    <valueId value="fhir_practitionerRole_id"/>
                  </parameter>
                </target>
                <target>
                  <context value="fhir_observation_performer_reference"/>
                  <contextType value="variable"/>
                  <element value="type"/>
                  <transform value="copy"/>
                  <parameter>
                    <valueString value="PractitionerRole"/>
                  </parameter>
                </target>
              </rule>
            </rule>
            <rule>
              <name value="component"/>
              <source>
                <context value="cda_laboratory_battery_organizer"/>
                <element value="component"/>
                <variable value="cda_component"/>
                <condition value="$this.observation.templateId.where(root = '1.3.6.1.4.1.19376.1.3.1.6')"/>
              </source>
              <rule>
                <name value="observation"/>
                <source>
                  <context value="cda_component"/>
                  <element value="observation"/>
                  <variable value="cda_laboratory_observation"/>
                </source>
                <target>
                  <context value="fhir_bundle"/>
                  <contextType value="variable"/>
                  <element value="entry"/>
                  <variable value="fhir_bundle_entry"/>
                </target>
                <target>
                  <context value="fhir_bundle_entry"/>
                  <contextType value="variable"/>
                  <element value="resource"/>
                  <variable value="fhir_laboratory_observation"/>
                  <transform value="create"/>
                  <parameter>
                    <valueString value="Observation"/>
                  </parameter>
                </target>
                <target>
                  <context value="fhir_laboratory_observation"/>
                  <contextType value="variable"/>
                  <element value="id"/>
                  <variable value="fhir_laboratory_observation_id"/>
                  <transform value="uuid"/>
                </target>
                <target>
                  <context value="fhir_bundle_entry"/>
                  <contextType value="variable"/>
                  <element value="fullUrl"/>
                  <transform value="append"/>
                  <parameter>
                    <valueString value="urn:uuid:"/>
                  </parameter>
                  <parameter>
                    <valueId value="fhir_laboratory_observation_id"/>
                  </parameter>
                </target>
                <target>
                  <context value="fhir_observation"/>
                  <contextType value="variable"/>
                  <element value="hasMember"/>
                  <variable value="fhir_observation_hasMember_reference"/>
                  <transform value="create"/>
                  <parameter>
                    <valueString value="Reference"/>
                  </parameter>
                </target>
                <target>
                  <context value="fhir_observation_hasMember_reference"/>
                  <contextType value="variable"/>
                  <element value="reference"/>
                  <transform value="append"/>
                  <parameter>
                    <valueString value="urn:uuid:"/>
                  </parameter>
                  <parameter>
                    <valueId value="fhir_laboratory_observation_id"/>
                  </parameter>
                </target>
                <target>
                  <context value="fhir_observation_hasMember_reference"/>
                  <contextType value="variable"/>
                  <element value="type"/>
                  <transform value="copy"/>
                  <parameter>
                    <valueString value="Observation"/>
                  </parameter>
                </target>
                <dependent>
                  <name value="CdaLaboratoryObservationToFhirObservation"/>
                  <variable value="cda"/>
                  <variable value="cda_laboratory_observation"/>
                  <variable value="fhir_laboratory_observation"/>
                  <variable value="fhir_practitionerRole"/>
                  <variable value="fhir_patient"/>
                  <variable value="fhir_bundle"/>
                </dependent>
              </rule>
            </rule>
          </rule>
        </rule>
      </rule>
    </rule>
  </group>
  <group>
    <name value="CdaBeilagenSectionToFhirDiagnosticReportMedia"/>
    <typeMode value="none"/>
    <input>
      <name value="cda_section"/>
      <type value="Section"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="fhir_diagnosticReport"/>
      <type value="DiagnosticReport"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_bundle"/>
      <type value="Bundle"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_patient"/>
      <type value="Patient"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="CdaBeilagenToFhirMedia"/>
      <source>
        <context value="cda_section"/>
      </source>
      <target>
        <context value="fhir_bundle"/>
        <contextType value="variable"/>
        <element value="entry"/>
        <variable value="fhir_bundle_entry_01"/>
      </target>
      <target>
        <context value="fhir_bundle_entry_01"/>
        <contextType value="variable"/>
        <element value="resource"/>
        <variable value="fhir_media"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Media"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_media"/>
        <contextType value="variable"/>
        <element value="id"/>
        <variable value="fhir_media_id"/>
        <transform value="uuid"/>
      </target>
      <target>
        <context value="fhir_bundle_entry_01"/>
        <contextType value="variable"/>
        <element value="fullUrl"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_media_id"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_diagnosticReport"/>
        <contextType value="variable"/>
        <element value="media"/>
        <variable value="fhir_diagnosticReport_media"/>
      </target>
      <target>
        <context value="fhir_diagnosticReport_media"/>
        <contextType value="variable"/>
        <element value="link"/>
        <variable value="fhir_diagnosticReport_media_link_reference"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Reference"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_diagnosticReport_media_link_reference"/>
        <contextType value="variable"/>
        <element value="reference"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_media_id"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_diagnosticReport_media_link_reference"/>
        <contextType value="variable"/>
        <element value="type"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="Media"/>
        </parameter>
      </target>
      <rule>
        <name value="entry"/>
        <source>
          <context value="cda_section"/>
          <element value="entry"/>
          <variable value="cda_section_entry"/>
        </source>
        <rule>
          <name value="observationMedia"/>
          <source>
            <context value="cda_section_entry"/>
            <element value="observationMedia"/>
            <variable value="cda_observationMedia"/>
          </source>
          <rule>
            <name value="CdaObservationMediaIDFhirMediaIdentifier"/>
            <source>
              <context value="cda_observationMedia"/>
              <element value="ID"/>
              <variable value="cda_observationMedia_ID"/>
            </source>
            <target>
              <context value="fhir_media"/>
              <contextType value="variable"/>
              <element value="identifier"/>
              <variable value="fhir_media_identifier"/>
            </target>
            <target>
              <context value="fhir_media_identifier"/>
              <contextType value="variable"/>
              <element value="value"/>
              <transform value="copy"/>
              <parameter>
                <valueId value="cda_observationMedia_ID"/>
              </parameter>
            </target>
          </rule>
          <rule>
            <name value="FhirMediaStatus"/>
            <source>
              <context value="cda_observationMedia"/>
            </source>
            <target>
              <context value="fhir_media"/>
              <contextType value="variable"/>
              <element value="status"/>
              <transform value="copy"/>
              <parameter>
                <valueString value="completed"/>
              </parameter>
            </target>
          </rule>
          <rule>
            <name value="value"/>
            <source>
              <context value="cda_observationMedia"/>
              <element value="value"/>
              <variable value="cda_observationMedia_value"/>
            </source>
            <target>
              <context value="fhir_media"/>
              <contextType value="variable"/>
              <element value="content"/>
              <variable value="fhir_media_content"/>
            </target>
            <rule>
              <name value="mediaType"/>
              <source>
                <context value="cda_observationMedia_value"/>
                <element value="mediaType"/>
                <variable value="cda_mediaType"/>
              </source>
              <target>
                <context value="fhir_media_content"/>
                <contextType value="variable"/>
                <element value="contentType"/>
                <transform value="copy"/>
                <parameter>
                  <valueId value="cda_mediaType"/>
                </parameter>
              </target>
            </rule>
            <rule>
              <name value="CdaObservationMediaValueToFhirAttachmentData"/>
              <source>
                <context value="cda_observationMedia_value"/>
              </source>
              <target>
                <context value="fhir_media_content"/>
                <contextType value="variable"/>
                <element value="data"/>
                <transform value="evaluate"/>
                <parameter>
                  <valueString value="cda_observationMedia_value.dataBase64Binary"/>
                </parameter>
              </target>
            </rule>
          </rule>
        </rule>
      </rule>
    </rule>
  </group>
  <group>
    <name value="CdaBefundbewertungSectionToFhirSection"/>
    <extends value="CdaSectionToFhirSection"/>
    <typeMode value="none"/>
    <input>
      <name value="cda_section"/>
      <type value="Section"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="fhir_section"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_bundle"/>
      <type value="Bundle"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="FhirAnnotationSectionCoding"/>
      <source>
        <context value="cda_section"/>
      </source>
      <target>
        <context value="fhir_section"/>
        <contextType value="variable"/>
        <element value="code"/>
        <variable value="fhir_section_code"/>
      </target>
      <target>
        <context value="fhir_section_code"/>
        <contextType value="variable"/>
        <element value="coding"/>
        <variable value="fhir_section_coding"/>
      </target>
      <target>
        <context value="fhir_section_coding"/>
        <contextType value="variable"/>
        <element value="code"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="48767-8"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_section_coding"/>
        <contextType value="variable"/>
        <element value="system"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="http://loinc.org"/>
        </parameter>
      </target>
    </rule>
  </group>
  <group>
    <name value="CdaObservationToFhirObservation"/>
    <typeMode value="none"/>
    <documentation value="group ClinicalDocumentSection(source cda : ClinicalDocument, source src : Section, source patient : Patient, target tgt, target bundle: Bundle) {&#xd;&#xa;src.id as id where ($this.root=%cda.id.root)=false -> tgt.extension as ext then ChExtEprSectionId(id, ext) &quot;sectionId&quot;;&#xd;&#xa;src.title as t -> tgt.title = (t.dataString);&#xd;&#xa;src.code -> tgt.code;&#xd;&#xa;src.text as cdaText -> tgt.text as fhirText then {&#xd;&#xa;cdaText -> fhirText.status = 'generated' &quot;narrativeStatus&quot;;&#xd;&#xa;cdaText as t -> fhirText.div = t &quot;narrativeText&quot;;&#xd;&#xa;} &quot;cdaText&quot;;&#xd;&#xa;src.section as srcSection -> tgt.section as tgtSection then ClinicalDocumentSection(cda, srcSection, patient, tgtSection, bundle);&#xd;&#xa;}&#xd;&#xa;_________________________ Entry Level Templates   ________________________"/>
    <input>
      <name value="cda_observation"/>
      <type value="CDAObservation"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="fhir_observation"/>
      <type value="Observation"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="id"/>
      <source>
        <context value="cda_observation"/>
        <element value="id"/>
        <variable value="vvv"/>
      </source>
      <target>
        <context value="fhir_observation"/>
        <contextType value="variable"/>
        <element value="identifier"/>
        <variable value="vvv"/>
        <transform value="create"/>
      </target>
    </rule>
  </group>
  <group>
    <name value="CdaLaboratoryObservationToFhirObservation"/>
    <typeMode value="none"/>
    <input>
      <name value="cda"/>
      <type value="ClinicalDocument"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="cda_laboratory_observation"/>
      <type value="CDAObservation"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="fhir_observation"/>
      <type value="Observation"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_practitionerRole"/>
      <type value="PractitionerRole"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_patient"/>
      <type value="Patient"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_bundle"/>
      <type value="Bundle"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="FhirObservationProfile"/>
      <source>
        <context value="cda_laboratory_observation"/>
      </source>
      <target>
        <context value="fhir_observation"/>
        <contextType value="variable"/>
        <element value="meta"/>
        <variable value="fhir_observation_meta"/>
      </target>
      <target>
        <context value="fhir_observation_meta"/>
        <contextType value="variable"/>
        <element value="profile"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="http://hl7.eu/fhir/laboratory/StructureDefinition/Observation-resultslab-eu-lab"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="id"/>
      <source>
        <context value="cda_laboratory_observation"/>
        <element value="id"/>
        <variable value="vvv"/>
      </source>
      <target>
        <context value="fhir_observation"/>
        <contextType value="variable"/>
        <element value="identifier"/>
        <variable value="vvv"/>
        <transform value="create"/>
      </target>
    </rule>
    <rule>
      <name value="FhirObservationCategoryCoding"/>
      <source>
        <context value="cda_laboratory_observation"/>
      </source>
      <target>
        <context value="fhir_observation"/>
        <contextType value="variable"/>
        <element value="category"/>
        <variable value="fhir_category"/>
      </target>
      <target>
        <context value="fhir_category"/>
        <contextType value="variable"/>
        <element value="coding"/>
        <variable value="fhir_category_coding"/>
      </target>
      <target>
        <context value="fhir_category_coding"/>
        <contextType value="variable"/>
        <element value="system"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="http://terminology.hl7.org/CodeSystem/observation-category"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_category_coding"/>
        <contextType value="variable"/>
        <element value="code"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="laboratory"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="FhirObservationSubject"/>
      <source>
        <context value="cda_laboratory_observation"/>
      </source>
      <target>
        <context value="fhir_observation"/>
        <contextType value="variable"/>
        <element value="subject"/>
        <variable value="fhir_observation_subject_reference"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Reference"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_patient"/>
        <contextType value="variable"/>
        <element value="id"/>
        <variable value="fhir_patient_id"/>
      </target>
      <target>
        <context value="fhir_observation_subject_reference"/>
        <contextType value="variable"/>
        <element value="reference"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_patient_id"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="code"/>
      <source>
        <context value="cda_laboratory_observation"/>
        <element value="code"/>
        <variable value="vvv"/>
      </source>
      <target>
        <context value="fhir_observation"/>
        <contextType value="variable"/>
        <element value="code"/>
        <variable value="vvv"/>
        <transform value="create"/>
      </target>
    </rule>
    <rule>
      <name value="CdaStatusCodeToFhirObservationStatus"/>
      <source>
        <context value="cda_laboratory_observation"/>
        <condition value="cda_laboratory_observation.value.exists((code = '255599008') and (codeSystem = '2.16.840.1.113883.6.96')).not()"/>
      </source>
      <rule>
        <name value="CdaStatusCodeToFhirObservationStatusMapped"/>
        <source>
          <context value="cda_laboratory_observation"/>
          <element value="statusCode"/>
          <variable value="observation_statusCode"/>
        </source>
        <rule>
          <name value="code"/>
          <source>
            <context value="observation_statusCode"/>
            <element value="code"/>
            <variable value="cda_code"/>
          </source>
          <target>
            <context value="fhir_observation"/>
            <contextType value="variable"/>
            <element value="status"/>
            <transform value="translate"/>
            <parameter>
              <valueId value="cda_code"/>
            </parameter>
            <parameter>
              <valueString value="#act-status-2-observation-status"/>
            </parameter>
            <parameter>
              <valueString value="code"/>
            </parameter>
          </target>
        </rule>
      </rule>
    </rule>
    <rule>
      <name value="CdaIncompleteObservationToFhirObservationStatus"/>
      <source>
        <context value="cda_laboratory_observation"/>
        <condition value="cda_laboratory_observation.value.exists((code = '255599008') and (codeSystem = '2.16.840.1.113883.6.96'))"/>
      </source>
      <target>
        <context value="fhir_observation"/>
        <contextType value="variable"/>
        <element value="status"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="preliminary"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_observation"/>
        <contextType value="variable"/>
        <element value="dataAbsentReason"/>
        <variable value="fhir_observation_dataAbsentReason"/>
      </target>
      <target>
        <context value="fhir_observation_dataAbsentReason"/>
        <contextType value="variable"/>
        <element value="coding"/>
        <variable value="fhir_observation_dataAbsentReason_coding"/>
      </target>
      <target>
        <context value="fhir_observation_dataAbsentReason_coding"/>
        <contextType value="variable"/>
        <element value="code"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="temp-unknown"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_observation_dataAbsentReason_coding"/>
        <contextType value="variable"/>
        <element value="system"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="http://terminology.hl7.org/CodeSystem/data-absent-reason"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="CdaEffectiveTimeToFhirObservationEffective"/>
      <source>
        <context value="cda_laboratory_observation"/>
        <element value="effectiveTime"/>
        <variable value="cda_effectiveTime"/>
      </source>
      <target>
        <context value="fhir_observation"/>
        <contextType value="variable"/>
        <element value="effective"/>
        <variable value="fhir_observation_effective"/>
        <transform value="create"/>
        <parameter>
          <valueString value="dateTime"/>
        </parameter>
      </target>
      <dependent>
        <name value="TSDateTime"/>
        <variable value="cda_effectiveTime"/>
        <variable value="fhir_observation_effective"/>
      </dependent>
    </rule>
    <rule>
      <name value="CdaEffectiveTimeExistsNotToFhirObservationEffective"/>
      <source>
        <context value="cda_laboratory_observation"/>
        <condition value="cda_laboratory_observation.effectiveTime.where(nullFlavor = 'UNK')"/>
      </source>
      <target>
        <context value="fhir_observation"/>
        <contextType value="variable"/>
        <element value="effective"/>
        <variable value="fhir_observation_effective"/>
        <transform value="create"/>
        <parameter>
          <valueString value="dateTime"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_observation_effective"/>
        <contextType value="variable"/>
        <element value="extension"/>
        <variable value="fhir_observation_effective_extenstion"/>
      </target>
      <target>
        <context value="fhir_observation_effective_extenstion"/>
        <contextType value="variable"/>
        <element value="url"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="http://hl7.org/fhir/StructureDefinition/data-absent-reason"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_observation_effective_extenstion"/>
        <contextType value="variable"/>
        <element value="value"/>
        <variable value="fhir_observation_effective_extenstion_code"/>
        <transform value="create"/>
        <parameter>
          <valueString value="code"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_observation_effective_extenstion_code"/>
        <contextType value="variable"/>
        <element value="value"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="unknown"/>
        </parameter>
      </target>
    </rule>
    <rule>
      <name value="CdaObservationValueToFhirObservationValuePQ"/>
      <source>
        <context value="cda_laboratory_observation"/>
        <type value="PQ"/>
        <element value="value"/>
        <variable value="cda_observation_value"/>
      </source>
      <target>
        <context value="fhir_observation"/>
        <contextType value="variable"/>
        <element value="value"/>
        <variable value="fhir_observation_value"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Quantity"/>
        </parameter>
      </target>
      <dependent>
        <name value="PQQuantity"/>
        <variable value="cda_observation_value"/>
        <variable value="fhir_observation_value"/>
      </dependent>
    </rule>
    <rule>
      <name value="CdaObservationValueToFhirObservationValueIVLPQ"/>
      <source>
        <context value="cda_laboratory_observation"/>
        <type value="IVL_PQ"/>
        <element value="value"/>
        <variable value="cda_observation_value"/>
      </source>
      <target>
        <context value="fhir_observation"/>
        <contextType value="variable"/>
        <element value="value"/>
        <variable value="fhir_observation_value"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Range"/>
        </parameter>
      </target>
      <dependent>
        <name value="IVLPQRange"/>
        <variable value="cda_observation_value"/>
        <variable value="fhir_observation_value"/>
      </dependent>
    </rule>
    <rule>
      <name value="CdaObservationValueToFhirObservationValueCD"/>
      <source>
        <context value="cda_laboratory_observation"/>
        <condition value="cda_laboratory_observation.value.exists((code = '255599008') and (codeSystem = '2.16.840.1.113883.6.96')).not()"/>
      </source>
      <rule>
        <name value="valueCD"/>
        <source>
          <context value="cda_laboratory_observation"/>
          <type value="CD"/>
          <element value="value"/>
          <variable value="cda_observation_value"/>
        </source>
        <target>
          <context value="fhir_observation"/>
          <contextType value="variable"/>
          <element value="value"/>
          <variable value="fhir_observation_value"/>
          <transform value="create"/>
          <parameter>
            <valueString value="CodeableConcept"/>
          </parameter>
        </target>
        <dependent>
          <name value="CDCodeableConcept"/>
          <variable value="cda_observation_value"/>
          <variable value="fhir_observation_value"/>
        </dependent>
      </rule>
    </rule>
    <rule>
      <name value="interpretationCode"/>
      <source>
        <context value="cda_laboratory_observation"/>
        <element value="interpretationCode"/>
        <variable value="vvv"/>
      </source>
      <target>
        <context value="fhir_observation"/>
        <contextType value="variable"/>
        <element value="interpretation"/>
        <variable value="vvv"/>
        <transform value="create"/>
      </target>
    </rule>
    <rule>
      <name value="CdaObservationPerformerToFhirObservationPerformer"/>
      <source>
        <context value="cda_laboratory_observation"/>
        <element value="performer"/>
        <variable value="cda_laboratory_observation_performer"/>
        <condition value="cda_laboratory_observation.performer.exists()"/>
      </source>
      <dependent>
        <name value="CdaPerformerToFhirObservationPerformer"/>
        <variable value="cda_laboratory_observation_performer"/>
        <variable value="fhir_observation"/>
        <variable value="fhir_bundle"/>
      </dependent>
    </rule>
    <rule>
      <name value="CdaObservationPerformerExistsNot"/>
      <source>
        <context value="cda_laboratory_observation"/>
        <condition value="cda_laboratory_observation.performer.exists().not()"/>
      </source>
      <rule>
        <name value="CdaDocumentationOfServiceEventPerformerExists"/>
        <source>
          <context value="cda"/>
          <condition value="cda.documentationOf[0].serviceEvent.performer.exists()"/>
        </source>
        <rule>
          <name value="documentationOf"/>
          <source>
            <context value="cda"/>
            <element value="documentationOf"/>
            <listMode value="first"/>
            <variable value="cda_documentationOf"/>
          </source>
          <rule>
            <name value="serviceEvent"/>
            <source>
              <context value="cda_documentationOf"/>
              <element value="serviceEvent"/>
              <variable value="cda_documentationOf_serviceEvent"/>
            </source>
            <rule>
              <name value="performer"/>
              <source>
                <context value="cda_documentationOf_serviceEvent"/>
                <element value="performer"/>
                <variable value="cda_documentationOf_serviceEvent_performer"/>
              </source>
              <rule>
                <name value="AAA"/>
                <source>
                  <context value="cda_documentationOf_serviceEvent_performer"/>
                  <element value="time"/>
                  <variable value="vvv"/>
                </source>
                <target>
                  <context value="fhir_observation"/>
                  <contextType value="variable"/>
                  <element value="issued"/>
                  <variable value="vvv"/>
                  <transform value="create"/>
                </target>
              </rule>
            </rule>
          </rule>
        </rule>
      </rule>
      <rule>
        <name value="CdaObservationPerformerExistsNotRole"/>
        <source>
          <context value="cda"/>
        </source>
        <target>
          <context value="fhir_observation"/>
          <contextType value="variable"/>
          <element value="performer"/>
          <variable value="fhir_observation_performer_reference"/>
          <transform value="create"/>
          <parameter>
            <valueString value="Reference"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_practitionerRole"/>
          <contextType value="variable"/>
          <element value="id"/>
          <variable value="fhir_practitionerRole_id"/>
        </target>
        <target>
          <context value="fhir_observation_performer_reference"/>
          <contextType value="variable"/>
          <element value="reference"/>
          <transform value="append"/>
          <parameter>
            <valueString value="urn:uuid:"/>
          </parameter>
          <parameter>
            <valueId value="fhir_practitionerRole_id"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_observation_performer_reference"/>
          <contextType value="variable"/>
          <element value="type"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="PractitionerRole"/>
          </parameter>
        </target>
      </rule>
    </rule>
    <rule>
      <name value="referenceRange"/>
      <source>
        <context value="cda_laboratory_observation"/>
        <element value="referenceRange"/>
        <variable value="cda_observation_referenceRange"/>
      </source>
      <rule>
        <name value="observationRange"/>
        <source>
          <context value="cda_observation_referenceRange"/>
          <element value="observationRange"/>
          <variable value="cda_referenceRange_observationRange"/>
        </source>
        <target>
          <context value="fhir_observation"/>
          <contextType value="variable"/>
          <element value="referenceRange"/>
          <variable value="fhir_observation_referenceRange"/>
        </target>
        <rule>
          <name value="text"/>
          <source>
            <context value="cda_referenceRange_observationRange"/>
            <element value="text"/>
            <variable value="vvv"/>
          </source>
          <target>
            <context value="fhir_observation_referenceRange"/>
            <contextType value="variable"/>
            <element value="text"/>
            <variable value="vvv"/>
            <transform value="create"/>
          </target>
        </rule>
        <rule>
          <name value="value"/>
          <source>
            <context value="cda_referenceRange_observationRange"/>
            <element value="value"/>
            <variable value="cda_observationRange_value"/>
          </source>
          <rule>
            <name value="low"/>
            <source>
              <context value="cda_observationRange_value"/>
              <element value="low"/>
              <variable value="vvv"/>
            </source>
            <target>
              <context value="fhir_observation_referenceRange"/>
              <contextType value="variable"/>
              <element value="low"/>
              <variable value="vvv"/>
              <transform value="create"/>
            </target>
          </rule>
          <rule>
            <name value="high"/>
            <source>
              <context value="cda_observationRange_value"/>
              <element value="high"/>
              <variable value="vvv"/>
            </source>
            <target>
              <context value="fhir_observation_referenceRange"/>
              <contextType value="variable"/>
              <element value="high"/>
              <variable value="vvv"/>
              <transform value="create"/>
            </target>
          </rule>
        </rule>
        <rule>
          <name value="CdaInterpretationCodeToFhirInterpretationCode"/>
          <source>
            <context value="cda_referenceRange_observationRange"/>
            <element value="interpretationCode"/>
          </source>
          <target>
            <context value="fhir_observation_referenceRange"/>
            <contextType value="variable"/>
            <element value="type"/>
            <variable value="fhir_referenceRange_type"/>
          </target>
          <target>
            <context value="fhir_referenceRange_type"/>
            <contextType value="variable"/>
            <element value="coding"/>
            <variable value="fhir_type_coding"/>
          </target>
          <target>
            <context value="fhir_type_coding"/>
            <contextType value="variable"/>
            <element value="system"/>
            <transform value="copy"/>
            <parameter>
              <valueString value="http://terminology.hl7.org/CodeSystem/referencerange-meaning"/>
            </parameter>
          </target>
          <target>
            <context value="fhir_type_coding"/>
            <contextType value="variable"/>
            <element value="code"/>
            <transform value="copy"/>
            <parameter>
              <valueString value="normal"/>
            </parameter>
          </target>
        </rule>
      </rule>
    </rule>
  </group>
  <group>
    <name value="CdaAssignedEntityToFhirPractitionerRole"/>
    <typeMode value="none"/>
    <documentation value="_________________________ Template Type not specified  ___________________&#xd;&#xa;Source: https://art-decor.org/ad/#/at-lab-/rules/templates/1.2.40.0.34.6.0.11.9.22/2021-05-26T13:50:41&#xd;&#xa;Target: http://hl7.org/fhir/practitionerrole.html&#xd;&#xa;http://hl7.org/fhir/practitioner.html"/>
    <input>
      <name value="cda_assignedEntity"/>
      <type value="AssignedEntity"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="fhir_practitionerRole"/>
      <type value="PractitionerRole"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_bundle"/>
      <type value="Bundle"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="CdaAssignedEntityToFhirPractitionerRole"/>
      <source>
        <context value="cda_assignedEntity"/>
      </source>
      <target>
        <context value="fhir_bundle"/>
        <contextType value="variable"/>
        <element value="entry"/>
        <variable value="fhir_bundle_entry"/>
      </target>
      <target>
        <context value="fhir_bundle_entry"/>
        <contextType value="variable"/>
        <element value="resource"/>
        <variable value="fhir_practitioner"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Practitioner"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_practitioner"/>
        <contextType value="variable"/>
        <element value="id"/>
        <variable value="fhir_practitioner_id"/>
        <transform value="uuid"/>
      </target>
      <target>
        <context value="fhir_bundle_entry"/>
        <contextType value="variable"/>
        <element value="fullUrl"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_practitioner_id"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_practitionerRole"/>
        <contextType value="variable"/>
        <element value="practitioner"/>
        <variable value="fhir_practitionerRole_practitioner_reference"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Reference"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_practitionerRole_practitioner_reference"/>
        <contextType value="variable"/>
        <element value="reference"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_practitioner_id"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_practitionerRole_practitioner_reference"/>
        <contextType value="variable"/>
        <element value="type"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="Practitioner"/>
        </parameter>
      </target>
      <rule>
        <name value="id"/>
        <source>
          <context value="cda_assignedEntity"/>
          <element value="id"/>
          <variable value="vvv"/>
        </source>
        <target>
          <context value="fhir_practitionerRole"/>
          <contextType value="variable"/>
          <element value="identifier"/>
          <variable value="vvv"/>
          <transform value="create"/>
        </target>
      </rule>
      <rule>
        <name value="code"/>
        <source>
          <context value="cda_assignedEntity"/>
          <element value="code"/>
          <variable value="vvv"/>
        </source>
        <target>
          <context value="fhir_practitionerRole"/>
          <contextType value="variable"/>
          <element value="code"/>
          <variable value="vvv"/>
          <transform value="create"/>
        </target>
      </rule>
      <rule>
        <name value="addr"/>
        <source>
          <context value="cda_assignedEntity"/>
          <element value="addr"/>
          <variable value="vvv"/>
        </source>
        <target>
          <context value="fhir_practitioner"/>
          <contextType value="variable"/>
          <element value="address"/>
          <variable value="vvv"/>
          <transform value="create"/>
        </target>
      </rule>
      <rule>
        <name value="telecom"/>
        <source>
          <context value="cda_assignedEntity"/>
          <element value="telecom"/>
          <variable value="vvv"/>
        </source>
        <target>
          <context value="fhir_practitioner"/>
          <contextType value="variable"/>
          <element value="telecom"/>
          <variable value="vvv"/>
          <transform value="create"/>
        </target>
      </rule>
      <rule>
        <name value="assignedPerson"/>
        <source>
          <context value="cda_assignedEntity"/>
          <element value="assignedPerson"/>
          <variable value="cda_assignedPerson"/>
        </source>
        <rule>
          <name value="name"/>
          <source>
            <context value="cda_assignedPerson"/>
            <element value="name"/>
            <variable value="vvv"/>
          </source>
          <target>
            <context value="fhir_practitioner"/>
            <contextType value="variable"/>
            <element value="name"/>
            <variable value="vvv"/>
            <transform value="create"/>
          </target>
        </rule>
      </rule>
      <rule>
        <name value="representedOrganization"/>
        <source>
          <context value="cda_assignedEntity"/>
          <element value="representedOrganization"/>
          <variable value="cda_representedOrganization"/>
        </source>
        <target>
          <context value="fhir_bundle"/>
          <contextType value="variable"/>
          <element value="entry"/>
          <variable value="fhir_bundle_entry"/>
        </target>
        <target>
          <context value="fhir_bundle_entry"/>
          <contextType value="variable"/>
          <element value="resource"/>
          <variable value="fhir_organization"/>
          <transform value="create"/>
          <parameter>
            <valueString value="Organization"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_organization"/>
          <contextType value="variable"/>
          <element value="id"/>
          <variable value="fhir_organization_id"/>
          <transform value="uuid"/>
        </target>
        <target>
          <context value="fhir_bundle_entry"/>
          <contextType value="variable"/>
          <element value="fullUrl"/>
          <transform value="append"/>
          <parameter>
            <valueString value="urn:uuid:"/>
          </parameter>
          <parameter>
            <valueId value="fhir_organization_id"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_practitionerRole"/>
          <contextType value="variable"/>
          <element value="organization"/>
          <variable value="fhir_practitionerRole_organization"/>
          <transform value="create"/>
          <parameter>
            <valueString value="Reference"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_practitionerRole_organization"/>
          <contextType value="variable"/>
          <element value="reference"/>
          <transform value="append"/>
          <parameter>
            <valueString value="urn:uuid:"/>
          </parameter>
          <parameter>
            <valueId value="fhir_organization_id"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_practitionerRole_organization"/>
          <contextType value="variable"/>
          <element value="type"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="Organization"/>
          </parameter>
        </target>
        <dependent>
          <name value="CdaOrganizationCompilationToFhirOrganization"/>
          <variable value="cda_representedOrganization"/>
          <variable value="fhir_organization"/>
        </dependent>
      </rule>
    </rule>
  </group>
  <group>
    <name value="CdaAssociatedEntityToFhirPractitionerRole"/>
    <typeMode value="none"/>
    <documentation value="Source: https://art-decor.org/ad/#/at-lab-/rules/templates/1.2.40.0.34.6.0.11.9.22/2021-05-26T13:50:41&#xd;&#xa;Target: http://hl7.org/fhir/practitionerrole.html&#xd;&#xa;http://hl7.org/fhir/practitioner.html"/>
    <input>
      <name value="cda_associatedEntity"/>
      <type value="AssociatedEntity"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="fhir_practitionerRole"/>
      <type value="PractitionerRole"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_bundle"/>
      <type value="Bundle"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="CdaAssociatedEntityToFhirPractitionerRole"/>
      <source>
        <context value="cda_associatedEntity"/>
      </source>
      <target>
        <context value="fhir_bundle"/>
        <contextType value="variable"/>
        <element value="entry"/>
        <variable value="fhir_bundle_entry"/>
      </target>
      <target>
        <context value="fhir_bundle_entry"/>
        <contextType value="variable"/>
        <element value="resource"/>
        <variable value="fhir_practitioner"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Practitioner"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_practitioner"/>
        <contextType value="variable"/>
        <element value="id"/>
        <variable value="fhir_practitioner_id"/>
        <transform value="uuid"/>
      </target>
      <target>
        <context value="fhir_bundle_entry"/>
        <contextType value="variable"/>
        <element value="fullUrl"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_practitioner_id"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_practitionerRole"/>
        <contextType value="variable"/>
        <element value="practitioner"/>
        <variable value="fhir_practitionerRole_practitioner_reference"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Reference"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_practitionerRole_practitioner_reference"/>
        <contextType value="variable"/>
        <element value="reference"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_practitioner_id"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_practitionerRole_practitioner_reference"/>
        <contextType value="variable"/>
        <element value="type"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="Practitioner"/>
        </parameter>
      </target>
      <rule>
        <name value="id"/>
        <source>
          <context value="cda_associatedEntity"/>
          <element value="id"/>
          <variable value="vvv"/>
        </source>
        <target>
          <context value="fhir_practitionerRole"/>
          <contextType value="variable"/>
          <element value="identifier"/>
          <variable value="vvv"/>
          <transform value="create"/>
        </target>
      </rule>
      <rule>
        <name value="addr"/>
        <source>
          <context value="cda_associatedEntity"/>
          <element value="addr"/>
          <variable value="vvv"/>
        </source>
        <target>
          <context value="fhir_practitioner"/>
          <contextType value="variable"/>
          <element value="address"/>
          <variable value="vvv"/>
          <transform value="create"/>
        </target>
      </rule>
      <rule>
        <name value="telecom"/>
        <source>
          <context value="cda_associatedEntity"/>
          <element value="telecom"/>
          <variable value="vvv"/>
        </source>
        <target>
          <context value="fhir_practitioner"/>
          <contextType value="variable"/>
          <element value="telecom"/>
          <variable value="vvv"/>
          <transform value="create"/>
        </target>
      </rule>
      <rule>
        <name value="associatedPerson"/>
        <source>
          <context value="cda_associatedEntity"/>
          <element value="associatedPerson"/>
          <variable value="cda_associatedPerson"/>
        </source>
        <rule>
          <name value="name"/>
          <source>
            <context value="cda_associatedPerson"/>
            <element value="name"/>
            <variable value="vvv"/>
          </source>
          <target>
            <context value="fhir_practitioner"/>
            <contextType value="variable"/>
            <element value="name"/>
            <variable value="vvv"/>
            <transform value="create"/>
          </target>
        </rule>
      </rule>
      <rule>
        <name value="scopingOrganization"/>
        <source>
          <context value="cda_associatedEntity"/>
          <element value="scopingOrganization"/>
          <variable value="cda_scopingOrganization"/>
        </source>
        <target>
          <context value="fhir_bundle"/>
          <contextType value="variable"/>
          <element value="entry"/>
          <variable value="fhir_bundle_entry"/>
        </target>
        <target>
          <context value="fhir_bundle_entry"/>
          <contextType value="variable"/>
          <element value="resource"/>
          <variable value="fhir_organization"/>
          <transform value="create"/>
          <parameter>
            <valueString value="Organization"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_organization"/>
          <contextType value="variable"/>
          <element value="id"/>
          <variable value="fhir_organization_id"/>
          <transform value="uuid"/>
        </target>
        <target>
          <context value="fhir_bundle_entry"/>
          <contextType value="variable"/>
          <element value="fullUrl"/>
          <transform value="append"/>
          <parameter>
            <valueString value="urn:uuid:"/>
          </parameter>
          <parameter>
            <valueId value="fhir_organization_id"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_practitionerRole"/>
          <contextType value="variable"/>
          <element value="organization"/>
          <variable value="fhir_practitionerRole_organization"/>
          <transform value="create"/>
          <parameter>
            <valueString value="Reference"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_practitionerRole_organization"/>
          <contextType value="variable"/>
          <element value="reference"/>
          <transform value="append"/>
          <parameter>
            <valueString value="urn:uuid:"/>
          </parameter>
          <parameter>
            <valueId value="fhir_organization_id"/>
          </parameter>
        </target>
        <target>
          <context value="fhir_practitionerRole_organization"/>
          <contextType value="variable"/>
          <element value="type"/>
          <transform value="copy"/>
          <parameter>
            <valueString value="Organization"/>
          </parameter>
        </target>
        <dependent>
          <name value="CdaOrganizationCompilationToFhirOrganization"/>
          <variable value="cda_scopingOrganization"/>
          <variable value="fhir_organization"/>
        </dependent>
      </rule>
    </rule>
  </group>
  <group>
    <name value="CdaPerformerToFhirObservationPerformer"/>
    <typeMode value="none"/>
    <input>
      <name value="cda_performer"/>
      <type value="Performer"/>
      <mode value="source"/>
    </input>
    <input>
      <name value="fhir_observation"/>
      <type value="Observation"/>
      <mode value="target"/>
    </input>
    <input>
      <name value="fhir_bundle"/>
      <type value="Bundle"/>
      <mode value="target"/>
    </input>
    <rule>
      <name value="time"/>
      <source>
        <context value="cda_performer"/>
        <element value="time"/>
        <variable value="vvv"/>
      </source>
      <target>
        <context value="fhir_observation"/>
        <contextType value="variable"/>
        <element value="issued"/>
        <variable value="vvv"/>
        <transform value="create"/>
      </target>
    </rule>
    <rule>
      <name value="assignedEntity"/>
      <source>
        <context value="cda_performer"/>
        <element value="assignedEntity"/>
        <variable value="cda_performer_assignedEntity"/>
      </source>
      <target>
        <context value="fhir_bundle"/>
        <contextType value="variable"/>
        <element value="entry"/>
        <variable value="fhir_bundle_entry01"/>
      </target>
      <target>
        <context value="fhir_bundle_entry01"/>
        <contextType value="variable"/>
        <element value="resource"/>
        <variable value="fhir_practitionerRole"/>
        <transform value="create"/>
        <parameter>
          <valueString value="PractitionerRole"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_practitionerRole"/>
        <contextType value="variable"/>
        <element value="id"/>
        <variable value="fhir_practitionerRole_id"/>
        <transform value="uuid"/>
      </target>
      <target>
        <context value="fhir_bundle_entry01"/>
        <contextType value="variable"/>
        <element value="fullUrl"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_practitionerRole_id"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_observation"/>
        <contextType value="variable"/>
        <element value="performer"/>
        <variable value="fhir_observation_performer_reference"/>
        <transform value="create"/>
        <parameter>
          <valueString value="Reference"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_observation_performer_reference"/>
        <contextType value="variable"/>
        <element value="reference"/>
        <transform value="append"/>
        <parameter>
          <valueString value="urn:uuid:"/>
        </parameter>
        <parameter>
          <valueId value="fhir_practitionerRole_id"/>
        </parameter>
      </target>
      <target>
        <context value="fhir_observation_performer_reference"/>
        <contextType value="variable"/>
        <element value="type"/>
        <transform value="copy"/>
        <parameter>
          <valueString value="PractitionerRole"/>
        </parameter>
      </target>
      <dependent>
        <name value="CdaAssignedEntityToFhirPractitionerRole"/>
        <variable value="cda_performer_assignedEntity"/>
        <variable value="fhir_practitionerRole"/>
        <variable value="fhir_bundle"/>
      </dependent>
    </rule>
  </group>
</StructureMap>
